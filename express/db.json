{"index":"<h1>Express</h1>  <main> <div id=\"api-doc\">  <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>Express 5.0 requires Node.js 18 or higher.</p> </div> <h2 id=\"express\">express()</h2> <p>Creates an Express application. The <code class=\"language-plaintext highlighter-rouge\">express()</code> function is a top-level function exported by the <code class=\"language-plaintext highlighter-rouge\">express</code> module.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst app = express()\n</pre></div>  <h3 id=\"express.methods\">Methods</h3>  <h3 id=\"express.json\" class=\"h2\">express.json([options])</h3> <p>This is a built-in middleware function in Express. It parses incoming requests with JSON payloads and is based on <a href=\"https://expressjs.com/resources/middleware/body-parser.html\">body-parser</a>.</p> <p>Returns middleware that only parses JSON and only looks at requests where the <code class=\"language-plaintext highlighter-rouge\">Content-Type</code> header matches the <code class=\"language-plaintext highlighter-rouge\">type</code> option. This parser accepts any Unicode encoding of the body and supports automatic inflation of <code class=\"language-plaintext highlighter-rouge\">gzip</code> and <code class=\"language-plaintext highlighter-rouge\">deflate</code> encodings.</p> <p>A new <code class=\"language-plaintext highlighter-rouge\">body</code> object containing the parsed data is populated on the <code class=\"language-plaintext highlighter-rouge\">request</code> object after the middleware (i.e. <code class=\"language-plaintext highlighter-rouge\">req.body</code>), or <code class=\"language-plaintext highlighter-rouge\">undefined</code> if there was no body to parse, the <code class=\"language-plaintext highlighter-rouge\">Content-Type</code> was not matched, or an error occurred.</p> <div class=\"doc-box doc-warn\"> <p>As <code class=\"language-plaintext highlighter-rouge\">req.body</code>’s shape is based on user-controlled input, all properties and values in this object are untrusted and should be validated before trusting. For example, <code class=\"language-plaintext highlighter-rouge\">req.body.foo.toString()</code> may fail in multiple ways, for example <code class=\"language-plaintext highlighter-rouge\">foo</code> may not be there or may not be a string, and <code class=\"language-plaintext highlighter-rouge\">toString</code> may not be a function and instead a string or other user-input.</p> </div> <p>The following table describes the properties of the optional <code class=\"language-plaintext highlighter-rouge\">options</code> object.</p> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Type</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code class=\"language-plaintext highlighter-rouge\">inflate</code></td> <td>Enables or disables handling deflated (compressed) bodies; when disabled, deflated bodies are rejected.</td> <td>Boolean</td> <td><code class=\"language-plaintext highlighter-rouge\">true</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">limit</code></td> <td>Controls the maximum request body size. If this is a number, then the value specifies the number of bytes; if it is a string, the value is passed to the <a href=\"https://www.npmjs.com/package/bytes\">bytes</a> library for parsing.</td> <td>Mixed</td> <td><code class=\"language-plaintext highlighter-rouge\">\"100kb\"</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">reviver</code></td> <td>The <code class=\"language-plaintext highlighter-rouge\">reviver</code> option is passed directly to <code class=\"language-plaintext highlighter-rouge\">JSON.parse</code> as the second argument. You can find more information on this argument <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse#Example.3A_Using_the_reviver_parameter\">in the MDN documentation about JSON.parse</a>.</td> <td>Function</td> <td><code class=\"language-plaintext highlighter-rouge\">null</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">strict</code></td> <td>Enables or disables only accepting arrays and objects; when disabled will accept anything <code class=\"language-plaintext highlighter-rouge\">JSON.parse</code> accepts.</td> <td>Boolean</td> <td><code class=\"language-plaintext highlighter-rouge\">true</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">type</code></td> <td>This is used to determine what media type the middleware will parse. This option can be a string, array of strings, or a function. If not a function, <code class=\"language-plaintext highlighter-rouge\">type</code> option is passed directly to the <a href=\"https://www.npmjs.org/package/type-is#readme\">type-is</a> library and this can be an extension name (like <code class=\"language-plaintext highlighter-rouge\">json</code>), a mime type (like <code class=\"language-plaintext highlighter-rouge\">application/json</code>), or a mime type with a wildcard (like <code class=\"language-plaintext highlighter-rouge\">*/*</code> or <code class=\"language-plaintext highlighter-rouge\">*/json</code>). If a function, the <code class=\"language-plaintext highlighter-rouge\">type</code> option is called as <code class=\"language-plaintext highlighter-rouge\">fn(req)</code> and the request is parsed if it returns a truthy value.</td> <td>Mixed</td> <td><code class=\"language-plaintext highlighter-rouge\">\"application/json\"</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">verify</code></td> <td>This option, if supplied, is called as <code class=\"language-plaintext highlighter-rouge\">verify(req, res, buf, encoding)</code>, where <code class=\"language-plaintext highlighter-rouge\">buf</code> is a <code class=\"language-plaintext highlighter-rouge\">Buffer</code> of the raw request body and <code class=\"language-plaintext highlighter-rouge\">encoding</code> is the encoding of the request. The parsing can be aborted by throwing an error.</td> <td>Function</td> <td><code class=\"language-plaintext highlighter-rouge\">undefined</code></td> </tr> </tbody> </table> </div>   <h3 id=\"express.raw\" class=\"h2\">express.raw([options])</h3> <p>This is a built-in middleware function in Express. It parses incoming request payloads into a <code class=\"language-plaintext highlighter-rouge\">Buffer</code> and is based on <a href=\"https://expressjs.com/resources/middleware/body-parser.html\">body-parser</a>.</p> <p>Returns middleware that parses all bodies as a <code class=\"language-plaintext highlighter-rouge\">Buffer</code> and only looks at requests where the <code class=\"language-plaintext highlighter-rouge\">Content-Type</code> header matches the <code class=\"language-plaintext highlighter-rouge\">type</code> option. This parser accepts any Unicode encoding of the body and supports automatic inflation of <code class=\"language-plaintext highlighter-rouge\">gzip</code> and <code class=\"language-plaintext highlighter-rouge\">deflate</code> encodings.</p> <p>A new <code class=\"language-plaintext highlighter-rouge\">body</code> <code class=\"language-plaintext highlighter-rouge\">Buffer</code> containing the parsed data is populated on the <code class=\"language-plaintext highlighter-rouge\">request</code> object after the middleware (i.e. <code class=\"language-plaintext highlighter-rouge\">req.body</code>), or <code class=\"language-plaintext highlighter-rouge\">undefined</code> if there was no body to parse, the <code class=\"language-plaintext highlighter-rouge\">Content-Type</code> was not matched, or an error occurred.</p> <div class=\"doc-box doc-warn\"> <p>As <code class=\"language-plaintext highlighter-rouge\">req.body</code>’s shape is based on user-controlled input, all properties and values in this object are untrusted and should be validated before trusting. For example, <code class=\"language-plaintext highlighter-rouge\">req.body.toString()</code> may fail in multiple ways, for example stacking multiple parsers <code class=\"language-plaintext highlighter-rouge\">req.body</code> may be from a different parser. Testing that <code class=\"language-plaintext highlighter-rouge\">req.body</code> is a <code class=\"language-plaintext highlighter-rouge\">Buffer</code> before calling buffer methods is recommended.</p> </div> <p>The following table describes the properties of the optional <code class=\"language-plaintext highlighter-rouge\">options</code> object.</p> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Type</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code class=\"language-plaintext highlighter-rouge\">inflate</code></td> <td>Enables or disables handling deflated (compressed) bodies; when disabled, deflated bodies are rejected.</td> <td>Boolean</td> <td><code class=\"language-plaintext highlighter-rouge\">true</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">limit</code></td> <td>Controls the maximum request body size. If this is a number, then the value specifies the number of bytes; if it is a string, the value is passed to the <a href=\"https://www.npmjs.com/package/bytes\">bytes</a> library for parsing.</td> <td>Mixed</td> <td><code class=\"language-plaintext highlighter-rouge\">\"100kb\"</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">type</code></td> <td>This is used to determine what media type the middleware will parse. This option can be a string, array of strings, or a function. If not a function, <code class=\"language-plaintext highlighter-rouge\">type</code> option is passed directly to the <a href=\"https://www.npmjs.org/package/type-is#readme\">type-is</a> library and this can be an extension name (like <code class=\"language-plaintext highlighter-rouge\">bin</code>), a mime type (like <code class=\"language-plaintext highlighter-rouge\">application/octet-stream</code>), or a mime type with a wildcard (like <code class=\"language-plaintext highlighter-rouge\">*/*</code> or <code class=\"language-plaintext highlighter-rouge\">application/*</code>). If a function, the <code class=\"language-plaintext highlighter-rouge\">type</code> option is called as <code class=\"language-plaintext highlighter-rouge\">fn(req)</code> and the request is parsed if it returns a truthy value.</td> <td>Mixed</td> <td><code class=\"language-plaintext highlighter-rouge\">\"application/octet-stream\"</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">verify</code></td> <td>This option, if supplied, is called as <code class=\"language-plaintext highlighter-rouge\">verify(req, res, buf, encoding)</code>, where <code class=\"language-plaintext highlighter-rouge\">buf</code> is a <code class=\"language-plaintext highlighter-rouge\">Buffer</code> of the raw request body and <code class=\"language-plaintext highlighter-rouge\">encoding</code> is the encoding of the request. The parsing can be aborted by throwing an error.</td> <td>Function</td> <td><code class=\"language-plaintext highlighter-rouge\">undefined</code></td> </tr> </tbody> </table> </div>   <h3 id=\"express.router\" class=\"h2\">express.Router([options])</h3> <p>Creates a new <a href=\"#router\">router</a> object.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const router = express.Router([options])\n</pre></div>  <p>The optional <code class=\"language-plaintext highlighter-rouge\">options</code> parameter specifies the behavior of the router.</p> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Default</th> <th>Availability</th> </tr> </thead> <tbody> <tr> <td><code class=\"language-plaintext highlighter-rouge\">caseSensitive</code></td> <td>Enable case sensitivity.</td> <td>Disabled by default, treating “/Foo” and “/foo” as the same.</td> <td> </td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">mergeParams</code></td> <td>Preserve the <code class=\"language-plaintext highlighter-rouge\">req.params</code> values from the parent router. If the parent and the child have conflicting param names, the child’s value take precedence.</td> <td><code class=\"language-plaintext highlighter-rouge\">false</code></td> <td>4.5.0+</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">strict</code></td> <td>Enable strict routing.</td> <td>Disabled by default, “/foo” and “/foo/” are treated the same by the router.</td> <td> </td> </tr> </tbody> </table> </div> <p>You can add middleware and HTTP method routes (such as <code class=\"language-plaintext highlighter-rouge\">get</code>, <code class=\"language-plaintext highlighter-rouge\">put</code>, <code class=\"language-plaintext highlighter-rouge\">post</code>, and so on) to <code class=\"language-plaintext highlighter-rouge\">router</code> just like an application.</p> <p>For more information, see <a href=\"#router\">Router</a>.</p>   <h3 id=\"express.static\" class=\"h2\">express.static(root, [options])</h3> <p>This is a built-in middleware function in Express. It serves static files and is based on <a href=\"https://expressjs.com/resources/middleware/serve-static.html\">serve-static</a>.</p> <div class=\"doc-box doc-info\"> <p>NOTE: For best results, <a href=\"advanced/best-practice-performance#use-a-reverse-proxy\">use a reverse proxy</a> cache to improve performance of serving static assets.</p> </div> <p>The <code class=\"language-plaintext highlighter-rouge\">root</code> argument specifies the root directory from which to serve static assets. The function determines the file to serve by combining <code class=\"language-plaintext highlighter-rouge\">req.url</code> with the provided <code class=\"language-plaintext highlighter-rouge\">root</code> directory. When a file is not found, instead of sending a 404 response, it instead calls <code class=\"language-plaintext highlighter-rouge\">next()</code> to move on to the next middleware, allowing for stacking and fall-backs.</p> <p>The following table describes the properties of the <code class=\"language-plaintext highlighter-rouge\">options</code> object. See also the <a href=\"#example.of.express.static\">example below</a>.</p> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Type</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code class=\"language-plaintext highlighter-rouge\">dotfiles</code></td> <td>Determines how dotfiles (files or directories that begin with a dot “.”) are treated. <br><br>See <a href=\"#dotfiles\">dotfiles</a> below.</td> <td>String</td> <td>“ignore”</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">etag</code></td> <td>Enable or disable etag generation <br><br>NOTE: <code class=\"language-plaintext highlighter-rouge\">express.static</code> always sends weak ETags.</td> <td>Boolean</td> <td><code class=\"language-plaintext highlighter-rouge\">true</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">extensions</code></td> <td>Sets file extension fallbacks: If a file is not found, search for files with the specified extensions and serve the first one found. Example: <code class=\"language-plaintext highlighter-rouge\">['html', 'htm']</code>.</td> <td>Mixed</td> <td><code class=\"language-plaintext highlighter-rouge\">false</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">fallthrough</code></td> <td>Let client errors fall-through as unhandled requests, otherwise forward a client error. <br><br>See <a href=\"#fallthrough\">fallthrough</a> below.</td> <td>Boolean</td> <td><code class=\"language-plaintext highlighter-rouge\">true</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">immutable</code></td> <td>Enable or disable the <code class=\"language-plaintext highlighter-rouge\">immutable</code> directive in the <code class=\"language-plaintext highlighter-rouge\">Cache-Control</code> response header. If enabled, the <code class=\"language-plaintext highlighter-rouge\">maxAge</code> option should also be specified to enable caching. The <code class=\"language-plaintext highlighter-rouge\">immutable</code> directive will prevent supported clients from making conditional requests during the life of the <code class=\"language-plaintext highlighter-rouge\">maxAge</code> option to check if the file has changed.</td> <td>Boolean</td> <td><code class=\"language-plaintext highlighter-rouge\">false</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">index</code></td> <td>Sends the specified directory index file. Set to <code class=\"language-plaintext highlighter-rouge\">false</code> to disable directory indexing.</td> <td>Mixed</td> <td>“index.html”</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">lastModified</code></td> <td>Set the <code class=\"language-plaintext highlighter-rouge\">Last-Modified</code> header to the last modified date of the file on the OS.</td> <td>Boolean</td> <td><code class=\"language-plaintext highlighter-rouge\">true</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">maxAge</code></td> <td>Set the max-age property of the Cache-Control header in milliseconds or a string in <a href=\"https://www.npmjs.org/package/ms\">ms format</a>.</td> <td>Number</td> <td>0</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">redirect</code></td> <td>Redirect to trailing “/” when the pathname is a directory.</td> <td>Boolean</td> <td><code class=\"language-plaintext highlighter-rouge\">true</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">setHeaders</code></td> <td>Function for setting HTTP headers to serve with the file. <br><br>See <a href=\"#setHeaders\">setHeaders</a> below.</td> <td>Function</td> <td> </td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">acceptRanges</code></td> <td>Enable or disable accepting ranged requests. Disabling this will not send the Accept-Ranges header and will ignore the contents of the Range request header.</td> <td>Boolean</td> <td>true</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">cacheControl</code></td> <td>Enable or disable setting the Cache-Control response header. Disabling this will ignore the immutable and maxAge options.</td> <td>Boolean</td> <td>true</td> </tr> </tbody> </table> </div> <p>For more information, see <a href=\"https://expressjs.com/starter/static-files.html\">Serving static files in Express</a>. and <a href=\"guide/using-middleware#middleware.built-in\">Using middleware - Built-in middleware</a>.</p> <h5 id=\"dotfiles\"> dotfiles</h5> <p>Possible values for this option are:</p> <ul> <li>“allow” - No special treatment for dotfiles.</li> <li>“deny” - Deny a request for a dotfile, respond with <code class=\"language-plaintext highlighter-rouge\">403</code>, then call <code class=\"language-plaintext highlighter-rouge\">next()</code>.</li> <li>“ignore” - Act as if the dotfile does not exist, respond with <code class=\"language-plaintext highlighter-rouge\">404</code>, then call <code class=\"language-plaintext highlighter-rouge\">next()</code>.</li> </ul> <h5 id=\"fallthrough\">fallthrough</h5> <p>When this option is <code class=\"language-plaintext highlighter-rouge\">true</code>, client errors such as a bad request or a request to a non-existent file will cause this middleware to simply call <code class=\"language-plaintext highlighter-rouge\">next()</code> to invoke the next middleware in the stack. When false, these errors (even 404s), will invoke <code class=\"language-plaintext highlighter-rouge\">next(err)</code>.</p> <p>Set this option to <code class=\"language-plaintext highlighter-rouge\">true</code> so you can map multiple physical directories to the same web address or for routes to fill in non-existent files.</p> <p>Use <code class=\"language-plaintext highlighter-rouge\">false</code> if you have mounted this middleware at a path designed to be strictly a single file system directory, which allows for short-circuiting 404s for less overhead. This middleware will also reply to all methods.</p> <h5 id=\"setHeaders\">setHeaders</h5> <p>For this option, specify a function to set custom response headers. Alterations to the headers must occur synchronously.</p> <p>The signature of the function is:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">fn(res, path, stat)\n</pre></div>  <p>Arguments:</p> <ul> <li>\n<code class=\"language-plaintext highlighter-rouge\">res</code>, the <a href=\"#res\">response object</a>.</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">path</code>, the file path that is being sent.</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">stat</code>, the <code class=\"language-plaintext highlighter-rouge\">stat</code> object of the file that is being sent.</li> </ul> <h4 id=\"example.of.express.static\">Example of express.static</h4> <p>Here is an example of using the <code class=\"language-plaintext highlighter-rouge\">express.static</code> middleware function with an elaborate options object:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const options = {\n  dotfiles: 'ignore',\n  etag: false,\n  extensions: ['htm', 'html'],\n  index: false,\n  maxAge: '1d',\n  redirect: false,\n  setHeaders (res, path, stat) {\n    res.set('x-timestamp', Date.now())\n  }\n}\n\napp.use(express.static('public', options))\n</pre></div>    <h3 id=\"express.text\" class=\"h2\">express.text([options])</h3> <p>This is a built-in middleware function in Express. It parses incoming request payloads into a string and is based on <a href=\"https://expressjs.com/resources/middleware/body-parser.html\">body-parser</a>.</p> <p>Returns middleware that parses all bodies as a string and only looks at requests where the <code class=\"language-plaintext highlighter-rouge\">Content-Type</code> header matches the <code class=\"language-plaintext highlighter-rouge\">type</code> option. This parser accepts any Unicode encoding of the body and supports automatic inflation of <code class=\"language-plaintext highlighter-rouge\">gzip</code> and <code class=\"language-plaintext highlighter-rouge\">deflate</code> encodings.</p> <p>A new <code class=\"language-plaintext highlighter-rouge\">body</code> string containing the parsed data is populated on the <code class=\"language-plaintext highlighter-rouge\">request</code> object after the middleware (i.e. <code class=\"language-plaintext highlighter-rouge\">req.body</code>), or <code class=\"language-plaintext highlighter-rouge\">undefined</code> if there was no body to parse, the <code class=\"language-plaintext highlighter-rouge\">Content-Type</code> was not matched, or an error occurred.</p> <div class=\"doc-box doc-warn\"> <p>As <code class=\"language-plaintext highlighter-rouge\">req.body</code>’s shape is based on user-controlled input, all properties and values in this object are untrusted and should be validated before trusting. For example, <code class=\"language-plaintext highlighter-rouge\">req.body.trim()</code> may fail in multiple ways, for example stacking multiple parsers <code class=\"language-plaintext highlighter-rouge\">req.body</code> may be from a different parser. Testing that <code class=\"language-plaintext highlighter-rouge\">req.body</code> is a string before calling string methods is recommended.</p> </div> <p>The following table describes the properties of the optional <code class=\"language-plaintext highlighter-rouge\">options</code> object.</p> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Type</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code class=\"language-plaintext highlighter-rouge\">defaultCharset</code></td> <td>Specify the default character set for the text content if the charset is not specified in the <code class=\"language-plaintext highlighter-rouge\">Content-Type</code> header of the request.</td> <td>String</td> <td><code class=\"language-plaintext highlighter-rouge\">\"utf-8\"</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">inflate</code></td> <td>Enables or disables handling deflated (compressed) bodies; when disabled, deflated bodies are rejected.</td> <td>Boolean</td> <td><code class=\"language-plaintext highlighter-rouge\">true</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">limit</code></td> <td>Controls the maximum request body size. If this is a number, then the value specifies the number of bytes; if it is a string, the value is passed to the <a href=\"https://www.npmjs.com/package/bytes\">bytes</a> library for parsing.</td> <td>Mixed</td> <td><code class=\"language-plaintext highlighter-rouge\">\"100kb\"</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">type</code></td> <td>This is used to determine what media type the middleware will parse. This option can be a string, array of strings, or a function. If not a function, <code class=\"language-plaintext highlighter-rouge\">type</code> option is passed directly to the <a href=\"https://www.npmjs.org/package/type-is#readme\">type-is</a> library and this can be an extension name (like <code class=\"language-plaintext highlighter-rouge\">txt</code>), a mime type (like <code class=\"language-plaintext highlighter-rouge\">text/plain</code>), or a mime type with a wildcard (like <code class=\"language-plaintext highlighter-rouge\">*/*</code> or <code class=\"language-plaintext highlighter-rouge\">text/*</code>). If a function, the <code class=\"language-plaintext highlighter-rouge\">type</code> option is called as <code class=\"language-plaintext highlighter-rouge\">fn(req)</code> and the request is parsed if it returns a truthy value.</td> <td>Mixed</td> <td><code class=\"language-plaintext highlighter-rouge\">\"text/plain\"</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">verify</code></td> <td>This option, if supplied, is called as <code class=\"language-plaintext highlighter-rouge\">verify(req, res, buf, encoding)</code>, where <code class=\"language-plaintext highlighter-rouge\">buf</code> is a <code class=\"language-plaintext highlighter-rouge\">Buffer</code> of the raw request body and <code class=\"language-plaintext highlighter-rouge\">encoding</code> is the encoding of the request. The parsing can be aborted by throwing an error.</td> <td>Function</td> <td><code class=\"language-plaintext highlighter-rouge\">undefined</code></td> </tr> </tbody> </table> </div>   <h3 id=\"express.urlencoded\" class=\"h2\">express.urlencoded([options])</h3> <p>This is a built-in middleware function in Express. It parses incoming requests with urlencoded payloads and is based on <a href=\"https://expressjs.com/resources/middleware/body-parser.html\">body-parser</a>.</p> <p>Returns middleware that only parses urlencoded bodies and only looks at requests where the <code class=\"language-plaintext highlighter-rouge\">Content-Type</code> header matches the <code class=\"language-plaintext highlighter-rouge\">type</code> option. This parser accepts only UTF-8 encoding of the body and supports automatic inflation of <code class=\"language-plaintext highlighter-rouge\">gzip</code> and <code class=\"language-plaintext highlighter-rouge\">deflate</code> encodings.</p> <p>A new <code class=\"language-plaintext highlighter-rouge\">body</code> object containing the parsed data is populated on the <code class=\"language-plaintext highlighter-rouge\">request</code> object after the middleware (i.e. <code class=\"language-plaintext highlighter-rouge\">req.body</code>), or <code class=\"language-plaintext highlighter-rouge\">undefined</code> if there was no body to parse, the <code class=\"language-plaintext highlighter-rouge\">Content-Type</code> was not matched, or an error occurred. This object will contain key-value pairs, where the value can be a string or array (when <code class=\"language-plaintext highlighter-rouge\">extended</code> is <code class=\"language-plaintext highlighter-rouge\">false</code>), or any type (when <code class=\"language-plaintext highlighter-rouge\">extended</code> is <code class=\"language-plaintext highlighter-rouge\">true</code>).</p> <div class=\"doc-box doc-warn\"> <p>As <code class=\"language-plaintext highlighter-rouge\">req.body</code>’s shape is based on user-controlled input, all properties and values in this object are untrusted and should be validated before trusting. For example, <code class=\"language-plaintext highlighter-rouge\">req.body.foo.toString()</code> may fail in multiple ways, for example <code class=\"language-plaintext highlighter-rouge\">foo</code> may not be there or may not be a string, and <code class=\"language-plaintext highlighter-rouge\">toString</code> may not be a function and instead a string or other user-input.</p> </div> <p>The following table describes the properties of the optional <code class=\"language-plaintext highlighter-rouge\">options</code> object.</p> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Type</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code class=\"language-plaintext highlighter-rouge\">extended</code></td> <td>This option allows to choose between parsing the URL-encoded data with the <code class=\"language-plaintext highlighter-rouge\">querystring</code> library (when <code class=\"language-plaintext highlighter-rouge\">false</code>) or the <code class=\"language-plaintext highlighter-rouge\">qs</code> library (when <code class=\"language-plaintext highlighter-rouge\">true</code>). The “extended” syntax allows for rich objects and arrays to be encoded into the URL-encoded format, allowing for a JSON-like experience with URL-encoded. For more information, please <a href=\"https://www.npmjs.org/package/qs#readme\">see the qs library</a>.</td> <td>Boolean</td> <td><code class=\"language-plaintext highlighter-rouge\">false</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">inflate</code></td> <td>Enables or disables handling deflated (compressed) bodies; when disabled, deflated bodies are rejected.</td> <td>Boolean</td> <td><code class=\"language-plaintext highlighter-rouge\">true</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">limit</code></td> <td>Controls the maximum request body size. If this is a number, then the value specifies the number of bytes; if it is a string, the value is passed to the <a href=\"https://www.npmjs.com/package/bytes\">bytes</a> library for parsing.</td> <td>Mixed</td> <td><code class=\"language-plaintext highlighter-rouge\">\"100kb\"</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">parameterLimit</code></td> <td>This option controls the maximum number of parameters that are allowed in the URL-encoded data. If a request contains more parameters than this value, an error will be raised.</td> <td>Number</td> <td><code class=\"language-plaintext highlighter-rouge\">1000</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">type</code></td> <td>This is used to determine what media type the middleware will parse. This option can be a string, array of strings, or a function. If not a function, <code class=\"language-plaintext highlighter-rouge\">type</code> option is passed directly to the <a href=\"https://www.npmjs.org/package/type-is#readme\">type-is</a> library and this can be an extension name (like <code class=\"language-plaintext highlighter-rouge\">urlencoded</code>), a mime type (like <code class=\"language-plaintext highlighter-rouge\">application/x-www-form-urlencoded</code>), or a mime type with a wildcard (like <code class=\"language-plaintext highlighter-rouge\">*/x-www-form-urlencoded</code>). If a function, the <code class=\"language-plaintext highlighter-rouge\">type</code> option is called as <code class=\"language-plaintext highlighter-rouge\">fn(req)</code> and the request is parsed if it returns a truthy value.</td> <td>Mixed</td> <td><code class=\"language-plaintext highlighter-rouge\">\"application/x-www-form-urlencoded\"</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">verify</code></td> <td>This option, if supplied, is called as <code class=\"language-plaintext highlighter-rouge\">verify(req, res, buf, encoding)</code>, where <code class=\"language-plaintext highlighter-rouge\">buf</code> is a <code class=\"language-plaintext highlighter-rouge\">Buffer</code> of the raw request body and <code class=\"language-plaintext highlighter-rouge\">encoding</code> is the encoding of the request. The parsing can be aborted by throwing an error.</td> <td>Function</td> <td><code class=\"language-plaintext highlighter-rouge\">undefined</code></td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">depth</code></td> <td>Configure the maximum depth of the <code class=\"language-plaintext highlighter-rouge\">qs</code> library when <code class=\"language-plaintext highlighter-rouge\">extended</code> is <code class=\"language-plaintext highlighter-rouge\">true</code>. This allows you to limit the amount of keys that are parsed and can be useful to prevent certain types of abuse. Defaults to <code class=\"language-plaintext highlighter-rouge\">32</code>. It is recommended to keep this value as low as possible.</td> <td>Number</td> <td><code class=\"language-plaintext highlighter-rouge\">32</code></td> </tr> </tbody> </table> </div>  <h2 id=\"app\">Application</h2> <p>The <code class=\"language-plaintext highlighter-rouge\">app</code> object conventionally denotes the Express application. Create it by calling the top-level <code class=\"language-plaintext highlighter-rouge\">express()</code> function exported by the Express module:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst app = express()\n\napp.get('/', (req, res) =&gt; {\n  res.send('hello world')\n})\n\napp.listen(3000)\n</pre></div>  <p>The <code class=\"language-plaintext highlighter-rouge\">app</code> object has methods for</p> <ul> <li>Routing HTTP requests; see for example, <a href=\"#app.METHOD\">app.METHOD</a> and <a href=\"#app.param\">app.param</a>.</li> <li>Configuring middleware; see <a href=\"#app.route\">app.route</a>.</li> <li>Rendering HTML views; see <a href=\"#app.render\">app.render</a>.</li> <li>Registering a template engine; see <a href=\"#app.engine\">app.engine</a>.</li> </ul> <p>It also has settings (properties) that affect how the application behaves; for more information, see <a href=\"#app.settings.table\">Application settings</a>.</p> <div class=\"doc-box doc-info\"> <p>The Express application object can be referred from the <a href=\"#req\">request object</a> and the <a href=\"#res\">response object</a> as <code class=\"language-plaintext highlighter-rouge\">req.app</code>, and <code class=\"language-plaintext highlighter-rouge\">res.app</code>, respectively.</p> </div> <h3 id=\"app.properties\">Properties</h3>  <h3 id=\"app.locals\">app.locals</h3> <p>The <code class=\"language-plaintext highlighter-rouge\">app.locals</code> object has properties that are local variables within the application, and will be available in templates rendered with <a href=\"#res.render\">res.render</a>.</p> <div class=\"doc-box doc-warn\"> <p>The <code class=\"language-plaintext highlighter-rouge\">locals</code> object is used by view engines to render a response. The object keys may be particularly sensitive and should not contain user-controlled input, as it may affect the operation of the view engine or provide a path to cross-site scripting. Consult the documentation for the used view engine for additional considerations.</p> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">console.dir(app.locals.title)\n// =&gt; 'My App'\n\nconsole.dir(app.locals.email)\n// =&gt; 'me@myapp.com'\n</pre></div>  <p>Once set, the value of <code class=\"language-plaintext highlighter-rouge\">app.locals</code> properties persist throughout the life of the application, in contrast with <a href=\"#res.locals\">res.locals</a> properties that are valid only for the lifetime of the request.</p> <p>You can access local variables in templates rendered within the application. This is useful for providing helper functions to templates, as well as application-level data. Local variables are available in middleware via <code class=\"language-plaintext highlighter-rouge\">req.app.locals</code> (see <a href=\"#req.app\">req.app</a>)</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.locals.title = 'My App'\napp.locals.strftime = require('strftime')\napp.locals.email = 'me@myapp.com'\n</pre></div>    <h3 id=\"app.mountpath\">app.mountpath</h3> <p>The <code class=\"language-plaintext highlighter-rouge\">app.mountpath</code> property contains one or more path patterns on which a sub-app was mounted.</p> <div class=\"doc-box doc-info\"> <p>A sub-app is an instance of <code class=\"language-plaintext highlighter-rouge\">express</code> that may be used for handling the request to a route.</p> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\n\nconst app = express() // the main app\nconst admin = express() // the sub app\n\nadmin.get('/', (req, res) =&gt; {\n  console.log(admin.mountpath) // /admin\n  res.send('Admin Homepage')\n})\n\napp.use('/admin', admin) // mount the sub app\n</pre></div>  <p>It is similar to the <a href=\"#req.baseUrl\">baseUrl</a> property of the <code class=\"language-plaintext highlighter-rouge\">req</code> object, except <code class=\"language-plaintext highlighter-rouge\">req.baseUrl</code> returns the matched URL path, instead of the matched patterns.</p> <p>If a sub-app is mounted on multiple path patterns, <code class=\"language-plaintext highlighter-rouge\">app.mountpath</code> returns the list of patterns it is mounted on, as shown in the following example.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const admin = express()\n\nadmin.get('/', (req, res) =&gt; {\n  console.log(admin.mountpath) // [ '/adm{*splat}n', '/manager' ]\n  res.send('Admin Homepage')\n})\n\nconst secret = express()\nsecret.get('/', (req, res) =&gt; {\n  console.log(secret.mountpath) // /secr{*splat}t\n  res.send('Admin Secret')\n})\n\nadmin.use('/secr{*splat}t', secret) // load the 'secret' router on '/secr{*splat}t', on the 'admin' sub app\napp.use(['/adm{*splat}n', '/manager'], admin) // load the 'admin' router on '/adm{*splat}n' and '/manager', on the parent app\n</pre></div>    <h3 id=\"app.router\">app.router</h3> <p>The application’s in-built instance of router. This is created lazily, on first access.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst app = express()\nconst router = app.router\n\nrouter.get('/', (req, res) =&gt; {\n  res.send('hello world')\n})\n\napp.listen(3000)\n</pre></div>  <p>You can add middleware and HTTP method routes to the <code class=\"language-plaintext highlighter-rouge\">router</code> just like an application.</p> <p>For more information, see <a href=\"#router\">Router</a>.</p>  <h3 id=\"app.events\">Events</h3>  <h3 id=\"app.onmount\">app.on('mount', callback(parent))</h3> <p>The <code class=\"language-plaintext highlighter-rouge\">mount</code> event is fired on a sub-app, when it is mounted on a parent app. The parent app is passed to the callback function.</p> <div class=\"doc-box doc-info\"> <p><strong>NOTE</strong></p> <p>Sub-apps will:</p> <ul> <li>Not inherit the value of settings that have a default value. You must set the value in the sub-app.</li> <li>Inherit the value of settings with no default value.</li> </ul> <p>For details, see <a href=\"5x/api#app.settings.table\">Application settings</a>.</p> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const admin = express()\n\nadmin.on('mount', (parent) =&gt; {\n  console.log('Admin Mounted')\n  console.log(parent) // refers to the parent app\n})\n\nadmin.get('/', (req, res) =&gt; {\n  res.send('Admin Homepage')\n})\n\napp.use('/admin', admin)\n</pre></div>   <h3 id=\"app.methods\">Methods</h3>  <h3 id=\"app.all\">app.all(path, callback [, callback ...])</h3> <p>This method is like the standard <a href=\"#app.METHOD\">app.METHOD()</a> methods, except it matches all HTTP verbs.</p> <h4>Arguments</h4> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Argument</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>path</code></td> <td> The path for which the middleware function is invoked. It can be any of the following: <ul> <li>A string representing a path.</li> <li>A path pattern.</li> <li>A regular expression pattern to match paths.</li> <li>An array containing any combination of the above.</li> </ul> For examples, see <a href=\"#path-examples\">Path examples</a>. </td> <td>\n<code>'/'</code> (root path)</td> </tr> <tr> <td><code>callback</code></td> <td> One or more callback functions. Accepted formats: <ul> <li>A single middleware function.</li> <li>Multiple middleware functions separated by commas.</li> <li>An array of middleware functions.</li> <li>A combination of the above.</li> </ul> <p> You may provide multiple callbacks that behave like middleware. These can call <code>next('route')</code> to skip remaining callbacks for the current route. This is useful for conditional routing logic. </p> <p> If a callback throws an error or returns a rejected promise, <code>next(err)</code> is invoked automatically. </p> <p> Since both <a href=\"#router\">router</a> and <a href=\"#application\">app</a> implement the middleware interface, they can also be used as callback middleware. </p> <p> For examples, see <a href=\"#middleware-callback-function-examples\">Middleware callback function examples</a>. </p> </td> <td><em>None</em></td> </tr> </tbody> </table> </div> <h4 id=\"examples\">Examples</h4> <p>The following callback is executed for requests to <code class=\"language-plaintext highlighter-rouge\">/secret</code> whether using GET, POST, PUT, DELETE, or any other HTTP request method:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.all('/secret', (req, res, next) =&gt; {\n  console.log('Accessing the secret section ...')\n  next() // pass control to the next handler\n})\n</pre></div>  <p>The <code class=\"language-plaintext highlighter-rouge\">app.all()</code> method is useful for mapping “global” logic for specific path prefixes or arbitrary matches. For example, if you put the following at the top of all other route definitions, it requires that all routes from that point on require authentication, and automatically load a user. Keep in mind that these callbacks do not have to act as end-points: <code class=\"language-plaintext highlighter-rouge\">loadUser</code> can perform a task, then call <code class=\"language-plaintext highlighter-rouge\">next()</code> to continue matching subsequent routes.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.all('{*splat}', requireAuthentication, loadUser)\n</pre></div>  <p>Or the equivalent:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.all('{*splat}', requireAuthentication)\napp.all('{*splat}', loadUser)\n</pre></div>  <p>Another example is white-listed “global” functionality. The example is similar to the ones above, but it only restricts paths that start with “/api”:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.all('/api/{*splat}', requireAuthentication)\n</pre></div>    <h3 id=\"app.delete.method\">app.delete(path, callback [, callback ...])</h3> <p>Routes HTTP DELETE requests to the specified path with the specified callback functions. For more information, see the <a href=\"guide/routing\">routing guide</a>.</p> <h4>Arguments</h4> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Argument</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>path</code></td> <td> The path for which the middleware function is invoked. It can be any of the following: <ul> <li>A string representing a path.</li> <li>A path pattern.</li> <li>A regular expression pattern to match paths.</li> <li>An array containing any combination of the above.</li> </ul> For examples, see <a href=\"#path-examples\">Path examples</a>. </td> <td>\n<code>'/'</code> (root path)</td> </tr> <tr> <td><code>callback</code></td> <td> One or more callback functions. Accepted formats: <ul> <li>A single middleware function.</li> <li>Multiple middleware functions separated by commas.</li> <li>An array of middleware functions.</li> <li>A combination of the above.</li> </ul> <p> You may provide multiple callbacks that behave like middleware. These can call <code>next('route')</code> to skip remaining callbacks for the current route. This is useful for conditional routing logic. </p> <p> If a callback throws an error or returns a rejected promise, <code>next(err)</code> is invoked automatically. </p> <p> Since both <a href=\"#router\">router</a> and <a href=\"#application\">app</a> implement the middleware interface, they can also be used as callback middleware. </p> <p> For examples, see <a href=\"#middleware-callback-function-examples\">Middleware callback function examples</a>. </p> </td> <td><em>None</em></td> </tr> </tbody> </table> </div> <h4 id=\"example\">Example</h4> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.delete('/', (req, res) =&gt; {\n  res.send('DELETE request to homepage')\n})\n</pre></div>    <h3 id=\"app.disable\">app.disable(name)</h3> <p>Sets the Boolean setting <code class=\"language-plaintext highlighter-rouge\">name</code> to <code class=\"language-plaintext highlighter-rouge\">false</code>, where <code class=\"language-plaintext highlighter-rouge\">name</code> is one of the properties from the <a href=\"#app.settings.table\">app settings table</a>. Calling <code class=\"language-plaintext highlighter-rouge\">app.set('foo', false)</code> for a Boolean property is the same as calling <code class=\"language-plaintext highlighter-rouge\">app.disable('foo')</code>.</p> <p>For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.disable('trust proxy')\napp.get('trust proxy')\n// =&gt; false\n</pre></div>    <h3 id=\"app.disabled\">app.disabled(name)</h3> <p>Returns <code class=\"language-plaintext highlighter-rouge\">true</code> if the Boolean setting <code class=\"language-plaintext highlighter-rouge\">name</code> is disabled (<code class=\"language-plaintext highlighter-rouge\">false</code>), where <code class=\"language-plaintext highlighter-rouge\">name</code> is one of the properties from the <a href=\"#app.settings.table\">app settings table</a>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.disabled('trust proxy')\n// =&gt; true\n\napp.enable('trust proxy')\napp.disabled('trust proxy')\n// =&gt; false\n</pre></div>    <h3 id=\"app.enable\">app.enable(name)</h3> <p>Sets the Boolean setting <code class=\"language-plaintext highlighter-rouge\">name</code> to <code class=\"language-plaintext highlighter-rouge\">true</code>, where <code class=\"language-plaintext highlighter-rouge\">name</code> is one of the properties from the <a href=\"#app.settings.table\">app settings table</a>. Calling <code class=\"language-plaintext highlighter-rouge\">app.set('foo', true)</code> for a Boolean property is the same as calling <code class=\"language-plaintext highlighter-rouge\">app.enable('foo')</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.enable('trust proxy')\napp.get('trust proxy')\n// =&gt; true\n</pre></div>    <h3 id=\"app.enabled\">app.enabled(name)</h3> <p>Returns <code class=\"language-plaintext highlighter-rouge\">true</code> if the setting <code class=\"language-plaintext highlighter-rouge\">name</code> is enabled (<code class=\"language-plaintext highlighter-rouge\">true</code>), where <code class=\"language-plaintext highlighter-rouge\">name</code> is one of the properties from the <a href=\"#app.settings.table\">app settings table</a>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.enabled('trust proxy')\n// =&gt; false\n\napp.enable('trust proxy')\napp.enabled('trust proxy')\n// =&gt; true\n</pre></div>    <h3 id=\"app.engine\">app.engine(ext, callback)</h3> <p>Registers the given template engine <code class=\"language-plaintext highlighter-rouge\">callback</code> as <code class=\"language-plaintext highlighter-rouge\">ext</code>.</p> <p>By default, Express will <code class=\"language-plaintext highlighter-rouge\">require()</code> the engine based on the file extension. For example, if you try to render a “foo.pug” file, Express invokes the following internally, and caches the <code class=\"language-plaintext highlighter-rouge\">require()</code> on subsequent calls to increase performance.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.engine('pug', require('pug').__express)\n</pre></div>  <p>Use this method for engines that do not provide <code class=\"language-plaintext highlighter-rouge\">.__express</code> out of the box, or if you wish to “map” a different extension to the template engine.</p> <p>For example, to map the EJS template engine to “.html” files:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.engine('html', require('ejs').renderFile)\n</pre></div>  <p>In this case, EJS provides a <code class=\"language-plaintext highlighter-rouge\">.renderFile()</code> method with the same signature that Express expects: <code class=\"language-plaintext highlighter-rouge\">(path, options, callback)</code>, though note that it aliases this method as <code class=\"language-plaintext highlighter-rouge\">ejs.__express</code> internally so if you’re using “.ejs” extensions you don’t need to do anything.</p> <p>Some template engines do not follow this convention. The <a href=\"https://github.com/tj/consolidate.js\">consolidate.js</a> library maps Node template engines to follow this convention, so they work seamlessly with Express.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const engines = require('consolidate')\napp.engine('haml', engines.haml)\napp.engine('html', engines.hogan)\n</pre></div>    <h3 id=\"app.get\">app.get(name)</h3> <p>Returns the value of <code class=\"language-plaintext highlighter-rouge\">name</code> app setting, where <code class=\"language-plaintext highlighter-rouge\">name</code> is one of the strings in the <a href=\"#app.settings.table\">app settings table</a>. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('title')\n// =&gt; undefined\n\napp.set('title', 'My Site')\napp.get('title')\n// =&gt; \"My Site\"\n</pre></div>    <h3 id=\"app.get.method\">app.get(path, callback [, callback ...])</h3> <p>Routes HTTP GET requests to the specified path with the specified callback functions.</p> <h4>Arguments</h4> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Argument</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>path</code></td> <td> The path for which the middleware function is invoked. It can be any of the following: <ul> <li>A string representing a path.</li> <li>A path pattern.</li> <li>A regular expression pattern to match paths.</li> <li>An array containing any combination of the above.</li> </ul> For examples, see <a href=\"#path-examples\">Path examples</a>. </td> <td>\n<code>'/'</code> (root path)</td> </tr> <tr> <td><code>callback</code></td> <td> One or more callback functions. Accepted formats: <ul> <li>A single middleware function.</li> <li>Multiple middleware functions separated by commas.</li> <li>An array of middleware functions.</li> <li>A combination of the above.</li> </ul> <p> You may provide multiple callbacks that behave like middleware. These can call <code>next('route')</code> to skip remaining callbacks for the current route. This is useful for conditional routing logic. </p> <p> If a callback throws an error or returns a rejected promise, <code>next(err)</code> is invoked automatically. </p> <p> Since both <a href=\"#router\">router</a> and <a href=\"#application\">app</a> implement the middleware interface, they can also be used as callback middleware. </p> <p> For examples, see <a href=\"#middleware-callback-function-examples\">Middleware callback function examples</a>. </p> </td> <td><em>None</em></td> </tr> </tbody> </table> </div> <p>For more information, see the <a href=\"guide/routing\">routing guide</a>.</p> <h4 id=\"example-1\">Example</h4> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/', (req, res) =&gt; {\n  res.send('GET request to homepage')\n})\n</pre></div>    <h3 id=\"app.listen_path_callback\">app.listen(path, [callback])</h3> <p>Starts a UNIX socket and listens for connections on the given path. This method is identical to Node’s <a href=\"https://nodejs.org/api/http.html#http_server_listen\">http.Server.listen()</a>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst app = express()\napp.listen('/tmp/sock')\n</pre></div>  <h3 id=\"app.listen\">app.listen([port[, host[, backlog]]][, callback])</h3> <p>Binds and listens for connections on the specified host and port. This method is identical to Node’s <a href=\"https://nodejs.org/api/http.html#http_server_listen\">http.Server.listen()</a>.</p> <p>If port is omitted or is 0, the operating system will assign an arbitrary unused port, which is useful for cases like automated tasks (tests, etc.).</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst app = express()\napp.listen(3000)\n</pre></div>  <p>The <code class=\"language-plaintext highlighter-rouge\">app</code> returned by <code class=\"language-plaintext highlighter-rouge\">express()</code> is in fact a JavaScript <code class=\"language-plaintext highlighter-rouge\">Function</code>, designed to be passed to Node’s HTTP servers as a callback to handle requests. This makes it easy to provide both HTTP and HTTPS versions of your app with the same code base, as the app does not inherit from these (it is simply a callback):</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst https = require('https')\nconst http = require('http')\nconst app = express()\n\nhttp.createServer(app).listen(80)\nhttps.createServer(options, app).listen(443)\n</pre></div>  <p>The <code class=\"language-plaintext highlighter-rouge\">app.listen()</code> method returns an <a href=\"https://nodejs.org/api/http.html#http_class_http_server\">http.Server</a> object and (for HTTP) is a convenience method for the following:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.listen = function () {\n  const server = http.createServer(this)\n  return server.listen.apply(server, arguments)\n}\n</pre></div>  <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>All the forms of Node’s <a href=\"https://nodejs.org/api/http.html#http_server_listen\">http.Server.listen()</a> method are in fact actually supported.</p> </div>   <h3 id=\"app.METHOD\">app.METHOD(path, callback [, callback ...])</h3> <p>Routes an HTTP request, where METHOD is the HTTP method of the request, such as GET, PUT, POST, and so on, in lowercase. Thus, the actual methods are <code class=\"language-plaintext highlighter-rouge\">app.get()</code>, <code class=\"language-plaintext highlighter-rouge\">app.post()</code>, <code class=\"language-plaintext highlighter-rouge\">app.put()</code>, and so on. See <a href=\"#routing-methods\">Routing methods</a> below for the complete list.</p> <h4>Arguments</h4> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Argument</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>path</code></td> <td> The path for which the middleware function is invoked. It can be any of the following: <ul> <li>A string representing a path.</li> <li>A path pattern.</li> <li>A regular expression pattern to match paths.</li> <li>An array containing any combination of the above.</li> </ul> For examples, see <a href=\"#path-examples\">Path examples</a>. </td> <td>\n<code>'/'</code> (root path)</td> </tr> <tr> <td><code>callback</code></td> <td> One or more callback functions. Accepted formats: <ul> <li>A single middleware function.</li> <li>Multiple middleware functions separated by commas.</li> <li>An array of middleware functions.</li> <li>A combination of the above.</li> </ul> <p> You may provide multiple callbacks that behave like middleware. These can call <code>next('route')</code> to skip remaining callbacks for the current route. This is useful for conditional routing logic. </p> <p> If a callback throws an error or returns a rejected promise, <code>next(err)</code> is invoked automatically. </p> <p> Since both <a href=\"#router\">router</a> and <a href=\"#application\">app</a> implement the middleware interface, they can also be used as callback middleware. </p> <p> For examples, see <a href=\"#middleware-callback-function-examples\">Middleware callback function examples</a>. </p> </td> <td><em>None</em></td> </tr> </tbody> </table> </div> <h4 id=\"routing-methods\">Routing methods</h4> <p>Express supports the following routing methods corresponding to the HTTP methods of the same names:</p> <div class=\"methods-columns\"> <ul> <li><code>checkout</code></li> <li><code>copy</code></li> <li><code>delete</code></li> <li><code>get</code></li> <li><code>head</code></li> <li><code>lock</code></li> <li><code>merge</code></li> <li><code>mkactivity</code></li> </ul> <ul> <li><code>mkcol</code></li> <li><code>move</code></li> <li><code>m-search</code></li> <li><code>notify</code></li> <li><code>options</code></li> <li><code>patch</code></li> <li><code>post</code></li> </ul> <ul> <li><code>purge</code></li> <li><code>put</code></li> <li><code>report</code></li> <li><code>search</code></li> <li><code>subscribe</code></li> <li><code>trace</code></li> <li><code>unlock</code></li> <li><code>unsubscribe</code></li> </ul> </div> <p>The API documentation has explicit entries only for the most popular HTTP methods <code class=\"language-plaintext highlighter-rouge\">app.get()</code>, <code class=\"language-plaintext highlighter-rouge\">app.post()</code>, <code class=\"language-plaintext highlighter-rouge\">app.put()</code>, and <code class=\"language-plaintext highlighter-rouge\">app.delete()</code>. However, the other methods listed above work in exactly the same way.</p> <p>To route methods that translate to invalid JavaScript variable names, use the bracket notation. For example, <code class=\"language-plaintext highlighter-rouge\">app['m-search']('/', function ...</code>.</p> <div class=\"doc-box doc-info\"> <p>The <code class=\"language-plaintext highlighter-rouge\">app.get()</code> function is automatically called for the HTTP <code class=\"language-plaintext highlighter-rouge\">HEAD</code> method in addition to the <code class=\"language-plaintext highlighter-rouge\">GET</code> method if <code class=\"language-plaintext highlighter-rouge\">app.head()</code> was not called for the path before <code class=\"language-plaintext highlighter-rouge\">app.get()</code>.</p> </div> <p>The method, <code class=\"language-plaintext highlighter-rouge\">app.all()</code>, is not derived from any HTTP method and loads middleware at the specified path for <em>all</em> HTTP request methods. For more information, see <a href=\"#app.all\">app.all</a>.</p> <p>For more information on routing, see the <a href=\"guide/routing\">routing guide</a>.</p>   <h3 id=\"app.param\">app.param(name, callback)</h3> <p>Add callback triggers to <a href=\"guide/routing#route-parameters\">route parameters</a>, where <code class=\"language-plaintext highlighter-rouge\">name</code> is the name of the parameter or an array of them, and <code class=\"language-plaintext highlighter-rouge\">callback</code> is the callback function. The parameters of the callback function are the request object, the response object, the next middleware, the value of the parameter and the name of the parameter, in that order.</p> <p>If <code class=\"language-plaintext highlighter-rouge\">name</code> is an array, the <code class=\"language-plaintext highlighter-rouge\">callback</code> trigger is registered for each parameter declared in it, in the order in which they are declared. Furthermore, for each declared parameter except the last one, a call to <code class=\"language-plaintext highlighter-rouge\">next</code> inside the callback will call the callback for the next declared parameter. For the last parameter, a call to <code class=\"language-plaintext highlighter-rouge\">next</code> will call the next middleware in place for the route currently being processed, just like it would if <code class=\"language-plaintext highlighter-rouge\">name</code> were just a string.</p> <p>For example, when <code class=\"language-plaintext highlighter-rouge\">:user</code> is present in a route path, you may map user loading logic to automatically provide <code class=\"language-plaintext highlighter-rouge\">req.user</code> to the route, or perform validations on the parameter input.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.param('user', (req, res, next, id) =&gt; {\n  // try to get the user details from the User model and attach it to the request object\n  User.find(id, (err, user) =&gt; {\n    if (err) {\n      next(err)\n    } else if (user) {\n      req.user = user\n      next()\n    } else {\n      next(new Error('failed to load user'))\n    }\n  })\n})\n</pre></div>  <p>Param callback functions are local to the router on which they are defined. They are not inherited by mounted apps or routers, nor are they triggered for route parameters inherited from parent routers. Hence, param callbacks defined on <code class=\"language-plaintext highlighter-rouge\">app</code> will be triggered only by route parameters defined on <code class=\"language-plaintext highlighter-rouge\">app</code> routes.</p> <p>All param callbacks will be called before any handler of any route in which the param occurs, and they will each be called only once in a request-response cycle, even if the parameter is matched in multiple routes, as shown in the following examples.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.param('id', (req, res, next, id) =&gt; {\n  console.log('CALLED ONLY ONCE')\n  next()\n})\n\napp.get('/user/:id', (req, res, next) =&gt; {\n  console.log('although this matches')\n  next()\n})\n\napp.get('/user/:id', (req, res) =&gt; {\n  console.log('and this matches too')\n  res.end()\n})\n</pre></div>  <p>On <code class=\"language-plaintext highlighter-rouge\">GET /user/42</code>, the following is printed:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">CALLED ONLY ONCE\nalthough this matches\nand this matches too\n</pre></div>  <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.param(['id', 'page'], (req, res, next, value) =&gt; {\n  console.log('CALLED ONLY ONCE with', value)\n  next()\n})\n\napp.get('/user/:id/:page', (req, res, next) =&gt; {\n  console.log('although this matches')\n  next()\n})\n\napp.get('/user/:id/:page', (req, res) =&gt; {\n  console.log('and this matches too')\n  res.end()\n})\n</pre></div>  <p>On <code class=\"language-plaintext highlighter-rouge\">GET /user/42/3</code>, the following is printed:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">CALLED ONLY ONCE with 42\nCALLED ONLY ONCE with 3\nalthough this matches\nand this matches too\n</pre></div>    <h3 id=\"app.path\">app.path()</h3> <p>Returns the canonical path of the app, a string.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const app = express()\nconst blog = express()\nconst blogAdmin = express()\n\napp.use('/blog', blog)\nblog.use('/admin', blogAdmin)\n\nconsole.log(app.path()) // ''\nconsole.log(blog.path()) // '/blog'\nconsole.log(blogAdmin.path()) // '/blog/admin'\n</pre></div>  <p>The behavior of this method can become very complicated in complex cases of mounted apps: it is usually better to use <a href=\"#req.baseUrl\">req.baseUrl</a> to get the canonical path of the app.</p>   <h3 id=\"app.post.method\">app.post(path, callback [, callback ...])</h3> <p>Routes HTTP POST requests to the specified path with the specified callback functions. For more information, see the <a href=\"guide/routing\">routing guide</a>.</p> <h4>Arguments</h4> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Argument</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>path</code></td> <td> The path for which the middleware function is invoked. It can be any of the following: <ul> <li>A string representing a path.</li> <li>A path pattern.</li> <li>A regular expression pattern to match paths.</li> <li>An array containing any combination of the above.</li> </ul> For examples, see <a href=\"#path-examples\">Path examples</a>. </td> <td>\n<code>'/'</code> (root path)</td> </tr> <tr> <td><code>callback</code></td> <td> One or more callback functions. Accepted formats: <ul> <li>A single middleware function.</li> <li>Multiple middleware functions separated by commas.</li> <li>An array of middleware functions.</li> <li>A combination of the above.</li> </ul> <p> You may provide multiple callbacks that behave like middleware. These can call <code>next('route')</code> to skip remaining callbacks for the current route. This is useful for conditional routing logic. </p> <p> If a callback throws an error or returns a rejected promise, <code>next(err)</code> is invoked automatically. </p> <p> Since both <a href=\"#router\">router</a> and <a href=\"#application\">app</a> implement the middleware interface, they can also be used as callback middleware. </p> <p> For examples, see <a href=\"#middleware-callback-function-examples\">Middleware callback function examples</a>. </p> </td> <td><em>None</em></td> </tr> </tbody> </table> </div> <h4 id=\"example-2\">Example</h4> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.post('/', (req, res) =&gt; {\n  res.send('POST request to homepage')\n})\n</pre></div>    <h3 id=\"app.put.method\">app.put(path, callback [, callback ...])</h3> <p>Routes HTTP PUT requests to the specified path with the specified callback functions.</p> <h4>Arguments</h4> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Argument</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>path</code></td> <td> The path for which the middleware function is invoked. It can be any of the following: <ul> <li>A string representing a path.</li> <li>A path pattern.</li> <li>A regular expression pattern to match paths.</li> <li>An array containing any combination of the above.</li> </ul> For examples, see <a href=\"#path-examples\">Path examples</a>. </td> <td>\n<code>'/'</code> (root path)</td> </tr> <tr> <td><code>callback</code></td> <td> One or more callback functions. Accepted formats: <ul> <li>A single middleware function.</li> <li>Multiple middleware functions separated by commas.</li> <li>An array of middleware functions.</li> <li>A combination of the above.</li> </ul> <p> You may provide multiple callbacks that behave like middleware. These can call <code>next('route')</code> to skip remaining callbacks for the current route. This is useful for conditional routing logic. </p> <p> If a callback throws an error or returns a rejected promise, <code>next(err)</code> is invoked automatically. </p> <p> Since both <a href=\"#router\">router</a> and <a href=\"#application\">app</a> implement the middleware interface, they can also be used as callback middleware. </p> <p> For examples, see <a href=\"#middleware-callback-function-examples\">Middleware callback function examples</a>. </p> </td> <td><em>None</em></td> </tr> </tbody> </table> </div> <h4 id=\"example-3\">Example</h4> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.put('/', (req, res) =&gt; {\n  res.send('PUT request to homepage')\n})\n</pre></div>    <h3 id=\"app.render\">app.render(view, [locals], callback)</h3> <p>Returns the rendered HTML of a view via the <code class=\"language-plaintext highlighter-rouge\">callback</code> function. It accepts an optional parameter that is an object containing local variables for the view. It is like <a href=\"#res.render\">res.render()</a>, except it cannot send the rendered view to the client on its own.</p> <div class=\"doc-box doc-info\"> <p>Think of <code class=\"language-plaintext highlighter-rouge\">app.render()</code> as a utility function for generating rendered view strings. Internally <code class=\"language-plaintext highlighter-rouge\">res.render()</code> uses <code class=\"language-plaintext highlighter-rouge\">app.render()</code> to render views.</p> </div> <div class=\"doc-box doc-warn\"> <p>The <code class=\"language-plaintext highlighter-rouge\">view</code> argument performs file system operations like reading a file from disk and evaluating Node.js modules, and as so for security reasons should not contain input from the end-user.</p> </div> <div class=\"doc-box doc-warn\"> <p>The <code class=\"language-plaintext highlighter-rouge\">locals</code> object is used by view engines to render a response. The object keys may be particularly sensitive and should not contain user-controlled input, as it may affect the operation of the view engine or provide a path to cross-site scripting. Consult the documentation for the used view engine for additional considerations.</p> </div> <div class=\"doc-box doc-notice\"> <p>The local variable <code class=\"language-plaintext highlighter-rouge\">cache</code> is reserved for enabling view cache. Set it to <code class=\"language-plaintext highlighter-rouge\">true</code>, if you want to cache view during development; view caching is enabled in production by default.</p> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.render('email', (err, html) =&gt; {\n  // ...\n})\n\napp.render('email', { name: 'Tobi' }, (err, html) =&gt; {\n  // ...\n})\n</pre></div>    <h3 id=\"app.route\">app.route(path)</h3> <p>Returns an instance of a single route, which you can then use to handle HTTP verbs with optional middleware. Use <code class=\"language-plaintext highlighter-rouge\">app.route()</code> to avoid duplicate route names (and thus typo errors).</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const app = express()\n\napp.route('/events')\n  .all((req, res, next) =&gt; {\n    // runs for all HTTP verbs first\n    // think of it as route specific middleware!\n  })\n  .get((req, res, next) =&gt; {\n    res.json({})\n  })\n  .post((req, res, next) =&gt; {\n    // maybe add a new event...\n  })\n</pre></div>    <h3 id=\"app.set\">app.set(name, value)</h3> <p>Assigns setting <code class=\"language-plaintext highlighter-rouge\">name</code> to <code class=\"language-plaintext highlighter-rouge\">value</code>. You may store any value that you want, but certain names can be used to configure the behavior of the server. These special names are listed in the <a href=\"#app.settings.table\">app settings table</a>.</p> <p>Calling <code class=\"language-plaintext highlighter-rouge\">app.set('foo', true)</code> for a Boolean property is the same as calling <code class=\"language-plaintext highlighter-rouge\">app.enable('foo')</code>. Similarly, calling <code class=\"language-plaintext highlighter-rouge\">app.set('foo', false)</code> for a Boolean property is the same as calling <code class=\"language-plaintext highlighter-rouge\">app.disable('foo')</code>.</p> <p>Retrieve the value of a setting with <a href=\"#app.get\"><code class=\"language-plaintext highlighter-rouge\">app.get()</code></a>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.set('title', 'My Site')\napp.get('title') // \"My Site\"\n</pre></div>  <h4 id=\"app.settings.table\">Application Settings</h4> <p>The following table lists application settings.</p> <p>Note that sub-apps will:</p> <ul> <li>Not inherit the value of settings that have a default value. You must set the value in the sub-app.</li> <li>Inherit the value of settings with no default value; these are explicitly noted in the table below.</li> </ul> <p>Exceptions: Sub-apps will inherit the value of <code class=\"language-plaintext highlighter-rouge\">trust proxy</code> even though it has a default value (for backward-compatibility); Sub-apps will not inherit the value of <code class=\"language-plaintext highlighter-rouge\">view cache</code> in production (when <code class=\"language-plaintext highlighter-rouge\">NODE_ENV</code> is “production”).</p> <div class=\"table-scroller\"> <table> <thead><tr>\n<th id=\"app-settings-property\">Property</th>\n<th>Type</th>\n<th>Description</th>\n<th>Default</th>\n</tr></thead> <tbody> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">case sensitive routing</code></p> </td> <td>Boolean</td> <td>\n<p>Enable case sensitivity. When enabled, \"/Foo\" and \"/foo\" are different routes. When disabled, \"/Foo\" and \"/foo\" are treated the same.</p> <p><b>NOTE</b>: Sub-apps will inherit the value of this setting.</p> </td> <td>N/A (undefined) </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">env</code></p> </td> <td>String</td> <td>Environment mode. Be sure to set to \"production\" in a production environment; see <a href=\"https://expressjs.com/advanced/best-practice-performance.html#env\">Production best practices: performance and reliability</a>. </td> <td> <p><code class=\"language-plaintext highlighter-rouge\">process.env.NODE_ENV</code> (<code class=\"language-plaintext highlighter-rouge\">NODE_ENV</code> environment variable) or “development” if <code class=\"language-plaintext highlighter-rouge\">NODE_ENV</code> is not set.</p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">etag</code></p> </td> <td>Varied</td> <td> <p>Set the ETag response header. For possible values, see the <a href=\"#etag.options.table\"><code class=\"language-plaintext highlighter-rouge\">etag</code> options table</a>.</p> <p><a href=\"http://en.wikipedia.org/wiki/HTTP_ETag\">More about the HTTP ETag header</a>.</p> </td> <td> <p><code class=\"language-plaintext highlighter-rouge\">weak</code></p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">jsonp callback name</code></p> </td> <td>String</td> <td>Specifies the default JSONP callback name.</td> <td> <p>“callback”</p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">json escape</code></p> </td> <td>Boolean</td> <td> <p>Enable escaping JSON responses from the <code class=\"language-plaintext highlighter-rouge\">res.json</code>, <code class=\"language-plaintext highlighter-rouge\">res.jsonp</code>, and <code class=\"language-plaintext highlighter-rouge\">res.send</code> APIs. This will escape the characters <code class=\"language-plaintext highlighter-rouge\">&lt;</code>, <code class=\"language-plaintext highlighter-rouge\">&gt;</code>, and <code class=\"language-plaintext highlighter-rouge\">&amp;</code> as Unicode escape sequences in JSON. The purpose of this is to assist with <a href=\"https://blog.mozilla.org/security/2017/07/18/web-service-audits-firefox-accounts/\">mitigating certain types of persistent XSS attacks</a> when clients sniff responses for HTML.</p> <p><b>NOTE</b>: Sub-apps will inherit the value of this setting.</p> </td> <td>N/A (undefined)</td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">json replacer</code></p> </td> <td>Varied</td> <td>The <a href=\"https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#The_replacer_parameter\">'replacer' argument used by `JSON.stringify`</a>. <p><b>NOTE</b>: Sub-apps will inherit the value of this setting.</p> </td> <td>N/A (undefined) </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">json spaces</code></p> </td> <td>Varied</td> <td>The <a href=\"https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#The_space_argument\">'space' argument used by `JSON.stringify`</a>. This is typically set to the number of spaces to use to indent prettified JSON. <p><b>NOTE</b>: Sub-apps will inherit the value of this setting.</p> </td> <td>N/A (undefined)</td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">query parser</code></p> </td> <td>Varied</td> <td> <p>Disable query parsing by setting the value to <code class=\"language-plaintext highlighter-rouge\">false</code>, or set the query parser to use either “simple” or “extended” or a custom query string parsing function.</p> <p>The simple query parser is based on Node’s native query parser, <a href=\"http://nodejs.org/api/querystring.html\">querystring</a>.</p> <p>The extended query parser is based on <a href=\"https://www.npmjs.org/package/qs\">qs</a>.</p> <p>A custom query string parsing function will receive the complete query string, and must return an object of query keys and their values.</p> </td> <td>\"simple\"</td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">strict routing</code></p> </td> <td>Boolean</td> <td>\n<p>Enable strict routing. When enabled, the router treats \"/foo\" and \"/foo/\" as different. Otherwise, the router treats \"/foo\" and \"/foo/\" as the same.</p> <p><b>NOTE</b>: Sub-apps will inherit the value of this setting.</p> </td> <td>N/A (undefined) </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">subdomain offset</code></p> </td> <td>Number</td> <td>The number of dot-separated parts of the host to remove to access subdomain.</td> <td>2</td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">trust proxy</code></p> </td> <td>Varied</td> <td> <p>Indicates the app is behind a front-facing proxy, and to use the <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-*</code> headers to determine the connection and the IP address of the client. NOTE: <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-*</code> headers are easily spoofed and the detected IP addresses are unreliable.</p> <p> When enabled, Express attempts to determine the IP address of the client connected through the front-facing proxy, or series of proxies. The `req.ips` property, then contains an array of IP addresses the client is connected through. To enable it, use the values described in the <a href=\"#trust.proxy.options.table\">trust proxy options table</a>. </p> <p> The `trust proxy` setting is implemented using the <a href=\"https://www.npmjs.org/package/proxy-addr\">proxy-addr</a> package. For more information, see its documentation. </p> <p> <b>NOTE</b>: Sub-apps <i>will</i> inherit the value of this setting, even though it has a default value. </p> </td> <td> <p><code class=\"language-plaintext highlighter-rouge\">false</code> (disabled)</p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">views</code></p> </td> <td>String or Array</td> <td>A directory or an array of directories for the application's views. If an array, the views are looked up in the order they occur in the array.</td> <td> <p><code class=\"language-plaintext highlighter-rouge\">process.cwd() + '/views'</code></p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">view cache</code></p> </td> <td>Boolean</td> <td>\n<p>Enables view template compilation caching.</p> <p><b>NOTE</b>: Sub-apps will not inherit the value of this setting in production (when `NODE_ENV` is \"production\").</p> </td> <td> <p><code class=\"language-plaintext highlighter-rouge\">true</code> in production, otherwise undefined.</p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">view engine</code></p> </td> <td>String</td> <td>The default engine extension to use when omitted. <p><b>NOTE</b>: Sub-apps will inherit the value of this setting.</p> </td> <td>N/A (undefined)</td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">x-powered-by</code></p> </td> <td>Boolean</td> <td>Enables the \"X-Powered-By: Express\" HTTP header.</td> <td> <p><code class=\"language-plaintext highlighter-rouge\">true</code></p> </td> </tr> </tbody> </table> </div> <h5 id=\"trust.proxy.options.table\">Options for `trust proxy` setting</h5> <p> Read <a href=\"guide/behind-proxies\">Express behind proxies</a> for more information. </p> <div class=\"table-scroller\"> <table> <thead><tr>\n<th>Type</th>\n<th>Value</th>\n</tr></thead> <tbody> <tr> <td>Boolean</td> <td> <p>If <code class=\"language-plaintext highlighter-rouge\">true</code>, the client’s IP address is understood as the left-most entry in the <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-*</code> header.</p> <p>If <code class=\"language-plaintext highlighter-rouge\">false</code>, the app is understood as directly facing the Internet and the client’s IP address is derived from <code class=\"language-plaintext highlighter-rouge\">req.connection.remoteAddress</code>. This is the default setting.</p> </td> </tr> <tr> <td>String<br>String containing comma-separated values<br>Array of strings </td> <td> <p>An IP address, subnet, or an array of IP addresses, and subnets to trust. Pre-configured subnet names are:</p> <ul> <li>loopback - <code class=\"language-plaintext highlighter-rouge\">127.0.0.1/8</code>, <code class=\"language-plaintext highlighter-rouge\">::1/128</code>\n</li> <li>linklocal - <code class=\"language-plaintext highlighter-rouge\">169.254.0.0/16</code>, <code class=\"language-plaintext highlighter-rouge\">fe80::/10</code>\n</li> <li>uniquelocal - <code class=\"language-plaintext highlighter-rouge\">10.0.0.0/8</code>, <code class=\"language-plaintext highlighter-rouge\">172.16.0.0/12</code>, <code class=\"language-plaintext highlighter-rouge\">192.168.0.0/16</code>, <code class=\"language-plaintext highlighter-rouge\">fc00::/7</code>\n</li> </ul> <p>Set IP addresses in any of the following ways:</p> <p>Specify a single subnet:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.set('trust proxy', 'loopback')\n</pre></div>  <p>Specify a subnet and an address:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.set('trust proxy', 'loopback, 123.123.123.123')\n</pre></div>  <p>Specify multiple subnets as CSV:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.set('trust proxy', 'loopback, linklocal, uniquelocal')\n</pre></div>  <p>Specify multiple subnets as an array:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.set('trust proxy', ['loopback', 'linklocal', 'uniquelocal'])\n</pre></div>  <p>When specified, the IP addresses or the subnets are excluded from the address determination process, and the untrusted IP address nearest to the application server is determined as the client’s IP address.</p> </td> </tr> <tr> <td>Number</td> <td> <p>Trust the <i>n</i><sup>th</sup> hop from the front-facing proxy server as the client.</p> </td> </tr> <tr> <td>Function</td> <td> <p>Custom trust implementation. Use this only if you know what you are doing.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.set('trust proxy', (ip) =&gt; {\n  if (ip === '127.0.0.1' || ip === '123.123.123.123') return true // trusted IPs\n  else return false\n})\n</pre></div>  </td> </tr> </tbody> </table> </div> <h5 id=\"etag.options.table\">Options for `etag` setting</h5> <p> <strong>NOTE</strong>: These settings apply only to dynamic files, not static files. The <a href=\"#express.static\">express.static</a> middleware ignores these settings. </p> <p> The ETag functionality is implemented using the <a href=\"https://www.npmjs.org/package/etag\">etag</a> package. For more information, see its documentation. </p> <div class=\"table-scroller\"> <table> <thead><tr>\n<th>Type</th>\n<th>Value</th>\n</tr></thead> <tbody> <tr> <td>Boolean</td> <td> <p><code class=\"language-plaintext highlighter-rouge\">true</code> enables weak ETag. This is the default setting.<br> <code class=\"language-plaintext highlighter-rouge\">false</code> disables ETag altogether.</p> </td> </tr> <tr> <td>String</td> <td> If \"strong\", enables strong ETag.<br> If \"weak\", enables weak ETag. </td> </tr> <tr> <td>Function</td> <td> <p>Custom ETag function implementation. Use this only if you know what you are doing.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.set('etag', (body, encoding) =&gt; {\n  return generateHash(body, encoding) // consider the function is defined\n})\n</pre></div>  </td> </tr> </tbody> </table> </div>   <h3 id=\"app.use\">app.use([path,] callback [, callback...])</h3> <p>Mounts the specified <a href=\"guide/using-middleware\">middleware</a> function or functions at the specified path: the middleware function is executed when the base of the requested path matches <code class=\"language-plaintext highlighter-rouge\">path</code>.</p> <h4>Arguments</h4> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Argument</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>path</code></td> <td> The path for which the middleware function is invoked. It can be any of the following: <ul> <li>A string representing a path.</li> <li>A path pattern.</li> <li>A regular expression pattern to match paths.</li> <li>An array containing any combination of the above.</li> </ul> For examples, see <a href=\"#path-examples\">Path examples</a>. </td> <td>\n<code>'/'</code> (root path)</td> </tr> <tr> <td><code>callback</code></td> <td> One or more callback functions. Accepted formats: <ul> <li>A single middleware function.</li> <li>Multiple middleware functions separated by commas.</li> <li>An array of middleware functions.</li> <li>A combination of the above.</li> </ul> <p> You may provide multiple callbacks that behave like middleware. These can call <code>next('route')</code> to skip remaining callbacks for the current route. This is useful for conditional routing logic. </p> <p> If a callback throws an error or returns a rejected promise, <code>next(err)</code> is invoked automatically. </p> <p> Since both <a href=\"#router\">router</a> and <a href=\"#application\">app</a> implement the middleware interface, they can also be used as callback middleware. </p> <p> For examples, see <a href=\"#middleware-callback-function-examples\">Middleware callback function examples</a>. </p> </td> <td><em>None</em></td> </tr> </tbody> </table> </div> <h4 id=\"description\">Description</h4> <p>A route will match any path that follows its path immediately with a “<code class=\"language-plaintext highlighter-rouge\">/</code>”. For example: <code class=\"language-plaintext highlighter-rouge\">app.use('/apple', ...)</code> will match “/apple”, “/apple/images”, “/apple/images/news”, and so on.</p> <p>Since <code class=\"language-plaintext highlighter-rouge\">path</code> defaults to “/”, middleware mounted without a path will be executed for every request to the app. For example, this middleware function will be executed for <em>every</em> request to the app:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use((req, res, next) =&gt; {\n  console.log('Time: %d', Date.now())\n  next()\n})\n</pre></div>  <div class=\"doc-box doc-info\"> <p><strong>NOTE</strong></p> <p>Sub-apps will:</p> <ul> <li>Not inherit the value of settings that have a default value. You must set the value in the sub-app.</li> <li>Inherit the value of settings with no default value.</li> </ul> <p>For details, see <a href=\"5x/api#app.settings.table\">Application settings</a>.</p> </div> <p>Middleware functions are executed sequentially, therefore the order of middleware inclusion is important.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// this middleware will not allow the request to go beyond it\napp.use((req, res, next) =&gt; {\n  res.send('Hello World')\n})\n\n// requests will never reach this route\napp.get('/', (req, res) =&gt; {\n  res.send('Welcome')\n})\n</pre></div>  <p><strong>Error-handling middleware</strong></p> <p>Error-handling middleware always takes <em>four</em> arguments. You must provide four arguments to identify it as an error-handling middleware function. Even if you don’t need to use the <code class=\"language-plaintext highlighter-rouge\">next</code> object, you must specify it to maintain the signature. Otherwise, the <code class=\"language-plaintext highlighter-rouge\">next</code> object will be interpreted as regular middleware and will fail to handle errors. For details about error-handling middleware, see: <a href=\"guide/error-handling\">Error handling</a>.</p> <p>Define error-handling middleware functions in the same way as other middleware functions, except with four arguments instead of three, specifically with the signature <code class=\"language-plaintext highlighter-rouge\">(err, req, res, next)</code>):</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use((err, req, res, next) =&gt; {\n  console.error(err.stack)\n  res.status(500).send('Something broke!')\n})\n</pre></div>  <h4 id=\"path-examples\">Path examples</h4> <p>The following table provides some simple examples of valid <code class=\"language-plaintext highlighter-rouge\">path</code> values for mounting middleware.</p> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Type</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td>Path</td> <td> <p>Matches the exact path <code class=\"language-plaintext highlighter-rouge\">/abcd</code> and any sub-paths starting with <code class=\"language-plaintext highlighter-rouge\">/abcd/</code> (for example, <code class=\"language-plaintext highlighter-rouge\">/abcd/foo</code>):</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use('/abcd', (req, res, next) =&gt; {\n  next()\n})\n</pre></div>  </td> </tr> <tr> <td>Path Pattern</td> <td> <p>This will match paths starting with <code class=\"language-plaintext highlighter-rouge\">/abcd</code> and <code class=\"language-plaintext highlighter-rouge\">/abd</code>:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use('/ab{c}d', (req, res, next) =&gt; {\n  next()\n})\n</pre></div>  </td> </tr> <tr> <td>Regular Expression</td> <td> <p>This will match paths starting with <code class=\"language-plaintext highlighter-rouge\">/abc</code> and <code class=\"language-plaintext highlighter-rouge\">/xyz</code>:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use(/\\/abc|\\/xyz/, (req, res, next) =&gt; {\n  next()\n})\n</pre></div>  </td> </tr> <tr> <td>Array</td> <td> <p>This will match paths starting with <code class=\"language-plaintext highlighter-rouge\">/abcd</code>, <code class=\"language-plaintext highlighter-rouge\">/xyza</code>, <code class=\"language-plaintext highlighter-rouge\">/lmn</code>, and <code class=\"language-plaintext highlighter-rouge\">/pqr</code>:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use(['/abcd', '/xyza', /\\/lmn|\\/pqr/], (req, res, next) =&gt; {\n  next()\n})\n</pre></div>  </td> </tr> </tbody> </table> </div> <h4 id=\"middleware-callback-function-examples\">Middleware callback function examples</h4> <p>The following table provides some simple examples of middleware functions that can be used as the <code class=\"language-plaintext highlighter-rouge\">callback</code> argument to <code class=\"language-plaintext highlighter-rouge\">app.use()</code>, <code class=\"language-plaintext highlighter-rouge\">app.METHOD()</code>, and <code class=\"language-plaintext highlighter-rouge\">app.all()</code>.</p> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Usage</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td>Single Middleware</td> <td> <p>You can define and mount a middleware function locally.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use((req, res, next) =&gt; {\n  next()\n})\n</pre></div>  <p>A router is valid middleware.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const router = express.Router()\nrouter.get('/', (req, res, next) =&gt; {\n  next()\n})\napp.use(router)\n</pre></div>  <p>An Express app is valid middleware.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const subApp = express()\nsubApp.get('/', (req, res, next) =&gt; {\n  next()\n})\napp.use(subApp)\n</pre></div>  </td> </tr> <tr> <td>Series of Middleware</td> <td> <p>You can specify more than one middleware function at the same mount path.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const r1 = express.Router()\nr1.get('/', (req, res, next) =&gt; {\n  next()\n})\n\nconst r2 = express.Router()\nr2.get('/', (req, res, next) =&gt; {\n  next()\n})\n\napp.use(r1, r2)\n</pre></div>  </td> </tr> <tr> <td>Array</td> <td> <p>Use an array to group middleware logically.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const r1 = express.Router()\nr1.get('/', (req, res, next) =&gt; {\n  next()\n})\n\nconst r2 = express.Router()\nr2.get('/', (req, res, next) =&gt; {\n  next()\n})\n\napp.use([r1, r2])\n</pre></div>  </td> </tr> <tr> <td>Combination</td> <td> <p>You can combine all the above ways of mounting middleware.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">function mw1 (req, res, next) { next() }\nfunction mw2 (req, res, next) { next() }\n\nconst r1 = express.Router()\nr1.get('/', (req, res, next) =&gt; { next() })\n\nconst r2 = express.Router()\nr2.get('/', (req, res, next) =&gt; { next() })\n\nconst subApp = express()\nsubApp.get('/', (req, res, next) =&gt; { next() })\n\napp.use(mw1, [mw2, r1, r2], subApp)\n</pre></div>  </td> </tr> </tbody> </table> </div> <p>Following are some examples of using the <a href=\"guide/using-middleware#middleware.built-in\">express.static</a> middleware in an Express app.</p> <p>Serve static content for the app from the “public” directory in the application directory:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// GET /style.css etc\napp.use(express.static(path.join(__dirname, 'public')))\n</pre></div>  <p>Mount the middleware at “/static” to serve static content only when their request path is prefixed with “/static”:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// GET /static/style.css etc.\napp.use('/static', express.static(path.join(__dirname, 'public')))\n</pre></div>  <p>Disable logging for static content requests by loading the logger middleware after the static middleware:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use(express.static(path.join(__dirname, 'public')))\napp.use(logger())\n</pre></div>  <p>Serve static files from multiple directories, but give precedence to “./public” over the others:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use(express.static(path.join(__dirname, 'public')))\napp.use(express.static(path.join(__dirname, 'files')))\napp.use(express.static(path.join(__dirname, 'uploads')))\n</pre></div>   <h2 id=\"req\">Request</h2> <p>The <code class=\"language-plaintext highlighter-rouge\">req</code> object represents the HTTP request and has properties for the request query string, parameters, body, HTTP headers, and so on. In this documentation and by convention, the object is always referred to as <code class=\"language-plaintext highlighter-rouge\">req</code> (and the HTTP response is <code class=\"language-plaintext highlighter-rouge\">res</code>) but its actual name is determined by the parameters to the callback function in which you’re working.</p> <p>For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/user/:id', (req, res) =&gt; {\n  res.send(`user ${req.params.id}`)\n})\n</pre></div>  <p>But you could just as well have:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/user/:id', (request, response) =&gt; {\n  response.send(`user ${request.params.id}`)\n})\n</pre></div>  <p>The <code class=\"language-plaintext highlighter-rouge\">req</code> object is an enhanced version of Node’s own request object and supports all <a href=\"https://nodejs.org/api/http.html#http_class_http_incomingmessage\">built-in fields and methods</a>.</p> <h3 id=\"req.properties\">Properties</h3> <div class=\"doc-box doc-notice\"> <p>In Express 4, <code class=\"language-plaintext highlighter-rouge\">req.files</code> is no longer available on the <code class=\"language-plaintext highlighter-rouge\">req</code> object by default. To access uploaded files on the <code class=\"language-plaintext highlighter-rouge\">req.files</code> object, use multipart-handling middleware like <a href=\"#\">busboy</a>, <a href=\"https://www.npmjs.com/package/multer\">multer</a>, <a href=\"https://www.npmjs.com/package/formidable\">formidable</a>, <a href=\"https://www.npmjs.com/package/multiparty\">multiparty</a>, <a href=\"https://www.npmjs.com/package/connect-multiparty\">connect-multiparty</a>, or <a href=\"https://www.npmjs.com/package/pez\">pez</a>.</p> </div>  <h3 id=\"req.app\">req.app</h3> <p>This property holds a reference to the instance of the Express application that is using the middleware.</p> <p>If you follow the pattern in which you create a module that just exports a middleware function and <code class=\"language-plaintext highlighter-rouge\">require()</code> it in your main file, then the middleware can access the Express instance via <code class=\"language-plaintext highlighter-rouge\">req.app</code></p> <p>For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// index.js\napp.get('/viewdirectory', require('./mymiddleware.js'))\n</pre></div>  <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// mymiddleware.js\nmodule.exports = (req, res) =&gt; {\n  res.send(`The views directory is ${req.app.get('views')}`)\n}\n</pre></div>    <h3 id=\"req.baseUrl\">req.baseUrl</h3> <p>The URL path on which a router instance was mounted.</p> <p>The <code class=\"language-plaintext highlighter-rouge\">req.baseUrl</code> property is similar to the <a href=\"#app.mountpath\">mountpath</a> property of the <code class=\"language-plaintext highlighter-rouge\">app</code> object, except <code class=\"language-plaintext highlighter-rouge\">app.mountpath</code> returns the matched path pattern(s).</p> <p>For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const greet = express.Router()\n\ngreet.get('/jp', (req, res) =&gt; {\n  console.log(req.baseUrl) // /greet\n  res.send('Konichiwa!')\n})\n\napp.use('/greet', greet) // load the router on '/greet'\n</pre></div>  <p>Even if you use a path pattern or a set of path patterns to load the router, the <code class=\"language-plaintext highlighter-rouge\">baseUrl</code> property returns the matched string, not the pattern(s). In the following example, the <code class=\"language-plaintext highlighter-rouge\">greet</code> router is loaded on two path patterns.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use(['/gre:\"param\"t', '/hel{l}o'], greet) // load the router on '/gre:\"param\"t' and '/hel{l}o'\n</pre></div>  <p>When a request is made to <code class=\"language-plaintext highlighter-rouge\">/greet/jp</code>, <code class=\"language-plaintext highlighter-rouge\">req.baseUrl</code> is “/greet”. When a request is made to <code class=\"language-plaintext highlighter-rouge\">/hello/jp</code>, <code class=\"language-plaintext highlighter-rouge\">req.baseUrl</code> is “/hello”.</p>   <h3 id=\"req.body\">req.body</h3> <p>Contains key-value pairs of data submitted in the request body. By default, it is <code class=\"language-plaintext highlighter-rouge\">undefined</code>, and is populated when you use body-parsing middleware such as <a href=\"#express.json\"><code class=\"language-plaintext highlighter-rouge\">express.json()</code></a> or <a href=\"#express.urlencoded\"><code class=\"language-plaintext highlighter-rouge\">express.urlencoded()</code></a>.</p> <div class=\"doc-box doc-warn\"> <p>As <code class=\"language-plaintext highlighter-rouge\">req.body</code>’s shape is based on user-controlled input, all properties and values in this object are untrusted and should be validated before trusting. For example, <code class=\"language-plaintext highlighter-rouge\">req.body.foo.toString()</code> may fail in multiple ways, for example <code class=\"language-plaintext highlighter-rouge\">foo</code> may not be there or may not be a string, and <code class=\"language-plaintext highlighter-rouge\">toString</code> may not be a function and instead a string or other user-input.</p> </div> <p>The following example shows how to use body-parsing middleware to populate <code class=\"language-plaintext highlighter-rouge\">req.body</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\n\nconst app = express()\n\napp.use(express.json()) // for parsing application/json\napp.use(express.urlencoded({ extended: true })) // for parsing application/x-www-form-urlencoded\n\napp.post('/profile', (req, res, next) =&gt; {\n  console.log(req.body)\n  res.json(req.body)\n})\n</pre></div>    <h3 id=\"req.cookies\">req.cookies</h3> <p>When using <a href=\"https://www.npmjs.com/package/cookie-parser\">cookie-parser</a> middleware, this property is an object that contains cookies sent by the request. If the request contains no cookies, it defaults to <code class=\"language-plaintext highlighter-rouge\">{}</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// Cookie: name=tj\nconsole.dir(req.cookies.name)\n// =&gt; \"tj\"\n</pre></div>  <p>If the cookie has been signed, you have to use <a href=\"#req.signedCookies\">req.signedCookies</a>.</p> <p>For more information, issues, or concerns, see <a href=\"https://github.com/expressjs/cookie-parser\">cookie-parser</a>.</p>   <h3 id=\"req.fresh\">req.fresh</h3> <p>When the response is still “fresh” in the client’s cache <code class=\"language-plaintext highlighter-rouge\">true</code> is returned, otherwise <code class=\"language-plaintext highlighter-rouge\">false</code> is returned to indicate that the client cache is now stale and the full response should be sent.</p> <p>When a client sends the <code class=\"language-plaintext highlighter-rouge\">Cache-Control: no-cache</code> request header to indicate an end-to-end reload request, this module will return <code class=\"language-plaintext highlighter-rouge\">false</code> to make handling these requests transparent.</p> <p>Further details for how cache validation works can be found in the <a href=\"https://tools.ietf.org/html/rfc7234\">HTTP/1.1 Caching Specification</a>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">console.dir(req.fresh)\n// =&gt; true\n</pre></div>    <h3 id=\"req.host\">req.host</h3> <p>Contains the host derived from the <code class=\"language-plaintext highlighter-rouge\">Host</code> HTTP header.</p> <p>When the <a href=\"5x/api#app.settings.table\"><code class=\"language-plaintext highlighter-rouge\">trust proxy</code> setting</a> does not evaluate to <code class=\"language-plaintext highlighter-rouge\">false</code>, this property will instead get the value from the <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-Host</code> header field. This header can be set by the client or by the proxy.</p> <p>If there is more than one <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-Host</code> header in the request, the value of the first header is used. This includes a single header with comma-separated values, in which the first value is used.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// Host: \"example.com:3000\"\nconsole.dir(req.host)\n// =&gt; 'example.com:3000'\n\n// Host: \"[::1]:3000\"\nconsole.dir(req.host)\n// =&gt; '[::1]:3000'\n</pre></div>    <h3 id=\"req.hostname\">req.hostname</h3> <p>Contains the hostname derived from the <code class=\"language-plaintext highlighter-rouge\">Host</code> HTTP header.</p> <p>When the <a href=\"https://expressjs.com/5x/api.html#trust.proxy.options.table\"><code class=\"language-plaintext highlighter-rouge\">trust proxy</code> setting</a> does not evaluate to <code class=\"language-plaintext highlighter-rouge\">false</code>, this property will instead get the value from the <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-Host</code> header field. This header can be set by the client or by the proxy.</p> <p>If there is more than one <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-Host</code> header in the request, the value of the first header is used. This includes a single header with comma-separated values, in which the first value is used.</p> <div class=\"doc-box doc-info\"> <p>Prior to Express v4.17.0, the <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-Host</code> could not contain multiple values or be present more than once.</p> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// Host: \"example.com:3000\"\nconsole.dir(req.hostname)\n// =&gt; 'example.com'\n</pre></div>    <h3 id=\"req.ip\">req.ip</h3> <p>Contains the remote IP address of the request.</p> <p>When the <a href=\"https://expressjs.com/5x/api.html#trust.proxy.options.table\"><code class=\"language-plaintext highlighter-rouge\">trust proxy</code> setting</a> does not evaluate to <code class=\"language-plaintext highlighter-rouge\">false</code>, the value of this property is derived from the left-most entry in the <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-For</code> header. This header can be set by the client or by the proxy.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">console.dir(req.ip)\n// =&gt; \"127.0.0.1\"\n</pre></div>    <h3 id=\"req.ips\">req.ips</h3> <p>When the <a href=\"https://expressjs.com/5x/api.html#trust.proxy.options.table\"><code class=\"language-plaintext highlighter-rouge\">trust proxy</code> setting</a> does not evaluate to <code class=\"language-plaintext highlighter-rouge\">false</code>, this property contains an array of IP addresses specified in the <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-For</code> request header. Otherwise, it contains an empty array. This header can be set by the client or by the proxy.</p> <p>For example, if <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-For</code> is <code class=\"language-plaintext highlighter-rouge\">client, proxy1, proxy2</code>, <code class=\"language-plaintext highlighter-rouge\">req.ips</code> would be <code class=\"language-plaintext highlighter-rouge\">[\"client\", \"proxy1\", \"proxy2\"]</code>, where <code class=\"language-plaintext highlighter-rouge\">proxy2</code> is the furthest downstream.</p>   <h3 id=\"req.method\">req.method</h3> <p>Contains a string corresponding to the HTTP method of the request: <code class=\"language-plaintext highlighter-rouge\">GET</code>, <code class=\"language-plaintext highlighter-rouge\">POST</code>, <code class=\"language-plaintext highlighter-rouge\">PUT</code>, and so on.</p>   <h3 id=\"req.originalUrl\">req.originalUrl</h3> <div class=\"doc-box doc-notice\"> <p><code class=\"language-plaintext highlighter-rouge\">req.url</code> is not a native Express property, it is inherited from Node’s <a href=\"https://nodejs.org/api/http.html#http_message_url\">http module</a>.</p> </div> <p>This property is much like <code class=\"language-plaintext highlighter-rouge\">req.url</code>; however, it retains the original request URL, allowing you to rewrite <code class=\"language-plaintext highlighter-rouge\">req.url</code> freely for internal routing purposes. For example, the “mounting” feature of <a href=\"#app.use\">app.use()</a> will rewrite <code class=\"language-plaintext highlighter-rouge\">req.url</code> to strip the mount point.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// GET /search?q=something\nconsole.dir(req.originalUrl)\n// =&gt; \"/search?q=something\"\n</pre></div>  <p><code class=\"language-plaintext highlighter-rouge\">req.originalUrl</code> is available both in middleware and router objects, and is a combination of <code class=\"language-plaintext highlighter-rouge\">req.baseUrl</code> and <code class=\"language-plaintext highlighter-rouge\">req.url</code>. Consider following example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// GET 'http://www.example.com/admin/new?sort=desc'\napp.use('/admin', (req, res, next) =&gt; {\n  console.dir(req.originalUrl) // '/admin/new?sort=desc'\n  console.dir(req.baseUrl) // '/admin'\n  console.dir(req.path) // '/new'\n  next()\n})\n</pre></div>    <h3 id=\"req.params\">req.params</h3> <p>This property is an object containing properties mapped to the <a href=\"guide/routing#route-parameters\">named route “parameters”</a>. For example, if you have the route <code class=\"language-plaintext highlighter-rouge\">/user/:name</code>, then the “name” property is available as <code class=\"language-plaintext highlighter-rouge\">req.params.name</code>. This object defaults to <code class=\"language-plaintext highlighter-rouge\">{}</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// GET /user/tj\nconsole.dir(req.params.name)\n// =&gt; \"tj\"\n</pre></div>  <p>When you use a regular expression for the route definition, capture groups are provided in the array using <code class=\"language-plaintext highlighter-rouge\">req.params[n]</code>, where <code class=\"language-plaintext highlighter-rouge\">n</code> is the n<sup>th</sup> capture group.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use(/^\\/file\\/(.*)$/, (req, res) =&gt; {\n  // GET /file/javascripts/jquery.js\n  console.dir(req.params[0])\n  // =&gt; \"javascripts/jquery.js\"\n})\n</pre></div>  <p>If you need to make changes to a key in <code class=\"language-plaintext highlighter-rouge\">req.params</code>, use the <a href=\"5x/api#app.param\">app.param</a> handler. Changes are applicable only to <a href=\"guide/routing#route-parameters\">parameters</a> already defined in the route path.</p> <p>Any changes made to the <code class=\"language-plaintext highlighter-rouge\">req.params</code> object in a middleware or route handler will be reset.</p> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>Express automatically decodes the values in <code class=\"language-plaintext highlighter-rouge\">req.params</code> (using <code class=\"language-plaintext highlighter-rouge\">decodeURIComponent</code>).</p> </div>   <h3 id=\"req.path\">req.path</h3> <p>Contains the path part of the request URL.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// example.com/users?sort=desc\nconsole.dir(req.path)\n// =&gt; \"/users\"\n</pre></div>  <div class=\"doc-box doc-info\"> <p>When called from a middleware, the mount point is not included in <code class=\"language-plaintext highlighter-rouge\">req.path</code>. See <a href=\"https://expressjs.com/5x/api.html#app.use\">app.use()</a> for more details.</p> </div>   <h3 id=\"req.protocol\">req.protocol</h3> <p>Contains the request protocol string: either <code class=\"language-plaintext highlighter-rouge\">http</code> or (for TLS requests) <code class=\"language-plaintext highlighter-rouge\">https</code>.</p> <p>When the <a href=\"#trust.proxy.options.table\"><code class=\"language-plaintext highlighter-rouge\">trust proxy</code> setting</a> does not evaluate to <code class=\"language-plaintext highlighter-rouge\">false</code>, this property will use the value of the <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-Proto</code> header field if present. This header can be set by the client or by the proxy.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">console.dir(req.protocol)\n// =&gt; \"http\"\n</pre></div>    <h3 id=\"req.query\">req.query</h3> <p>This property is an object containing a property for each query string parameter in the route. When <a href=\"#app.settings.table\">query parser</a> is set to disabled, it is an empty object <code class=\"language-plaintext highlighter-rouge\">{}</code>, otherwise it is the result of the configured query parser.</p> <div class=\"doc-box doc-warn\"> <p>As <code class=\"language-plaintext highlighter-rouge\">req.query</code>’s shape is based on user-controlled input, all properties and values in this object are untrusted and should be validated before trusting. For example, <code class=\"language-plaintext highlighter-rouge\">req.query.foo.toString()</code> may fail in multiple ways, for example <code class=\"language-plaintext highlighter-rouge\">foo</code> may not be there or may not be a string, and <code class=\"language-plaintext highlighter-rouge\">toString</code> may not be a function and instead a string or other user-input.</p> </div> <p>The value of this property can be configured with the <a href=\"#app.settings.table\">query parser application setting</a> to work how your application needs it. A very popular query string parser is the <a href=\"https://www.npmjs.org/package/qs\"><code class=\"language-plaintext highlighter-rouge\">qs</code> module</a>, and this is used by default. The <code class=\"language-plaintext highlighter-rouge\">qs</code> module is very configurable with many settings, and it may be desirable to use different settings than the default to populate <code class=\"language-plaintext highlighter-rouge\">req.query</code>:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const qs = require('qs')\napp.set('query parser',\n  (str) =&gt; qs.parse(str, { /* custom options */ }))\n</pre></div>  <p>Check out the <a href=\"#app.settings.table\">query parser application setting</a> documentation for other customization options.</p>   <h3 id=\"req.res\">req.res</h3> <p>This property holds a reference to the <a href=\"#res\">response object</a> that relates to this request object.</p>   <h3 id=\"req.route\">req.route</h3> <p>Contains the currently-matched route, a string. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/user/{:id}', (req, res) =&gt; {\n  console.dir(req.route, { depth: null })\n  res.send('GET')\n})\n</pre></div>  <p>Example output from the previous snippet:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">Route {\n  path: '/user/{:id}',\n  stack: [\n    Layer {\n      handle: [Function (anonymous)],\n      keys: [],\n      name: '&lt;anonymous&gt;',\n      params: undefined,\n      path: undefined,\n      slash: false,\n      matchers: [ [Function: match] ],\n      method: 'get'\n    }\n  ],\n  methods: [Object: null prototype] { get: true }\n}\n</pre></div>    <h3 id=\"req.secure\">req.secure</h3> <p>A Boolean property that is true if a TLS connection is established. Equivalent to the following:</p>  <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">req.protocol === 'https'\n</pre></div>    <h3 id=\"req.signedCookies\">req.signedCookies</h3> <p>When using <a href=\"https://www.npmjs.com/package/cookie-parser\">cookie-parser</a> middleware, this property contains signed cookies sent by the request, unsigned and ready for use. Signed cookies reside in a different object to show developer intent; otherwise, a malicious attack could be placed on <code class=\"language-plaintext highlighter-rouge\">req.cookie</code> values (which are easy to spoof). Note that signing a cookie does not make it “hidden” or encrypted; but simply prevents tampering (because the secret used to sign is private).</p> <p>If no signed cookies are sent, the property defaults to <code class=\"language-plaintext highlighter-rouge\">{}</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// Cookie: user=tobi.CP7AWaXDfAKIRfH49dQzKJx7sKzzSoPq7/AcBBRVwlI3\nconsole.dir(req.signedCookies.user)\n// =&gt; \"tobi\"\n</pre></div>  <p>For more information, issues, or concerns, see <a href=\"https://github.com/expressjs/cookie-parser\">cookie-parser</a>.</p>   <h3 id=\"req.stale\">req.stale</h3> <p>Indicates whether the request is “stale,” and is the opposite of <code class=\"language-plaintext highlighter-rouge\">req.fresh</code>. For more information, see <a href=\"#req.fresh\">req.fresh</a>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">console.dir(req.stale)\n// =&gt; true\n</pre></div>    <h3 id=\"req.subdomains\">req.subdomains</h3> <p>An array of subdomains in the domain name of the request.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// Host: \"tobi.ferrets.example.com\"\nconsole.dir(req.subdomains)\n// =&gt; [\"ferrets\", \"tobi\"]\n</pre></div>  <p>The application property <code class=\"language-plaintext highlighter-rouge\">subdomain offset</code>, which defaults to 2, is used for determining the beginning of the subdomain segments. To change this behavior, change its value using <a href=\"5x/api#app.set\">app.set</a>.</p>   <h3 id=\"req.xhr\">req.xhr</h3> <p>A Boolean property that is <code class=\"language-plaintext highlighter-rouge\">true</code> if the request’s <code class=\"language-plaintext highlighter-rouge\">X-Requested-With</code> header field is “XMLHttpRequest”, indicating that the request was issued by a client library such as jQuery.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">console.dir(req.xhr)\n// =&gt; true\n</pre></div>   <h3 id=\"req.methods\">Methods</h3>  <h3 id=\"req.accepts\">req.accepts(types)</h3> <p>Checks if the specified content types are acceptable, based on the request’s <code class=\"language-plaintext highlighter-rouge\">Accept</code> HTTP header field. The method returns the best match, or if none of the specified content types is acceptable, returns <code class=\"language-plaintext highlighter-rouge\">false</code> (in which case, the application should respond with <code class=\"language-plaintext highlighter-rouge\">406 \"Not Acceptable\"</code>).</p> <p>The <code class=\"language-plaintext highlighter-rouge\">type</code> value may be a single MIME type string (such as “application/json”), an extension name such as “json”, a comma-delimited list, or an array. For a list or array, the method returns the <em>best</em> match (if any).</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// Accept: text/html\nreq.accepts('html')\n// =&gt; \"html\"\n\n// Accept: text/*, application/json\nreq.accepts('html')\n// =&gt; \"html\"\nreq.accepts('text/html')\n// =&gt; \"text/html\"\nreq.accepts(['json', 'text'])\n// =&gt; \"json\"\nreq.accepts('application/json')\n// =&gt; \"application/json\"\n\n// Accept: text/*, application/json\nreq.accepts('image/png')\nreq.accepts('png')\n// =&gt; false\n\n// Accept: text/*;q=.5, application/json\nreq.accepts(['html', 'json'])\n// =&gt; \"json\"\n</pre></div>  <p>For more information, or if you have issues or concerns, see <a href=\"https://github.com/expressjs/accepts\">accepts</a>.</p>   <h3 id=\"req.acceptsCharsets\">req.acceptsCharsets(charset [, ...])</h3> <p>Returns the first accepted charset of the specified character sets, based on the request’s <code class=\"language-plaintext highlighter-rouge\">Accept-Charset</code> HTTP header field. If none of the specified charsets is accepted, returns <code class=\"language-plaintext highlighter-rouge\">false</code>.</p> <p>For more information, or if you have issues or concerns, see <a href=\"https://github.com/expressjs/accepts\">accepts</a>.</p>   <h3 id=\"req.acceptsEncodings\">req.acceptsEncodings(encoding [, ...])</h3> <p>Returns the first accepted encoding of the specified encodings, based on the request’s <code class=\"language-plaintext highlighter-rouge\">Accept-Encoding</code> HTTP header field. If none of the specified encodings is accepted, returns <code class=\"language-plaintext highlighter-rouge\">false</code>.</p> <p>For more information, or if you have issues or concerns, see <a href=\"https://github.com/expressjs/accepts\">accepts</a>.</p>   <h3 id=\"req.acceptsLanguages\">req.acceptsLanguages([lang, ...])</h3> <p>Returns the first accepted language of the specified languages, based on the request’s <code class=\"language-plaintext highlighter-rouge\">Accept-Language</code> HTTP header field. If none of the specified languages is accepted, returns <code class=\"language-plaintext highlighter-rouge\">false</code>.</p> <p>If no <code class=\"language-plaintext highlighter-rouge\">lang</code> argument is given, then <code class=\"language-plaintext highlighter-rouge\">req.acceptsLanguages()</code> returns all languages from the HTTP <code class=\"language-plaintext highlighter-rouge\">Accept-Language</code> header as an <code class=\"language-plaintext highlighter-rouge\">Array</code>.</p> <p>For more information, or if you have issues or concerns, see <a href=\"https://github.com/expressjs/accepts\">accepts</a>.</p> <p>Express (5.x) source: <a href=\"https://github.com/expressjs/express/blob/v5.1.0/lib/request.js#L172\">request.js line 172</a></p> <p>Accepts (2.0) source: <a href=\"https://github.com/jshttp/accepts/blob/2.0.0/index.js#L195\">index.js line 195</a></p>   <h3 id=\"req.get\">req.get(field)</h3> <p>Returns the specified HTTP request header field (case-insensitive match). The <code class=\"language-plaintext highlighter-rouge\">Referrer</code> and <code class=\"language-plaintext highlighter-rouge\">Referer</code> fields are interchangeable.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">req.get('Content-Type')\n// =&gt; \"text/plain\"\n\nreq.get('content-type')\n// =&gt; \"text/plain\"\n\nreq.get('Something')\n// =&gt; undefined\n</pre></div>  <p>Aliased as <code class=\"language-plaintext highlighter-rouge\">req.header(field)</code>.</p>   <h3 id=\"req.is\">req.is(type)</h3> <p>Returns the matching content type if the incoming request’s “Content-Type” HTTP header field matches the MIME type specified by the <code class=\"language-plaintext highlighter-rouge\">type</code> parameter. If the request has no body, returns <code class=\"language-plaintext highlighter-rouge\">null</code>. Returns <code class=\"language-plaintext highlighter-rouge\">false</code> otherwise.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// With Content-Type: text/html; charset=utf-8\nreq.is('html') // =&gt; 'html'\nreq.is('text/html') // =&gt; 'text/html'\nreq.is('text/*') // =&gt; 'text/*'\n\n// When Content-Type is application/json\nreq.is('json') // =&gt; 'json'\nreq.is('application/json') // =&gt; 'application/json'\nreq.is('application/*') // =&gt; 'application/*'\n\n// Using arrays\n// When Content-Type is application/json\nreq.is(['json', 'html']) // =&gt; 'json'\n\n// Using multiple arguments\n// When Content-Type is application/json\nreq.is('json', 'html') // =&gt; 'json'\n\nreq.is('html') // =&gt; false\nreq.is(['xml', 'yaml']) // =&gt; false\nreq.is('xml', 'yaml') // =&gt; false\n</pre></div>  <p>For more information, or if you have issues or concerns, see <a href=\"https://github.com/expressjs/type-is\">type-is</a>.</p>   <h3 id=\"req.range\">req.range(size[, options])</h3> <p><code class=\"language-plaintext highlighter-rouge\">Range</code> header parser.</p> <p>The <code class=\"language-plaintext highlighter-rouge\">size</code> parameter is the maximum size of the resource.</p> <p>The <code class=\"language-plaintext highlighter-rouge\">options</code> parameter is an object that can have the following properties.</p> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Property</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code class=\"language-plaintext highlighter-rouge\">combine</code></td> <td>Boolean</td> <td>Specify if overlapping &amp; adjacent ranges should be combined, defaults to <code class=\"language-plaintext highlighter-rouge\">false</code>. When <code class=\"language-plaintext highlighter-rouge\">true</code>, ranges will be combined and returned as if they were specified that way in the header.</td> </tr> </tbody> </table> </div> <p>An array of ranges will be returned or negative numbers indicating an error parsing.</p> <ul> <li>\n<code class=\"language-plaintext highlighter-rouge\">-2</code> signals a malformed header string</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">-1</code> signals an unsatisfiable range</li> </ul> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// parse header from request\nconst range = req.range(1000)\n\n// the type of the range\nif (range.type === 'bytes') {\n  // the ranges\n  range.forEach((r) =&gt; {\n    // do something with r.start and r.end\n  })\n}\n</pre></div>   <h2 id=\"res\">Response</h2> <p>The <code class=\"language-plaintext highlighter-rouge\">res</code> object represents the HTTP response that an Express app sends when it gets an HTTP request.</p> <p>In this documentation and by convention, the object is always referred to as <code class=\"language-plaintext highlighter-rouge\">res</code> (and the HTTP request is <code class=\"language-plaintext highlighter-rouge\">req</code>) but its actual name is determined by the parameters to the callback function in which you’re working.</p> <p>For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/user/:id', (req, res) =&gt; {\n  res.send(`user ${req.params.id}`)\n})\n</pre></div>  <p>But you could just as well have:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/user/:id', (request, response) =&gt; {\n  response.send(`user ${request.params.id}`)\n})\n</pre></div>  <p>The <code class=\"language-plaintext highlighter-rouge\">res</code> object is an enhanced version of Node’s own response object and supports all <a href=\"https://nodejs.org/api/http.html#http_class_http_serverresponse\">built-in fields and methods</a>.</p> <h3 id=\"res.properties\">Properties</h3>  <h3 id=\"res.app\">res.app</h3> <p>This property holds a reference to the instance of the Express application that is using the middleware.</p> <p><code class=\"language-plaintext highlighter-rouge\">res.app</code> is identical to the <a href=\"#req.app\">req.app</a> property in the request object.</p>   <h3 id=\"res.headersSent\">res.headersSent</h3> <p>Boolean property that indicates if the app sent HTTP headers for the response.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/', (req, res) =&gt; {\n  console.log(res.headersSent) // false\n  res.send('OK')\n  console.log(res.headersSent) // true\n})\n</pre></div>    <h3 id=\"res.locals\">res.locals</h3> <p>Use this property to set variables accessible in templates rendered with <a href=\"#res.render\">res.render</a>. The variables set on <code class=\"language-plaintext highlighter-rouge\">res.locals</code> are available within a single request-response cycle, and will not be shared between requests.</p> <div class=\"doc-box doc-warn\"> <p>The <code class=\"language-plaintext highlighter-rouge\">locals</code> object is used by view engines to render a response. The object keys may be particularly sensitive and should not contain user-controlled input, as it may affect the operation of the view engine or provide a path to cross-site scripting. Consult the documentation for the used view engine for additional considerations.</p> </div> <p>In order to keep local variables for use in template rendering between requests, use <a href=\"#app.locals\">app.locals</a> instead.</p> <p>This property is useful for exposing request-level information such as the request path name, authenticated user, user settings, and so on to templates rendered within the application.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use((req, res, next) =&gt; {\n  // Make `user` and `authenticated` available in templates\n  res.locals.user = req.user\n  res.locals.authenticated = !req.user.anonymous\n  next()\n})\n</pre></div>    <h3 id=\"res.req\">res.req</h3> <p>This property holds a reference to the <a href=\"#req\">request object</a> that relates to this response object.</p>  <h3 id=\"res.methods\">Methods</h3>  <h3 id=\"res.append\">res.append(field [, value])</h3> <div class=\"doc-box doc-info\"> <p><code class=\"language-plaintext highlighter-rouge\">res.append()</code> is supported by Express v4.11.0+</p> </div> <p>Appends the specified <code class=\"language-plaintext highlighter-rouge\">value</code> to the HTTP response header <code class=\"language-plaintext highlighter-rouge\">field</code>. If the header is not already set, it creates the header with the specified value. The <code class=\"language-plaintext highlighter-rouge\">value</code> parameter can be a string or an array.</p> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>calling <code class=\"language-plaintext highlighter-rouge\">res.set()</code> after <code class=\"language-plaintext highlighter-rouge\">res.append()</code> will reset the previously-set header value.</p> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.append('Link', ['&lt;http://localhost/&gt;', '&lt;http://localhost:3000/&gt;'])\nres.append('Set-Cookie', 'foo=bar; Path=/; HttpOnly')\nres.append('Warning', '199 Miscellaneous warning')\n</pre></div>    <h3 id=\"res.attachment\">res.attachment([filename])</h3> <p>Sets the HTTP response <code class=\"language-plaintext highlighter-rouge\">Content-Disposition</code> header field to “attachment”. If a <code class=\"language-plaintext highlighter-rouge\">filename</code> is given, then it sets the <code class=\"language-plaintext highlighter-rouge\">Content-Type</code> based on the extension name via <code class=\"language-plaintext highlighter-rouge\">res.type()</code>, and sets the <code class=\"language-plaintext highlighter-rouge\">Content-Disposition</code> “filename=” parameter.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.attachment()\n// Content-Disposition: attachment\n\nres.attachment('path/to/logo.png')\n// Content-Disposition: attachment; filename=\"logo.png\"\n// Content-Type: image/png\n</pre></div>    <h3 id=\"res.cookie\">res.cookie(name, value [, options])</h3> <p>Sets cookie <code class=\"language-plaintext highlighter-rouge\">name</code> to <code class=\"language-plaintext highlighter-rouge\">value</code>. The <code class=\"language-plaintext highlighter-rouge\">value</code> parameter may be a string or object converted to JSON.</p> <p>The <code class=\"language-plaintext highlighter-rouge\">options</code> parameter is an object that can have the following properties.</p> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Property</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code class=\"language-plaintext highlighter-rouge\">domain</code></td> <td>String</td> <td>Domain name for the cookie. Defaults to the domain name of the app.</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">encode</code></td> <td>Function</td> <td>A synchronous function used for cookie value encoding. Defaults to <code class=\"language-plaintext highlighter-rouge\">encodeURIComponent</code>.</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">expires</code></td> <td>Date</td> <td>Expiry date of the cookie in GMT. If not specified or set to 0, creates a session cookie.</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">httpOnly</code></td> <td>Boolean</td> <td>Flags the cookie to be accessible only by the web server.</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">maxAge</code></td> <td>Number</td> <td>Convenient option for setting the expiry time relative to the current time in milliseconds.</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">path</code></td> <td>String</td> <td>Path for the cookie. Defaults to “/”.</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">partitioned</code></td> <td>Boolean</td> <td>Indicates that the cookie should be stored using partitioned storage. See <a href=\"https://developer.mozilla.org/en-US/docs/Web/Privacy/Partitioned_cookies\">Cookies Having Independent Partitioned State (CHIPS)</a> for more details.</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">priority</code></td> <td>String</td> <td>Value of the “Priority” <strong>Set-Cookie</strong> attribute.</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">secure</code></td> <td>Boolean</td> <td>Marks the cookie to be used with HTTPS only.</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">signed</code></td> <td>Boolean</td> <td>Indicates if the cookie should be signed.</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">sameSite</code></td> <td>Boolean or String</td> <td>Value of the “SameSite” <strong>Set-Cookie</strong> attribute. More information at <a href=\"https://tools.ietf.org/html/draft-ietf-httpbis-cookie-same-site-00#section-4.1.1\">https://tools.ietf.org/html/draft-ietf-httpbis-cookie-same-site-00#section-4.1.1</a>.</td> </tr> </tbody> </table> </div> <div class=\"doc-box doc-notice\"> <p>All <code class=\"language-plaintext highlighter-rouge\">res.cookie()</code> does is set the HTTP <code class=\"language-plaintext highlighter-rouge\">Set-Cookie</code> header with the options provided. Any option not specified defaults to the value stated in <a href=\"http://tools.ietf.org/html/rfc6265\">RFC 6265</a>.</p> </div> <p>For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.cookie('name', 'tobi', { domain: '.example.com', path: '/admin', secure: true })\nres.cookie('rememberme', '1', { expires: new Date(Date.now() + 900000), httpOnly: true })\n</pre></div>  <p>You can set multiple cookies in a single response by calling <code class=\"language-plaintext highlighter-rouge\">res.cookie</code> multiple times, for example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res\n  .status(201)\n  .cookie('access_token', `Bearer ${token}`, {\n    expires: new Date(Date.now() + 8 * 3600000) // cookie will be removed after 8 hours\n  })\n  .cookie('test', 'test')\n  .redirect(301, '/admin')\n</pre></div>  <p>The <code class=\"language-plaintext highlighter-rouge\">encode</code> option allows you to choose the function used for cookie value encoding. Does not support asynchronous functions.</p> <p>Example use case: You need to set a domain-wide cookie for another site in your organization. This other site (not under your administrative control) does not use URI-encoded cookie values.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// Default encoding\nres.cookie('some_cross_domain_cookie', 'http://mysubdomain.example.com', { domain: 'example.com' })\n// Result: 'some_cross_domain_cookie=http%3A%2F%2Fmysubdomain.example.com; Domain=example.com; Path=/'\n\n// Custom encoding\nres.cookie('some_cross_domain_cookie', 'http://mysubdomain.example.com', { domain: 'example.com', encode: String })\n// Result: 'some_cross_domain_cookie=http://mysubdomain.example.com; Domain=example.com; Path=/;'\n</pre></div>  <p>The <code class=\"language-plaintext highlighter-rouge\">maxAge</code> option is a convenience option for setting “expires” relative to the current time in milliseconds. The following is equivalent to the second example above.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.cookie('rememberme', '1', { maxAge: 900000, httpOnly: true })\n</pre></div>  <p>You can pass an object as the <code class=\"language-plaintext highlighter-rouge\">value</code> parameter; it is then serialized as JSON and parsed by <code class=\"language-plaintext highlighter-rouge\">bodyParser()</code> middleware.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.cookie('cart', { items: [1, 2, 3] })\nres.cookie('cart', { items: [1, 2, 3] }, { maxAge: 900000 })\n</pre></div>  <p>When using <a href=\"https://www.npmjs.com/package/cookie-parser\">cookie-parser</a> middleware, this method also supports signed cookies. Simply include the <code class=\"language-plaintext highlighter-rouge\">signed</code> option set to <code class=\"language-plaintext highlighter-rouge\">true</code>. Then, <code class=\"language-plaintext highlighter-rouge\">res.cookie()</code> will use the secret passed to <code class=\"language-plaintext highlighter-rouge\">cookieParser(secret)</code> to sign the value.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.cookie('name', 'tobi', { signed: true })\n</pre></div>  <p>Later, you may access this value through the <a href=\"#req.signedCookies\">req.signedCookies</a> object.</p>   <h3 id=\"res.clearCookie\">res.clearCookie(name [, options])</h3> <p>Clears the cookie with the specified <code class=\"language-plaintext highlighter-rouge\">name</code> by sending a <code class=\"language-plaintext highlighter-rouge\">Set-Cookie</code> header that sets its expiration date in the past. This instructs the client that the cookie has expired and is no longer valid. For more information about available <code class=\"language-plaintext highlighter-rouge\">options</code>, see <a href=\"#res.cookie\">res.cookie()</a>.</p> <div class=\"doc-box doc-notice\"> <p>The <code class=\"language-plaintext highlighter-rouge\">expires</code> and <code class=\"language-plaintext highlighter-rouge\">max-age</code> options are being ignored completely.</p> </div> <div class=\"doc-box doc-notice\"> <p>Web browsers and other compliant clients will only clear the cookie if the given <code class=\"language-plaintext highlighter-rouge\">options</code> is identical to those given to <a href=\"#res.cookie\">res.cookie()</a></p> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.cookie('name', 'tobi', { path: '/admin' })\nres.clearCookie('name', { path: '/admin' })\n</pre></div>    <h3 id=\"res.download\">res.download(path [, filename] [, options] [, fn])</h3> <div class=\"doc-box doc-info\"> <p>The optional <code class=\"language-plaintext highlighter-rouge\">options</code> argument is supported by Express v4.16.0 onwards.</p> </div> <p>Transfers the file at <code class=\"language-plaintext highlighter-rouge\">path</code> as an “attachment”. Typically, browsers will prompt the user for download. By default, the <code class=\"language-plaintext highlighter-rouge\">Content-Disposition</code> header “filename=” parameter is derived from the <code class=\"language-plaintext highlighter-rouge\">path</code> argument, but can be overridden with the <code class=\"language-plaintext highlighter-rouge\">filename</code> parameter. If <code class=\"language-plaintext highlighter-rouge\">path</code> is relative, then it will be based on the current working directory of the process or the <code class=\"language-plaintext highlighter-rouge\">root</code> option, if provided.</p> <div class=\"doc-box doc-warn\"> <p>This API provides access to data on the running file system. Ensure that either (a) the way in which the <code class=\"language-plaintext highlighter-rouge\">path</code> argument was constructed is secure if it contains user input or (b) set the <code class=\"language-plaintext highlighter-rouge\">root</code> option to the absolute path of a directory to contain access within.</p> <p>When the <code class=\"language-plaintext highlighter-rouge\">root</code> option is provided, Express will validate that the relative path provided as <code class=\"language-plaintext highlighter-rouge\">path</code> will resolve within the given <code class=\"language-plaintext highlighter-rouge\">root</code> option.</p> </div> <p>The following table provides details on the <code class=\"language-plaintext highlighter-rouge\">options</code> parameter.</p> <div class=\"doc-box doc-info\"> <p>The optional <code class=\"language-plaintext highlighter-rouge\">options</code> argument is supported by Express v4.16.0 onwards.</p> </div> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Default</th> <th>Availability</th> </tr> </thead> <tbody> <tr> <td><code class=\"language-plaintext highlighter-rouge\">maxAge</code></td> <td>Sets the max-age property of the <code class=\"language-plaintext highlighter-rouge\">Cache-Control</code> header in milliseconds or a string in <a href=\"https://www.npmjs.org/package/ms\">ms format</a>\n</td> <td>0</td> <td>4.16+</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">root</code></td> <td>Root directory for relative filenames.</td> <td> </td> <td>4.18+</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">lastModified</code></td> <td>Sets the <code class=\"language-plaintext highlighter-rouge\">Last-Modified</code> header to the last modified date of the file on the OS. Set <code class=\"language-plaintext highlighter-rouge\">false</code> to disable it.</td> <td>Enabled</td> <td>4.16+</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">headers</code></td> <td>Object containing HTTP headers to serve with the file. The header <code class=\"language-plaintext highlighter-rouge\">Content-Disposition</code> will be overridden by the <code class=\"language-plaintext highlighter-rouge\">filename</code> argument.</td> <td> </td> <td>4.16+</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">dotfiles</code></td> <td>Option for serving dotfiles. Possible values are “allow”, “deny”, “ignore”.</td> <td>“ignore”</td> <td>4.16+</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">acceptRanges</code></td> <td>Enable or disable accepting ranged requests.</td> <td><code class=\"language-plaintext highlighter-rouge\">true</code></td> <td>4.16+</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">cacheControl</code></td> <td>Enable or disable setting <code class=\"language-plaintext highlighter-rouge\">Cache-Control</code> response header.</td> <td><code class=\"language-plaintext highlighter-rouge\">true</code></td> <td>4.16+</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">immutable</code></td> <td>Enable or disable the <code class=\"language-plaintext highlighter-rouge\">immutable</code> directive in the <code class=\"language-plaintext highlighter-rouge\">Cache-Control</code> response header. If enabled, the <code class=\"language-plaintext highlighter-rouge\">maxAge</code> option should also be specified to enable caching. The <code class=\"language-plaintext highlighter-rouge\">immutable</code> directive will prevent supported clients from making conditional requests during the life of the <code class=\"language-plaintext highlighter-rouge\">maxAge</code> option to check if the file has changed.</td> <td><code class=\"language-plaintext highlighter-rouge\">false</code></td> <td>4.16+</td> </tr> </tbody> </table> </div> <p>The method invokes the callback function <code class=\"language-plaintext highlighter-rouge\">fn(err)</code> when the transfer is complete or when an error occurs. If the callback function is specified and an error occurs, the callback function must explicitly handle the response process either by ending the request-response cycle, or by passing control to the next route.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.download('/report-12345.pdf')\n\nres.download('/report-12345.pdf', 'report.pdf')\n\nres.download('/report-12345.pdf', 'report.pdf', (err) =&gt; {\n  if (err) {\n    // Handle error, but keep in mind the response may be partially-sent\n    // so check res.headersSent\n  } else {\n    // decrement a download credit, etc.\n  }\n})\n</pre></div>    <h3 id=\"res.end\">res.end([data[, encoding]][, callback])</h3> <p>Ends the response process. This method actually comes from Node core, specifically the <a href=\"https://nodejs.org/api/http.html#responseenddata-encoding-callback\">response.end() method of http.ServerResponse</a>.</p> <p>Use to quickly end the response without any data. If you need to respond with data, instead use methods such as <a href=\"#res.send\">res.send()</a> and <a href=\"#res.json\">res.json()</a>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.end()\nres.status(404).end()\n</pre></div>    <h3 id=\"res.format\">res.format(object)</h3> <p>Performs content-negotiation on the <code class=\"language-plaintext highlighter-rouge\">Accept</code> HTTP header on the request object, when present. It uses <a href=\"#req.accepts\">req.accepts()</a> to select a handler for the request, based on the acceptable types ordered by their quality values. If the header is not specified, the first callback is invoked. When no match is found, the server responds with 406 “Not Acceptable”, or invokes the <code class=\"language-plaintext highlighter-rouge\">default</code> callback.</p> <p>The <code class=\"language-plaintext highlighter-rouge\">Content-Type</code> response header is set when a callback is selected. However, you may alter this within the callback using methods such as <code class=\"language-plaintext highlighter-rouge\">res.set()</code> or <code class=\"language-plaintext highlighter-rouge\">res.type()</code>.</p> <p>The following example would respond with <code class=\"language-plaintext highlighter-rouge\">{ \"message\": \"hey\" }</code> when the <code class=\"language-plaintext highlighter-rouge\">Accept</code> header field is set to “application/json” or “*/json” (however, if it is “*/*”, then the response will be “hey”).</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.format({\n  'text/plain' () {\n    res.send('hey')\n  },\n\n  'text/html' () {\n    res.send('&lt;p&gt;hey&lt;/p&gt;')\n  },\n\n  'application/json' () {\n    res.send({ message: 'hey' })\n  },\n\n  default () {\n    // log the request and respond with 406\n    res.status(406).send('Not Acceptable')\n  }\n})\n</pre></div>  <p>In addition to canonicalized MIME types, you may also use extension names mapped to these types for a slightly less verbose implementation:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.format({\n  text () {\n    res.send('hey')\n  },\n\n  html () {\n    res.send('&lt;p&gt;hey&lt;/p&gt;')\n  },\n\n  json () {\n    res.send({ message: 'hey' })\n  }\n})\n</pre></div>    <h3 id=\"res.get\">res.get(field)</h3> <p>Returns the HTTP response header specified by <code class=\"language-plaintext highlighter-rouge\">field</code>. The match is case-insensitive.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.get('Content-Type')\n// =&gt; \"text/plain\"\n</pre></div>    <h3 id=\"res.json\">res.json([body])</h3> <p>Sends a JSON response. This method sends a response (with the correct content-type) that is the parameter converted to a JSON string using <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify\">JSON.stringify()</a>.</p> <p>The parameter can be any JSON type, including object, array, string, Boolean, number, or null, and you can also use it to convert other values to JSON.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.json(null)\nres.json({ user: 'tobi' })\nres.status(500).json({ error: 'message' })\n</pre></div>    <h3 id=\"res.jsonp\">res.jsonp([body])</h3> <p>Sends a JSON response with JSONP support. This method is identical to <code class=\"language-plaintext highlighter-rouge\">res.json()</code>, except that it opts-in to JSONP callback support.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.jsonp(null)\n// =&gt; callback(null)\n\nres.jsonp({ user: 'tobi' })\n// =&gt; callback({ \"user\": \"tobi\" })\n\nres.status(500).jsonp({ error: 'message' })\n// =&gt; callback({ \"error\": \"message\" })\n</pre></div>  <p>By default, the JSONP callback name is simply <code class=\"language-plaintext highlighter-rouge\">callback</code>. Override this with the <a href=\"#app.settings.table\">jsonp callback name</a> setting.</p> <p>The following are some examples of JSONP responses using the same code:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// ?callback=foo\nres.jsonp({ user: 'tobi' })\n// =&gt; foo({ \"user\": \"tobi\" })\n\napp.set('jsonp callback name', 'cb')\n\n// ?cb=foo\nres.status(500).jsonp({ error: 'message' })\n// =&gt; foo({ \"error\": \"message\" })\n</pre></div>    <h3 id=\"res.links\">res.links(links)</h3> <p>Joins the <code class=\"language-plaintext highlighter-rouge\">links</code> provided as properties of the parameter to populate the response’s <code class=\"language-plaintext highlighter-rouge\">Link</code> HTTP header field.</p> <p>For example, the following call:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.links({\n  next: 'http://api.example.com/users?page=2',\n  last: 'http://api.example.com/users?page=5'\n})\n</pre></div>  <p>Yields the following results:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">Link: &lt;http://api.example.com/users?page=2&gt;; rel=\"next\",\n      &lt;http://api.example.com/users?page=5&gt;; rel=\"last\"\n</pre></div>    <h3 id=\"res.location\">res.location(path)</h3> <p>Sets the response <code class=\"language-plaintext highlighter-rouge\">Location</code> HTTP header to the specified <code class=\"language-plaintext highlighter-rouge\">path</code> parameter.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.location('/foo/bar')\nres.location('http://example.com')\n</pre></div>  <div class=\"doc-box doc-warn\"> <p>After encoding the URL, if not encoded already, Express passes the specified URL to the browser in the <code class=\"language-plaintext highlighter-rouge\">Location</code> header, without any validation.</p> <p>Browsers take the responsibility of deriving the intended URL from the current URL or the referring URL, and the URL specified in the <code class=\"language-plaintext highlighter-rouge\">Location</code> header; and redirect the user accordingly.</p> </div>   <h3 id=\"res.redirect\">res.redirect([status,] path)</h3> <p>Redirects to the URL derived from the specified <code class=\"language-plaintext highlighter-rouge\">path</code>, with specified <code class=\"language-plaintext highlighter-rouge\">status</code>, a positive integer that corresponds to an <a href=\"https://www.rfc-editor.org/rfc/rfc9110.html#name-status-codes\">HTTP status code</a>. If not specified, <code class=\"language-plaintext highlighter-rouge\">status</code> defaults to <code class=\"language-plaintext highlighter-rouge\">302 \"Found\"</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.redirect('/foo/bar')\nres.redirect('http://example.com')\nres.redirect(301, 'http://example.com')\nres.redirect('../login')\n</pre></div>  <p>Redirects can be a fully-qualified URL for redirecting to a different site:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.redirect('http://google.com')\n</pre></div>  <p>Redirects can be relative to the root of the host name. For example, if the application is on <code class=\"language-plaintext highlighter-rouge\">http://example.com/admin/post/new</code>, the following would redirect to the URL <code class=\"language-plaintext highlighter-rouge\">http://example.com/admin</code>:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.redirect('/admin')\n</pre></div>  <p>Redirects can be relative to the current URL. For example, from <code class=\"language-plaintext highlighter-rouge\">http://example.com/blog/admin/</code> (notice the trailing slash), the following would redirect to the URL <code class=\"language-plaintext highlighter-rouge\">http://example.com/blog/admin/post/new</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.redirect('post/new')\n</pre></div>  <p>Redirecting to <code class=\"language-plaintext highlighter-rouge\">post/new</code> from <code class=\"language-plaintext highlighter-rouge\">http://example.com/blog/admin</code> (no trailing slash), will redirect to <code class=\"language-plaintext highlighter-rouge\">http://example.com/blog/post/new</code>.</p> <p>If you found the above behavior confusing, think of path segments as directories (with trailing slashes) and files, it will start to make sense.</p> <p>Path-relative redirects are also possible. If you were on <code class=\"language-plaintext highlighter-rouge\">http://example.com/admin/post/new</code>, the following would redirect to <code class=\"language-plaintext highlighter-rouge\">http://example.com/admin/post</code>:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.redirect('..')\n</pre></div>  <p>See also <a href=\"http://expressjs.com/en/advanced/best-practice-security.html#prevent-open-redirects\">Security best practices: Prevent open redirect vulnerabilities</a>.</p>   <h3 id=\"res.render\">res.render(view [, locals] [, callback])</h3> <p>Renders a <code class=\"language-plaintext highlighter-rouge\">view</code> and sends the rendered HTML string to the client. Optional parameters:</p> <ul> <li>\n<code class=\"language-plaintext highlighter-rouge\">locals</code>, an object whose properties define local variables for the view.</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">callback</code>, a callback function. If provided, the method returns both the possible error and rendered string, but does not perform an automated response. When an error occurs, the method invokes <code class=\"language-plaintext highlighter-rouge\">next(err)</code> internally.</li> </ul> <p>The <code class=\"language-plaintext highlighter-rouge\">view</code> argument is a string that is the file path of the view file to render. This can be an absolute path, or a path relative to the <code class=\"language-plaintext highlighter-rouge\">views</code> setting. If the path does not contain a file extension, then the <code class=\"language-plaintext highlighter-rouge\">view engine</code> setting determines the file extension. If the path does contain a file extension, then Express will load the module for the specified template engine (via <code class=\"language-plaintext highlighter-rouge\">require()</code>) and render it using the loaded module’s <code class=\"language-plaintext highlighter-rouge\">__express</code> function.</p> <p>For more information, see <a href=\"guide/using-template-engines\">Using template engines with Express</a>.</p> <div class=\"doc-box doc-warn\"> <p class=\"doc-title\"><svg viewbox=\"0 0 24 24\" width=\"24\" height=\"24\" fill=\"currentColor\"><path d=\"M12 7C11.7348 7 11.4804 7.10536 11.2929 7.29289C11.1054 7.48043 11 7.73478 11 8V12C11 12.2652 11.1054 12.5196 11.2929 12.7071C11.4804 12.8946 11.7348 13 12 13C12.2652 13 12.5196 12.8946 12.7071 12.7071C12.8946 12.5196 13 12.2652 13 12V8C13 7.73478 12.8946 7.48043 12.7071 7.29289C12.5196 7.10536 12.2652 7 12 7ZM12 15C11.8022 15 11.6089 15.0586 11.4444 15.1685C11.28 15.2784 11.1518 15.4346 11.0761 15.6173C11.0004 15.8 10.9806 16.0011 11.0192 16.1951C11.0578 16.3891 11.153 16.5673 11.2929 16.7071C11.4327 16.847 11.6109 16.9422 11.8049 16.9808C11.9989 17.0194 12.2 16.9996 12.3827 16.9239C12.5654 16.8482 12.7216 16.72 12.8315 16.5556C12.9414 16.3911 13 16.1978 13 16C13 15.7348 12.8946 15.4804 12.7071 15.2929C12.5196 15.1054 12.2652 15 12 15ZM21.71 7.56L16.44 2.29C16.2484 2.10727 15.9948 2.00368 15.73 2H8.27C8.00523 2.00368 7.75163 2.10727 7.56 2.29L2.29 7.56C2.10727 7.75163 2.00368 8.00523 2 8.27V15.73C2.00368 15.9948 2.10727 16.2484 2.29 16.44L7.56 21.71C7.75163 21.8927 8.00523 21.9963 8.27 22H15.73C15.9948 21.9963 16.2484 21.8927 16.44 21.71L21.71 16.44C21.8927 16.2484 21.9963 15.9948 22 15.73V8.27C21.9963 8.00523 21.8927 7.75163 21.71 7.56ZM20 15.31L15.31 20H8.69L4 15.31V8.69L8.69 4H15.31L20 8.69V15.31Z\"></path></svg> Warning</p> <p>The <code class=\"language-plaintext highlighter-rouge\">view</code> argument performs file system operations like reading a file from disk and evaluating Node.js modules, and as so for security reasons should not contain input from the end-user.</p> </div> <div class=\"doc-box doc-warn\"> <p class=\"doc-title\"><svg viewbox=\"0 0 24 24\" width=\"24\" height=\"24\" fill=\"currentColor\"><path d=\"M12 7C11.7348 7 11.4804 7.10536 11.2929 7.29289C11.1054 7.48043 11 7.73478 11 8V12C11 12.2652 11.1054 12.5196 11.2929 12.7071C11.4804 12.8946 11.7348 13 12 13C12.2652 13 12.5196 12.8946 12.7071 12.7071C12.8946 12.5196 13 12.2652 13 12V8C13 7.73478 12.8946 7.48043 12.7071 7.29289C12.5196 7.10536 12.2652 7 12 7ZM12 15C11.8022 15 11.6089 15.0586 11.4444 15.1685C11.28 15.2784 11.1518 15.4346 11.0761 15.6173C11.0004 15.8 10.9806 16.0011 11.0192 16.1951C11.0578 16.3891 11.153 16.5673 11.2929 16.7071C11.4327 16.847 11.6109 16.9422 11.8049 16.9808C11.9989 17.0194 12.2 16.9996 12.3827 16.9239C12.5654 16.8482 12.7216 16.72 12.8315 16.5556C12.9414 16.3911 13 16.1978 13 16C13 15.7348 12.8946 15.4804 12.7071 15.2929C12.5196 15.1054 12.2652 15 12 15ZM21.71 7.56L16.44 2.29C16.2484 2.10727 15.9948 2.00368 15.73 2H8.27C8.00523 2.00368 7.75163 2.10727 7.56 2.29L2.29 7.56C2.10727 7.75163 2.00368 8.00523 2 8.27V15.73C2.00368 15.9948 2.10727 16.2484 2.29 16.44L7.56 21.71C7.75163 21.8927 8.00523 21.9963 8.27 22H15.73C15.9948 21.9963 16.2484 21.8927 16.44 21.71L21.71 16.44C21.8927 16.2484 21.9963 15.9948 22 15.73V8.27C21.9963 8.00523 21.8927 7.75163 21.71 7.56ZM20 15.31L15.31 20H8.69L4 15.31V8.69L8.69 4H15.31L20 8.69V15.31Z\"></path></svg> Warning</p> <p>The <code class=\"language-plaintext highlighter-rouge\">locals</code> object is used by view engines to render a response. The object keys may be particularly sensitive and should not contain user-controlled input, as it may affect the operation of the view engine or provide a path to cross-site scripting. Consult the documentation for the used view engine for additional considerations.</p> </div> <div class=\"doc-box doc-notice\"> <p class=\"doc-title\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z\"></path></svg> Caution</p> <p>The local variable <code class=\"language-plaintext highlighter-rouge\">cache</code> enables view caching. Set it to <code class=\"language-plaintext highlighter-rouge\">true</code>, to cache the view during development; view caching is enabled in production by default.</p> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// send the rendered view to the client\nres.render('index')\n\n// if a callback is specified, the rendered HTML string has to be sent explicitly\nres.render('index', (err, html) =&gt; {\n  res.send(html)\n})\n\n// pass a local variable to the view\nres.render('user', { name: 'Tobi' }, (err, html) =&gt; {\n  // ...\n})\n</pre></div>    <h3 id=\"res.send\">res.send([body])</h3> <p>Sends the HTTP response.</p> <p>The <code class=\"language-plaintext highlighter-rouge\">body</code> parameter can be a <code class=\"language-plaintext highlighter-rouge\">Buffer</code> object, a <code class=\"language-plaintext highlighter-rouge\">String</code>, an object, <code class=\"language-plaintext highlighter-rouge\">Boolean</code>, or an <code class=\"language-plaintext highlighter-rouge\">Array</code>. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.send(Buffer.from('whoop'))\nres.send({ some: 'json' })\nres.send('&lt;p&gt;some html&lt;/p&gt;')\nres.status(404).send('Sorry, we cannot find that!')\nres.status(500).send({ error: 'something blew up' })\n</pre></div>  <p>This method performs many useful tasks for simple non-streaming responses: For example, it automatically assigns the <code class=\"language-plaintext highlighter-rouge\">Content-Length</code> HTTP response header field and provides automatic HEAD and HTTP cache freshness support.</p> <p>When the parameter is a <code class=\"language-plaintext highlighter-rouge\">Buffer</code> object, the method sets the <code class=\"language-plaintext highlighter-rouge\">Content-Type</code> response header field to “application/octet-stream”, unless previously defined as shown below:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.set('Content-Type', 'text/html')\nres.send(Buffer.from('&lt;p&gt;some html&lt;/p&gt;'))\n</pre></div>  <p>When the parameter is a <code class=\"language-plaintext highlighter-rouge\">String</code>, the method sets the <code class=\"language-plaintext highlighter-rouge\">Content-Type</code> to “text/html”:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.send('&lt;p&gt;some html&lt;/p&gt;')\n</pre></div>  <p>When the parameter is an <code class=\"language-plaintext highlighter-rouge\">Array</code> or <code class=\"language-plaintext highlighter-rouge\">Object</code>, Express responds with the JSON representation:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.send({ user: 'tobi' })\nres.send([1, 2, 3])\n</pre></div>    <h3 id=\"res.sendFile\">res.sendFile(path [, options] [, fn])</h3> <div class=\"doc-box doc-info\"> <p><code class=\"language-plaintext highlighter-rouge\">res.sendFile()</code> is supported by Express v4.8.0 onwards.</p> </div> <p>Transfers the file at the given <code class=\"language-plaintext highlighter-rouge\">path</code>. Sets the <code class=\"language-plaintext highlighter-rouge\">Content-Type</code> response HTTP header field based on the filename’s extension. Unless the <code class=\"language-plaintext highlighter-rouge\">root</code> option is set in the options object, <code class=\"language-plaintext highlighter-rouge\">path</code> must be an absolute path to the file.</p> <div class=\"doc-box doc-warn\"> <p>This API provides access to data on the running file system. Ensure that either (a) the way in which the <code class=\"language-plaintext highlighter-rouge\">path</code> argument was constructed into an absolute path is secure if it contains user input or (b) set the <code class=\"language-plaintext highlighter-rouge\">root</code> option to the absolute path of a directory to contain access within.</p> <p>When the <code class=\"language-plaintext highlighter-rouge\">root</code> option is provided, the <code class=\"language-plaintext highlighter-rouge\">path</code> argument is allowed to be a relative path, including containing <code class=\"language-plaintext highlighter-rouge\">..</code>. Express will validate that the relative path provided as <code class=\"language-plaintext highlighter-rouge\">path</code> will resolve within the given <code class=\"language-plaintext highlighter-rouge\">root</code> option.</p> </div> <p>The following table provides details on the <code class=\"language-plaintext highlighter-rouge\">options</code> parameter.</p> <div class=\"table-scroller\"> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Default</th> <th>Availability</th> </tr> </thead> <tbody> <tr> <td><code class=\"language-plaintext highlighter-rouge\">maxAge</code></td> <td>Sets the max-age property of the <code class=\"language-plaintext highlighter-rouge\">Cache-Control</code> header in milliseconds or a string in <a href=\"https://www.npmjs.org/package/ms\">ms format</a>\n</td> <td>0</td> <td> </td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">root</code></td> <td>Root directory for relative filenames.</td> <td> </td> <td> </td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">lastModified</code></td> <td>Sets the <code class=\"language-plaintext highlighter-rouge\">Last-Modified</code> header to the last modified date of the file on the OS. Set <code class=\"language-plaintext highlighter-rouge\">false</code> to disable it.</td> <td>Enabled</td> <td>4.9.0+</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">headers</code></td> <td>Object containing HTTP headers to serve with the file.</td> <td> </td> <td> </td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">dotfiles</code></td> <td>Option for serving dotfiles. Possible values are “allow”, “deny”, “ignore”.</td> <td>“ignore”</td> <td> </td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">acceptRanges</code></td> <td>Enable or disable accepting ranged requests.</td> <td><code class=\"language-plaintext highlighter-rouge\">true</code></td> <td>4.14+</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">cacheControl</code></td> <td>Enable or disable setting <code class=\"language-plaintext highlighter-rouge\">Cache-Control</code> response header.</td> <td><code class=\"language-plaintext highlighter-rouge\">true</code></td> <td>4.14+</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">immutable</code></td> <td>Enable or disable the <code class=\"language-plaintext highlighter-rouge\">immutable</code> directive in the <code class=\"language-plaintext highlighter-rouge\">Cache-Control</code> response header. If enabled, the <code class=\"language-plaintext highlighter-rouge\">maxAge</code> option should also be specified to enable caching. The <code class=\"language-plaintext highlighter-rouge\">immutable</code> directive will prevent supported clients from making conditional requests during the life of the <code class=\"language-plaintext highlighter-rouge\">maxAge</code> option to check if the file has changed.</td> <td><code class=\"language-plaintext highlighter-rouge\">false</code></td> <td>4.16+</td> </tr> </tbody> </table> </div> <p>The method invokes the callback function <code class=\"language-plaintext highlighter-rouge\">fn(err)</code> when the transfer is complete or when an error occurs. If the callback function is specified and an error occurs, the callback function must explicitly handle the response process either by ending the request-response cycle, or by passing control to the next route.</p> <p>Here is an example of using <code class=\"language-plaintext highlighter-rouge\">res.sendFile</code> with all its arguments.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/file/:name', (req, res, next) =&gt; {\n  const options = {\n    root: path.join(__dirname, 'public'),\n    dotfiles: 'deny',\n    headers: {\n      'x-timestamp': Date.now(),\n      'x-sent': true\n    }\n  }\n\n  const fileName = req.params.name\n  res.sendFile(fileName, options, (err) =&gt; {\n    if (err) {\n      next(err)\n    } else {\n      console.log('Sent:', fileName)\n    }\n  })\n})\n</pre></div>  <p>The following example illustrates using <code class=\"language-plaintext highlighter-rouge\">res.sendFile</code> to provide fine-grained support for serving files:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/user/:uid/photos/:file', (req, res) =&gt; {\n  const uid = req.params.uid\n  const file = req.params.file\n\n  req.user.mayViewFilesFrom(uid, (yes) =&gt; {\n    if (yes) {\n      res.sendFile(`/uploads/${uid}/${file}`)\n    } else {\n      res.status(403).send(\"Sorry! You can't see that.\")\n    }\n  })\n})\n</pre></div>  <p>For more information, or if you have issues or concerns, see <a href=\"https://github.com/pillarjs/send\">send</a>.</p>   <h3 id=\"res.sendStatus\">res.sendStatus(statusCode)</h3> <p>Sets the response HTTP status code to <code class=\"language-plaintext highlighter-rouge\">statusCode</code> and sends the registered status message as the text response body. If an unknown status code is specified, the response body will just be the code number.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.sendStatus(404)\n</pre></div>  <div class=\"doc-box doc-notice\"> <p>Some versions of Node.js will throw when <code class=\"language-plaintext highlighter-rouge\">res.statusCode</code> is set to an invalid HTTP status code (outside of the range <code class=\"language-plaintext highlighter-rouge\">100</code> to <code class=\"language-plaintext highlighter-rouge\">599</code>). Consult the HTTP server documentation for the Node.js version being used.</p> </div> <p><a href=\"http://en.wikipedia.org/wiki/List_of_HTTP_status_codes\">More about HTTP Status Codes</a></p>   <h3 id=\"res.set\">res.set(field [, value])</h3> <p>Sets the response’s HTTP header <code class=\"language-plaintext highlighter-rouge\">field</code> to <code class=\"language-plaintext highlighter-rouge\">value</code>. To set multiple fields at once, pass an object as the parameter.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.set('Content-Type', 'text/plain')\n\nres.set({\n  'Content-Type': 'text/plain',\n  'Content-Length': '123',\n  ETag: '12345'\n})\n</pre></div>  <p>Aliased as <code class=\"language-plaintext highlighter-rouge\">res.header(field [, value])</code>.</p>   <h3 id=\"res.status\">res.status(code)</h3> <p>Sets the HTTP status for the response. It is a chainable alias of Node’s <a href=\"http://nodejs.org/api/http.html#http_response_statuscode\">response.statusCode</a>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.status(403).end()\nres.status(400).send('Bad Request')\nres.status(404).sendFile('/absolute/path/to/404.png')\n</pre></div>    <h3 id=\"res.type\">res.type(type)</h3> <p>Sets the <code class=\"language-plaintext highlighter-rouge\">Content-Type</code> HTTP header to the MIME type as determined by the specified <code class=\"language-plaintext highlighter-rouge\">type</code>. If <code class=\"language-plaintext highlighter-rouge\">type</code> contains the “/” character, then it sets the <code class=\"language-plaintext highlighter-rouge\">Content-Type</code> to the exact value of <code class=\"language-plaintext highlighter-rouge\">type</code>, otherwise it is assumed to be a file extension and the MIME type is looked up using the <code class=\"language-plaintext highlighter-rouge\">contentType()</code> method of the <code class=\"language-plaintext highlighter-rouge\">mime-types</code> package.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.type('.html') // =&gt; 'text/html'\nres.type('html') // =&gt; 'text/html'\nres.type('json') // =&gt; 'application/json'\nres.type('application/json') // =&gt; 'application/json'\nres.type('png') // =&gt; image/png:\n</pre></div>  <p>Aliased as <code class=\"language-plaintext highlighter-rouge\">res.contentType(type)</code>.</p>   <h3 id=\"res.vary\">res.vary(field)</h3> <p>Adds the field to the <code class=\"language-plaintext highlighter-rouge\">Vary</code> response header, if it is not there already.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.vary('User-Agent').render('docs')\n</pre></div>   <h2 id=\"router\">Router</h2>  <p>A <code class=\"language-plaintext highlighter-rouge\">router</code> object is an instance of middleware and routes. You can think of it as a “mini-application,” capable only of performing middleware and routing functions. Every Express application has a built-in app router.</p> <p>A router behaves like middleware itself, so you can use it as an argument to <a href=\"#app.use\">app.use()</a> or as the argument to another router’s <a href=\"#router.use\">use()</a> method.</p> <p>The top-level <code class=\"language-plaintext highlighter-rouge\">express</code> object has a <a href=\"#express.router\">Router()</a> method that creates a new <code class=\"language-plaintext highlighter-rouge\">router</code> object.</p> <p>Once you’ve created a router object, you can add middleware and HTTP method routes (such as <code class=\"language-plaintext highlighter-rouge\">get</code>, <code class=\"language-plaintext highlighter-rouge\">put</code>, <code class=\"language-plaintext highlighter-rouge\">post</code>, and so on) to it just like an application. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// invoked for any requests passed to this router\nrouter.use((req, res, next) =&gt; {\n  // .. some logic here .. like any other middleware\n  next()\n})\n\n// will handle any request that ends in /events\n// depends on where the router is \"use()'d\"\nrouter.get('/events', (req, res, next) =&gt; {\n  // ..\n})\n</pre></div>  <p>You can then use a router for a particular root URL in this way separating your routes into files or even mini-apps.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// only requests to /calendar/* will be sent to our \"router\"\napp.use('/calendar', router)\n</pre></div>  <p>Keep in mind that any middleware applied to a router will run for all requests on that router’s path, even those that aren’t part of the router.</p>  <h3 id=\"router.methods\">Methods</h3>  <h3 id=\"router.all\">router.all(path, [callback, ...] callback)</h3> <p>This method is just like the <code class=\"language-plaintext highlighter-rouge\">router.METHOD()</code> methods, except that it matches all HTTP methods (verbs).</p> <p>This method is extremely useful for mapping “global” logic for specific path prefixes or arbitrary matches. For example, if you placed the following route at the top of all other route definitions, it would require that all routes from that point on would require authentication, and automatically load a user. Keep in mind that these callbacks do not have to act as end points; <code class=\"language-plaintext highlighter-rouge\">loadUser</code> can perform a task, then call <code class=\"language-plaintext highlighter-rouge\">next()</code> to continue matching subsequent routes.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">router.all('{*splat}', requireAuthentication, loadUser)\n</pre></div>  <p>Or the equivalent:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">router.all('{*splat}', requireAuthentication)\nrouter.all('{*splat}', loadUser)\n</pre></div>  <p>Another example of this is white-listed “global” functionality. Here, the example is much like before, but it only restricts paths prefixed with “/api”:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">router.all('/api/{*splat}', requireAuthentication)\n</pre></div>    <h3 id=\"router.METHOD\">router.METHOD(path, [callback, ...] callback)</h3> <p>The <code class=\"language-plaintext highlighter-rouge\">router.METHOD()</code> methods provide the routing functionality in Express, where METHOD is one of the HTTP methods, such as GET, PUT, POST, and so on, in lowercase. Thus, the actual methods are <code class=\"language-plaintext highlighter-rouge\">router.get()</code>, <code class=\"language-plaintext highlighter-rouge\">router.post()</code>, <code class=\"language-plaintext highlighter-rouge\">router.put()</code>, and so on.</p> <div class=\"doc-box doc-info\"> <p>The <code class=\"language-plaintext highlighter-rouge\">router.get()</code> function is automatically called for the HTTP <code class=\"language-plaintext highlighter-rouge\">HEAD</code> method in addition to the <code class=\"language-plaintext highlighter-rouge\">GET</code> method if <code class=\"language-plaintext highlighter-rouge\">router.head()</code> was not called for the path before <code class=\"language-plaintext highlighter-rouge\">router.get()</code>.</p> </div> <p>You can provide multiple callbacks, and all are treated equally, and behave just like middleware, except that these callbacks may invoke <code class=\"language-plaintext highlighter-rouge\">next('route')</code> to bypass the remaining route callback(s). You can use this mechanism to perform pre-conditions on a route then pass control to subsequent routes when there is no reason to proceed with the route matched.</p> <p>The following snippet illustrates the most simple route definition possible. Express translates the path strings to regular expressions, used internally to match incoming requests. Query strings are <em>not</em> considered when performing these matches, for example “GET /” would match the following route, as would “GET /?name=tobi”.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">router.get('/', (req, res) =&gt; {\n  res.send('hello world')\n})\n</pre></div>  <p>You can also use regular expressions—useful if you have very specific constraints, for example the following would match “GET /commits/71dbb9c” as well as “GET /commits/71dbb9c..4c084f9”.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">router.get(/^\\/commits\\/(\\w+)(?:\\.\\.(\\w+))?$/, (req, res) =&gt; {\n  const from = req.params[0]\n  const to = req.params[1] || 'HEAD'\n  res.send(`commit range ${from}..${to}`)\n})\n</pre></div>  <p>You can use <code class=\"language-plaintext highlighter-rouge\">next</code> primitive to implement a flow control between different middleware functions, based on a specific program state. Invoking <code class=\"language-plaintext highlighter-rouge\">next</code> with the string <code class=\"language-plaintext highlighter-rouge\">'router'</code> will cause all the remaining route callbacks on that router to be bypassed.</p> <p>The following example illustrates <code class=\"language-plaintext highlighter-rouge\">next('router')</code> usage.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">function fn (req, res, next) {\n  console.log('I come here')\n  next('router')\n}\nrouter.get('/foo', fn, (req, res, next) =&gt; {\n  console.log('I dont come here')\n})\nrouter.get('/foo', (req, res, next) =&gt; {\n  console.log('I dont come here')\n})\napp.get('/foo', (req, res) =&gt; {\n  console.log(' I come here too')\n  res.end('good')\n})\n</pre></div>    <h3 id=\"router.param\">router.param(name, callback)</h3> <p>Adds callback triggers to route parameters, where <code class=\"language-plaintext highlighter-rouge\">name</code> is the name of the parameter and <code class=\"language-plaintext highlighter-rouge\">callback</code> is the callback function. Although <code class=\"language-plaintext highlighter-rouge\">name</code> is technically optional, using this method without it is deprecated starting with Express v4.11.0 (see below).</p> <p>The parameters of the callback function are:</p> <ul> <li>\n<code class=\"language-plaintext highlighter-rouge\">req</code>, the request object.</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">res</code>, the response object.</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">next</code>, indicating the next middleware function.</li> <li>The value of the <code class=\"language-plaintext highlighter-rouge\">name</code> parameter.</li> <li>The name of the parameter.</li> </ul> <div class=\"doc-box doc-info\"> <p>Unlike <code class=\"language-plaintext highlighter-rouge\">app.param()</code>, <code class=\"language-plaintext highlighter-rouge\">router.param()</code> does not accept an array of route parameters.</p> </div> <p>For example, when <code class=\"language-plaintext highlighter-rouge\">:user</code> is present in a route path, you may map user loading logic to automatically provide <code class=\"language-plaintext highlighter-rouge\">req.user</code> to the route, or perform validations on the parameter input.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">router.param('user', (req, res, next, id) =&gt; {\n  // try to get the user details from the User model and attach it to the request object\n  User.find(id, (err, user) =&gt; {\n    if (err) {\n      next(err)\n    } else if (user) {\n      req.user = user\n      next()\n    } else {\n      next(new Error('failed to load user'))\n    }\n  })\n})\n</pre></div>  <p>Param callback functions are local to the router on which they are defined. They are not inherited by mounted apps or routers, nor are they triggered for route parameters inherited from parent routers. Hence, param callbacks defined on <code class=\"language-plaintext highlighter-rouge\">router</code> will be triggered only by route parameters defined on <code class=\"language-plaintext highlighter-rouge\">router</code> routes.</p> <p>A param callback will be called only once in a request-response cycle, even if the parameter is matched in multiple routes, as shown in the following examples.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">router.param('id', (req, res, next, id) =&gt; {\n  console.log('CALLED ONLY ONCE')\n  next()\n})\n\nrouter.get('/user/:id', (req, res, next) =&gt; {\n  console.log('although this matches')\n  next()\n})\n\nrouter.get('/user/:id', (req, res) =&gt; {\n  console.log('and this matches too')\n  res.end()\n})\n</pre></div>  <p>On <code class=\"language-plaintext highlighter-rouge\">GET /user/42</code>, the following is printed:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">CALLED ONLY ONCE\nalthough this matches\nand this matches too\n</pre></div>    <h3 id=\"router.route\">router.route(path)</h3> <p>Returns an instance of a single route which you can then use to handle HTTP verbs with optional middleware. Use <code class=\"language-plaintext highlighter-rouge\">router.route()</code> to avoid duplicate route naming and thus typing errors.</p> <p>Building on the <code class=\"language-plaintext highlighter-rouge\">router.param()</code> example above, the following code shows how to use <code class=\"language-plaintext highlighter-rouge\">router.route()</code> to specify various HTTP method handlers.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const router = express.Router()\n\nrouter.param('user_id', (req, res, next, id) =&gt; {\n  // sample user, would actually fetch from DB, etc...\n  req.user = {\n    id,\n    name: 'TJ'\n  }\n  next()\n})\n\nrouter.route('/users/:user_id')\n  .all((req, res, next) =&gt; {\n  // runs for all HTTP verbs first\n  // think of it as route specific middleware!\n    next()\n  })\n  .get((req, res, next) =&gt; {\n    res.json(req.user)\n  })\n  .put((req, res, next) =&gt; {\n  // just an example of maybe updating the user\n    req.user.name = req.params.name\n    // save user ... etc\n    res.json(req.user)\n  })\n  .post((req, res, next) =&gt; {\n    next(new Error('not implemented'))\n  })\n  .delete((req, res, next) =&gt; {\n    next(new Error('not implemented'))\n  })\n</pre></div>  <p>This approach re-uses the single <code class=\"language-plaintext highlighter-rouge\">/users/:user_id</code> path and adds handlers for various HTTP methods.</p> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>When you use <code class=\"language-plaintext highlighter-rouge\">router.route()</code>, middleware ordering is based on when the <em>route</em> is created, not when method handlers are added to the route. For this purpose, you can consider method handlers to belong to the route to which they were added.</p> </div>   <h3 id=\"router.use\">router.use([path], [function, ...] function)</h3> <p>Uses the specified middleware function or functions, with optional mount path <code class=\"language-plaintext highlighter-rouge\">path</code>, that defaults to “/”.</p> <p>This method is similar to <a href=\"#app.use\">app.use()</a>. A simple example and use case is described below. See <a href=\"#app.use\">app.use()</a> for more information.</p> <p>Middleware is like a plumbing pipe: requests start at the first middleware function defined and work their way “down” the middleware stack processing for each path they match.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst app = express()\nconst router = express.Router()\n\n// simple logger for this router's requests\n// all requests to this router will first hit this middleware\nrouter.use((req, res, next) =&gt; {\n  console.log('%s %s %s', req.method, req.url, req.path)\n  next()\n})\n\n// this will only be invoked if the path starts with /bar from the mount point\nrouter.use('/bar', (req, res, next) =&gt; {\n  // ... maybe some additional /bar logging ...\n  next()\n})\n\n// always invoked\nrouter.use((req, res, next) =&gt; {\n  res.send('Hello World')\n})\n\napp.use('/foo', router)\n\napp.listen(3000)\n</pre></div>  <p>The “mount” path is stripped and is <em>not</em> visible to the middleware function. The main effect of this feature is that a mounted middleware function may operate without code changes regardless of its “prefix” pathname.</p> <p>The order in which you define middleware with <code class=\"language-plaintext highlighter-rouge\">router.use()</code> is very important. They are invoked sequentially, thus the order defines middleware precedence. For example, usually a logger is the very first middleware you would use, so that every request gets logged.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const logger = require('morgan')\n\nrouter.use(logger())\nrouter.use(express.static(path.join(__dirname, 'public')))\nrouter.use((req, res) =&gt; {\n  res.send('Hello')\n})\n</pre></div>  <p>Now suppose you wanted to ignore logging requests for static files, but to continue logging routes and middleware defined after <code class=\"language-plaintext highlighter-rouge\">logger()</code>. You would simply move the call to <code class=\"language-plaintext highlighter-rouge\">express.static()</code> to the top, before adding the logger middleware:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">router.use(express.static(path.join(__dirname, 'public')))\nrouter.use(logger())\nrouter.use((req, res) =&gt; {\n  res.send('Hello')\n})\n</pre></div>  <p>Another example is serving files from multiple directories, giving precedence to “./public” over the others:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use(express.static(path.join(__dirname, 'public')))\napp.use(express.static(path.join(__dirname, 'files')))\napp.use(express.static(path.join(__dirname, 'uploads')))\n</pre></div>  <p>The <code class=\"language-plaintext highlighter-rouge\">router.use()</code> method also supports named parameters so that your mount points for other routers can benefit from preloading using named parameters.</p> <p><strong>NOTE</strong>: Although these middleware functions are added via a particular router, <em>when</em> they run is defined by the path they are attached to (not the router). Therefore, middleware added via one router may run for other routers if its routes match. For example, this code shows two different routers mounted on the same path:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const authRouter = express.Router()\nconst openRouter = express.Router()\n\nauthRouter.use(require('./authenticate').basic(usersdb))\n\nauthRouter.get('/:user_id/edit', (req, res, next) =&gt; {\n  // ... Edit user UI ...\n})\nopenRouter.get('/', (req, res, next) =&gt; {\n  // ... List users ...\n})\nopenRouter.get('/:user_id', (req, res, next) =&gt; {\n  // ... View user ...\n})\n\napp.use('/users', authRouter)\napp.use('/users', openRouter)\n</pre></div>  <p>Even though the authentication middleware was added via the <code class=\"language-plaintext highlighter-rouge\">authRouter</code> it will run on the routes defined by the <code class=\"language-plaintext highlighter-rouge\">openRouter</code> as well since both routers were mounted on <code class=\"language-plaintext highlighter-rouge\">/users</code>. To avoid this behavior, use different paths for each router.</p>  </div> <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/tree/gh-pages/_includes/api/en/5x\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/5x/api.html\" class=\"_attribution-link\">https://expressjs.com/en/5x/api.html</a>\n  </p>\n</div>\n","starter/hello-world":"<main> <h1 id=\"hello-world-example\" data-level=\"2\">Hello world example</h1> <div class=\"doc-box doc-info\"> <p>Embedded below is essentially the simplest Express app you can create. It is a single file app — <em>not</em> what you’d get if you use the <a href=\"generator\">Express generator</a>, which creates the scaffolding for a full app with numerous JavaScript files, Jade templates, and sub-directories for various purposes.</p> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst app = express()\nconst port = 3000\n\napp.get('/', (req, res) =&gt; {\n  res.send('Hello World!')\n})\n\napp.listen(port, () =&gt; {\n  console.log(`Example app listening on port ${port}`)\n})\n</pre></div> <p>This app starts a server and listens on port 3000 for connections. The app responds with “Hello World!” for requests to the root URL (<code class=\"language-plaintext highlighter-rouge\">/</code>) or <em>route</em>. For every other path, it will respond with a <strong>404 Not Found</strong>.</p> <h3 id=\"running-locally\">Running Locally</h3> <p>First create a directory named <code class=\"language-plaintext highlighter-rouge\">myapp</code>, change to it and run <code class=\"language-plaintext highlighter-rouge\">npm init</code>. Then, install <code class=\"language-plaintext highlighter-rouge\">express</code> as a dependency, as per the <a href=\"installing\">installation guide</a>.</p> <p>In the <code class=\"language-plaintext highlighter-rouge\">myapp</code> directory, create a file named <code class=\"language-plaintext highlighter-rouge\">app.js</code> and copy the code from the example above.</p> <div class=\"doc-box doc-notice\"> <p>The <code class=\"language-plaintext highlighter-rouge\">req</code> (request) and <code class=\"language-plaintext highlighter-rouge\">res</code> (response) are the exact same objects that Node provides, so you can invoke <code class=\"language-plaintext highlighter-rouge\">req.pipe()</code>, <code class=\"language-plaintext highlighter-rouge\">req.on('data', callback)</code>, and anything else you would do without Express involved.</p> </div> <p>Run the app with the following command:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ node app.js\n</pre></div> <p>Then, load <code class=\"language-plaintext highlighter-rouge\">http://localhost:3000/</code> in a browser to see the output.</p>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/starter/hello-world.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/starter/hello-world.html\" class=\"_attribution-link\">https://expressjs.com/en/starter/hello-world.html</a>\n  </p>\n</div>\n","starter/generator":"<main> <h1 id=\"express-application-generator\" data-level=\"3\">Express application generator</h1> <p>Use the application generator tool, <code class=\"language-plaintext highlighter-rouge\">express-generator</code>, to quickly create an application skeleton.</p> <p>You can run the application generator with the <code class=\"language-plaintext highlighter-rouge\">npx</code> command (available in Node.js 8.2.0).</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npx express-generator\n</pre></div> <p>For earlier Node versions, install the application generator as a global npm package and then launch it:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install -g express-generator\n$ express\n</pre></div> <p>Display the command options with the <code class=\"language-plaintext highlighter-rouge\">-h</code> option:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ express -h\n\n  Usage: express [options] [dir]\n\n  Options:\n\n    -h, --help          output usage information\n        --version       output the version number\n    -e, --ejs           add ejs engine support\n        --hbs           add handlebars engine support\n        --pug           add pug engine support\n    -H, --hogan         add hogan.js engine support\n        --no-view       generate without view engine\n    -v, --view &lt;engine&gt; add view &lt;engine&gt; support (ejs|hbs|hjs|jade|pug|twig|vash) (defaults to jade)\n    -c, --css &lt;engine&gt;  add stylesheet &lt;engine&gt; support (less|stylus|compass|sass) (defaults to plain css)\n        --git           add .gitignore\n    -f, --force         force on non-empty directory\n</pre></div> <p>For example, the following creates an Express app named <em>myapp</em>. The app will be created in a folder named <em>myapp</em> in the current working directory and the view engine will be set to <a href=\"https://pugjs.org/\" target=\"_blank\" title=\"Pug documentation\">Pug</a>:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ express --view=pug myapp\n\n   create : myapp\n   create : myapp/package.json\n   create : myapp/app.js\n   create : myapp/public\n   create : myapp/public/javascripts\n   create : myapp/public/images\n   create : myapp/routes\n   create : myapp/routes/index.js\n   create : myapp/routes/users.js\n   create : myapp/public/stylesheets\n   create : myapp/public/stylesheets/style.css\n   create : myapp/views\n   create : myapp/views/index.pug\n   create : myapp/views/layout.pug\n   create : myapp/views/error.pug\n   create : myapp/bin\n   create : myapp/bin/www\n</pre></div> <p>Then install dependencies:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ cd myapp\n$ npm install\n</pre></div> <p>On MacOS or Linux, run the app with this command:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ DEBUG=myapp:* npm start\n</pre></div> <p>On Windows Command Prompt, use this command:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">&gt; set DEBUG=myapp:* &amp; npm start\n</pre></div> <p>On Windows PowerShell, use this command:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">PS&gt; $env:DEBUG='myapp:*'; npm start\n</pre></div> <p>Then, load <code class=\"language-plaintext highlighter-rouge\">http://localhost:3000/</code> in your browser to access the app.</p> <p>The generated app has the following directory structure:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">.\n├── app.js\n├── bin\n│   └── www\n├── package.json\n├── public\n│   ├── images\n│   ├── javascripts\n│   └── stylesheets\n│       └── style.css\n├── routes\n│   ├── index.js\n│   └── users.js\n└── views\n    ├── error.pug\n    ├── index.pug\n    └── layout.pug\n\n7 directories, 9 files\n</pre></div> <div class=\"doc-box doc-info\"> <p>The app structure created by the generator is just one of many ways to structure Express apps. Feel free to use this structure or modify it to best suit your needs.</p> </div>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/starter/generator.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/starter/generator.html\" class=\"_attribution-link\">https://expressjs.com/en/starter/generator.html</a>\n  </p>\n</div>\n","starter/basic-routing":"<main> <h1 id=\"basic-routing\" data-level=\"4\">Basic routing</h1> <p><em>Routing</em> refers to determining how an application responds to a client request to a particular endpoint, which is a URI (or path) and a specific HTTP request method (GET, POST, and so on).</p> <p>Each route can have one or more handler functions, which are executed when the route is matched.</p> <p>Route definition takes the following structure:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.METHOD(PATH, HANDLER)\n</pre></div> <p>Where:</p> <ul> <li>\n<code class=\"language-plaintext highlighter-rouge\">app</code> is an instance of <code class=\"language-plaintext highlighter-rouge\">express</code>.</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">METHOD</code> is an <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Methods\">HTTP request method</a>, in lowercase.</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">PATH</code> is a path on the server.</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">HANDLER</code> is the function executed when the route is matched.</li> </ul> <div class=\"doc-box doc-notice\"> <p>This tutorial assumes that an instance of <code class=\"language-plaintext highlighter-rouge\">express</code> named <code class=\"language-plaintext highlighter-rouge\">app</code> is created and the server is running. If you are not familiar with creating an app and starting it, see the <a href=\"hello-world\">Hello world example</a>.</p> </div> <p>The following examples illustrate defining simple routes.</p> <p>Respond with <code class=\"language-plaintext highlighter-rouge\">Hello World!</code> on the homepage:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/', (req, res) =&gt; {\n  res.send('Hello World!')\n})\n</pre></div> <p>Respond to a POST request on the root route (<code class=\"language-plaintext highlighter-rouge\">/</code>), the application’s home page:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.post('/', (req, res) =&gt; {\n  res.send('Got a POST request')\n})\n</pre></div> <p>Respond to a PUT request to the <code class=\"language-plaintext highlighter-rouge\">/user</code> route:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.put('/user', (req, res) =&gt; {\n  res.send('Got a PUT request at /user')\n})\n</pre></div> <p>Respond to a DELETE request to the <code class=\"language-plaintext highlighter-rouge\">/user</code> route:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.delete('/user', (req, res) =&gt; {\n  res.send('Got a DELETE request at /user')\n})\n</pre></div> <p>For more details about routing, see the <a href=\"../guide/routing\">routing guide</a>.</p>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/starter/basic-routing.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/starter/basic-routing.html\" class=\"_attribution-link\">https://expressjs.com/en/starter/basic-routing.html</a>\n  </p>\n</div>\n","guide/using-template-engines":"<main> <h1 id=\"using-template-engines-with-express\" data-level=\"5\">Using template engines with Express</h1> <p>A <em>template engine</em> enables you to use static template files in your application. At runtime, the template engine replaces variables in a template file with actual values, and transforms the template into an HTML file sent to the client. This approach makes it easier to design an HTML page.</p> <p>The <a href=\"../starter/generator\">Express application generator</a> uses <a href=\"https://pugjs.org/api/getting-started.html\">Pug</a> as its default, but it also supports <a href=\"https://www.npmjs.com/package/handlebars\">Handlebars</a>, and <a href=\"https://www.npmjs.com/package/ejs\">EJS</a>, among others.</p> <p>To render template files, set the following <a href=\"https://expressjs.com/en/index.html#app.set\">application setting properties</a>, in the default <code class=\"language-plaintext highlighter-rouge\">app.js</code> created by the generator:</p> <ul> <li>\n<code class=\"language-plaintext highlighter-rouge\">views</code>, the directory where the template files are located. Eg: <code class=\"language-plaintext highlighter-rouge\">app.set('views', './views')</code>. This defaults to the <code class=\"language-plaintext highlighter-rouge\">views</code> directory in the application root directory.</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">view engine</code>, the template engine to use. For example, to use the Pug template engine: <code class=\"language-plaintext highlighter-rouge\">app.set('view engine', 'pug')</code>.</li> </ul> <p>Then install the corresponding template engine npm package; for example to install Pug:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install pug --save\n</pre></div> <div class=\"doc-box doc-notice\"> <p>Express-compliant template engines such as Pug export a function named <code class=\"language-plaintext highlighter-rouge\">__express(filePath, options, callback)</code>, which <code class=\"language-plaintext highlighter-rouge\">res.render()</code> calls to render the template code.</p> <p>Some template engines do not follow this convention. The <a href=\"https://www.npmjs.com/package/@ladjs/consolidate\">@ladjs/consolidate</a> library follows this convention by mapping all of the popular Node.js template engines, and therefore works seamlessly within Express.</p> </div> <p>After the view engine is set, you don’t have to specify the engine or load the template engine module in your app; Express loads the module internally, for example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.set('view engine', 'pug')\n</pre></div> <p>Then, create a Pug template file named <code class=\"language-plaintext highlighter-rouge\">index.pug</code> in the <code class=\"language-plaintext highlighter-rouge\">views</code> directory, with the following content:</p> <pre data-language=\"pug\">html\n  head\n    title= title\n  body\n    h1= message\n</pre> <p>Create a route to render the <code class=\"language-plaintext highlighter-rouge\">index.pug</code> file. If the <code class=\"language-plaintext highlighter-rouge\">view engine</code> property is not set, you must specify the extension of the <code class=\"language-plaintext highlighter-rouge\">view</code> file. Otherwise, you can omit it.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/', (req, res) =&gt; {\n  res.render('index', { title: 'Hey', message: 'Hello there!' })\n})\n</pre></div> <p>When you make a request to the home page, the <code class=\"language-plaintext highlighter-rouge\">index.pug</code> file will be rendered as HTML.</p> <p>The view engine cache does not cache the contents of the template’s output, only the underlying template itself. The view is still re-rendered with every request even when the cache is on.</p>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/guide/using-template-engines.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/guide/using-template-engines.html\" class=\"_attribution-link\">https://expressjs.com/en/guide/using-template-engines.html</a>\n  </p>\n</div>\n","advanced/healthcheck-graceful-shutdown":"<main> <h1 id=\"health-checks-and-graceful-shutdown\" data-level=\"5\">Health Checks and Graceful Shutdown</h1> <h2 id=\"graceful-shutdown\">Graceful shutdown</h2> <p>When you deploy a new version of your application, you must replace the previous version. The process manager you’re using will first send a SIGTERM signal to the application to notify it that it will be killed. Once the application gets this signal, it should stop accepting new requests, finish all the ongoing requests, clean up the resources it used, including database connections and file locks then exit.</p> <h3 id=\"example\">Example</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const server = app.listen(port)\n\nprocess.on('SIGTERM', () =&gt; {\n  debug('SIGTERM signal received: closing HTTP server')\n  server.close(() =&gt; {\n    debug('HTTP server closed')\n  })\n})\n</pre></div> <h2 id=\"health-checks\">Health checks</h2> <p>A load balancer uses health checks to determine if an application instance is healthy and can accept requests. For example, <a href=\"https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/\">Kubernetes has two health checks</a>:</p> <ul> <li>\n<code class=\"language-plaintext highlighter-rouge\">liveness</code>, that determines when to restart a container.</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">readiness</code>, that determines when a container is ready to start accepting traffic. When a pod is not ready, it is removed from the service load balancers.</li> </ul>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/advanced/healthcheck-graceful-shutdown.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/advanced/healthcheck-graceful-shutdown.html\" class=\"_attribution-link\">https://expressjs.com/en/advanced/healthcheck-graceful-shutdown.html</a>\n  </p>\n</div>\n","starter/installing":"<main> <h1 id=\"installing\" data-level=\"1\">Installing</h1> <p>Assuming you’ve already installed <a href=\"https://nodejs.org/\">Node.js</a>, create a directory to hold your application, and make that your working directory.</p> <ul> <li>\n<a href=\"https://expressjs.com/en/index.html\">Express 4.x</a> requires Node.js 0.10 or higher.</li> <li>\n<a href=\"../index\">Express 5.x</a> requires Node.js 18 or higher.</li> </ul> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ mkdir myapp\n$ cd myapp\n</pre></div> <p>Use the <code class=\"language-plaintext highlighter-rouge\">npm init</code> command to create a <code class=\"language-plaintext highlighter-rouge\">package.json</code> file for your application. For more information on how <code class=\"language-plaintext highlighter-rouge\">package.json</code> works, see <a href=\"https://docs.npmjs.com/files/package.json\">Specifics of npm’s package.json handling</a>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm init\n</pre></div> <p>This command prompts you for a number of things, such as the name and version of your application. For now, you can simply hit RETURN to accept the defaults for most of them, with the following exception:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">entry point: (index.js)\n</pre></div> <p>Enter <code class=\"language-plaintext highlighter-rouge\">app.js</code>, or whatever you want the name of the main file to be. If you want it to be <code class=\"language-plaintext highlighter-rouge\">index.js</code>, hit RETURN to accept the suggested default file name.</p> <p>Now, install Express in the <code class=\"language-plaintext highlighter-rouge\">myapp</code> directory and save it in the dependencies list. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install express\n</pre></div> <p>To install Express temporarily and not add it to the dependencies list:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install express --no-save\n</pre></div> <div class=\"doc-box doc-info\"> <p>By default with version npm 5.0+, <code class=\"language-plaintext highlighter-rouge\">npm install</code> adds the module to the <code class=\"language-plaintext highlighter-rouge\">dependencies</code> list in the <code class=\"language-plaintext highlighter-rouge\">package.json</code> file; with earlier versions of npm, you must specify the <code class=\"language-plaintext highlighter-rouge\">--save</code> option explicitly. Then, afterwards, running <code class=\"language-plaintext highlighter-rouge\">npm install</code> in the app directory will automatically install modules in the dependencies list.</p> </div>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/starter/installing.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/starter/installing.html\" class=\"_attribution-link\">https://expressjs.com/en/starter/installing.html</a>\n  </p>\n</div>\n","advanced/best-practice-security":"<main> <h1 id=\"production-best-practices-security\" data-level=\"3\">Production Best Practices: Security</h1> <h2 id=\"overview\">Overview</h2> <p>The term <em>“production”</em> refers to the stage in the software lifecycle when an application or API is generally available to its end-users or consumers. In contrast, in the <em>“development”</em> stage, you’re still actively writing and testing code, and the application is not open to external access. The corresponding system environments are known as <em>production</em> and <em>development</em> environments, respectively.</p> <p>Development and production environments are usually set up differently and have vastly different requirements. What’s fine in development may not be acceptable in production. For example, in a development environment you may want verbose logging of errors for debugging, while the same behavior can become a security concern in a production environment. And in development, you don’t need to worry about scalability, reliability, and performance, while those concerns become critical in production.</p> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>If you believe you have discovered a security vulnerability in Express, please see <a href=\"https://expressjs.com/en/resources/contributing.html#security-policies-and-procedures\">Security Policies and Procedures</a>.</p> </div> <p>Security best practices for Express applications in production include:</p> <ul> <li>\n<a href=\"#production-best-practices-security\">Production Best Practices: Security</a> <ul> <li><a href=\"#overview\">Overview</a></li> <li><a href=\"#dont-use-deprecated-or-vulnerable-versions-of-express\">Don’t use deprecated or vulnerable versions of Express</a></li> <li><a href=\"#use-tls\">Use TLS</a></li> <li>\n<a href=\"#do-not-trust-user-input\">Do not trust user input</a> <ul> <li><a href=\"#prevent-open-redirects\">Prevent open redirects</a></li> </ul> </li> <li><a href=\"#use-helmet\">Use Helmet</a></li> <li><a href=\"#reduce-fingerprinting\">Reduce fingerprinting</a></li> <li>\n<a href=\"#use-cookies-securely\">Use cookies securely</a> <ul> <li><a href=\"#dont-use-the-default-session-cookie-name\">Don’t use the default session cookie name</a></li> <li><a href=\"#set-cookie-security-options\">Set cookie security options</a></li> </ul> </li> <li><a href=\"#prevent-brute-force-attacks-against-authorization\">Prevent brute-force attacks against authorization</a></li> <li>\n<a href=\"#ensure-your-dependencies-are-secure\">Ensure your dependencies are secure</a> <ul> <li><a href=\"#avoid-other-known-vulnerabilities\">Avoid other known vulnerabilities</a></li> </ul> </li> <li><a href=\"#additional-considerations\">Additional considerations</a></li> </ul> </li> </ul> <h2 id=\"dont-use-deprecated-or-vulnerable-versions-of-express\">Don’t use deprecated or vulnerable versions of Express</h2> <p>Express 2.x and 3.x are no longer maintained. Security and performance issues in these versions won’t be fixed. Do not use them! If you haven’t moved to version 4, follow the <a href=\"../guide/migrating-4\">migration guide</a> or consider <a href=\"https://expressjs.com/en/support#commercial-support-options\">Commercial Support Options</a>.</p> <p>Also ensure you are not using any of the vulnerable Express versions listed on the <a href=\"security-updates\">Security updates page</a>. If you are, update to one of the stable releases, preferably the latest.</p> <h2 id=\"use-tls\">Use TLS</h2> <p>If your app deals with or transmits sensitive data, use <a href=\"https://en.wikipedia.org/wiki/Transport_Layer_Security\">Transport Layer Security</a> (TLS) to secure the connection and the data. This technology encrypts data before it is sent from the client to the server, thus preventing some common (and easy) hacks. Although Ajax and POST requests might not be visibly obvious and seem “hidden” in browsers, their network traffic is vulnerable to <a href=\"https://en.wikipedia.org/wiki/Packet_analyzer\">packet sniffing</a> and <a href=\"https://en.wikipedia.org/wiki/Man-in-the-middle_attack\">man-in-the-middle attacks</a>.</p> <p>You may be familiar with Secure Socket Layer (SSL) encryption. <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa380515(v=vs.85).aspx\">TLS is simply the next progression of SSL</a>. In other words, if you were using SSL before, consider upgrading to TLS. In general, we recommend Nginx to handle TLS. For a good reference to configure TLS on Nginx (and other servers), see <a href=\"https://wiki.mozilla.org/Security/Server_Side_TLS#Recommended_Server_Configurations\">Recommended Server Configurations (Mozilla Wiki)</a>.</p> <p>Also, a handy tool to get a free TLS certificate is <a href=\"https://letsencrypt.org/about/\">Let’s Encrypt</a>, a free, automated, and open certificate authority (CA) provided by the <a href=\"https://www.abetterinternet.org/\">Internet Security Research Group (ISRG)</a>.</p> <h2 id=\"do-not-trust-user-input\">Do not trust user input</h2> <p>For web applications, one of the most critical security requirements is proper user input validation and handling. This comes in many forms and we will not cover all of them here. Ultimately, the responsibility for validating and correctly handling the types of user input your application accepts is yours.</p> <h3 id=\"prevent-open-redirects\">Prevent open redirects</h3> <p>An example of potentially dangerous user input is an <em>open redirect</em>, where an application accepts a URL as user input (often in the URL query, for example <code class=\"language-plaintext highlighter-rouge\">?url=https://example.com</code>) and uses <code class=\"language-plaintext highlighter-rouge\">res.redirect</code> to set the <code class=\"language-plaintext highlighter-rouge\">location</code> header and return a 3xx status.</p> <p>An application must validate that it supports redirecting to the incoming URL to avoid sending users to malicious links such as phishing websites, among other risks.</p> <p>Here is an example of checking URLs before using <code class=\"language-plaintext highlighter-rouge\">res.redirect</code> or <code class=\"language-plaintext highlighter-rouge\">res.location</code>:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use((req, res) =&gt; {\n  try {\n    if (new Url(req.query.url).host !== 'example.com') {\n      return res.status(400).end(`Unsupported redirect to host: ${req.query.url}`)\n    }\n  } catch (e) {\n    return res.status(400).end(`Invalid url: ${req.query.url}`)\n  }\n  res.redirect(req.query.url)\n})\n</pre></div> <h2 id=\"use-helmet\">Use Helmet</h2> <p><a href=\"https://helmetjs.github.io/\">Helmet</a> can help protect your app from some well-known web vulnerabilities by setting HTTP headers appropriately.</p> <p>Helmet is a middleware function that sets security-related HTTP response headers. Helmet sets the following headers by default:</p> <ul> <li>\n<code class=\"language-plaintext highlighter-rouge\">Content-Security-Policy</code>: A powerful allow-list of what can happen on your page which mitigates many attacks</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">Cross-Origin-Opener-Policy</code>: Helps process-isolate your page</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">Cross-Origin-Resource-Policy</code>: Blocks others from loading your resources cross-origin</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">Origin-Agent-Cluster</code>: Changes process isolation to be origin-based</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">Referrer-Policy</code>: Controls the <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer\"><code class=\"language-plaintext highlighter-rouge\">Referer</code></a> header</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">Strict-Transport-Security</code>: Tells browsers to prefer HTTPS</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">X-Content-Type-Options</code>: Avoids <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types#mime_sniffing\">MIME sniffing</a>\n</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">X-DNS-Prefetch-Control</code>: Controls DNS prefetching</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">X-Download-Options</code>: Forces downloads to be saved (Internet Explorer only)</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">X-Frame-Options</code>: Legacy header that mitigates <a href=\"https://en.wikipedia.org/wiki/Clickjacking\">Clickjacking</a> attacks</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">X-Permitted-Cross-Domain-Policies</code>: Controls cross-domain behavior for Adobe products, like Acrobat</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">X-Powered-By</code>: Info about the web server. Removed because it could be used in simple attacks</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">X-XSS-Protection</code>: Legacy header that tries to mitigate <a href=\"https://developer.mozilla.org/en-US/docs/Glossary/Cross-site_scripting\">XSS attacks</a>, but makes things worse, so Helmet disables it</li> </ul> <p>Each header can be configured or disabled. To read more about it please go to <a href=\"https://helmetjs.github.io/\">its documentation website</a>.</p> <p>Install Helmet like any other module:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install helmet\n</pre></div> <p>Then to use it in your code:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// ...\n\nconst helmet = require('helmet')\napp.use(helmet())\n\n// ...\n</pre></div> <h2 id=\"reduce-fingerprinting\">Reduce fingerprinting</h2> <p>It can help to provide an extra layer of security to reduce the ability of attackers to determine the software that a server uses, known as “fingerprinting.” Though not a security issue itself, reducing the ability to fingerprint an application improves its overall security posture. Server software can be fingerprinted by quirks in how it responds to specific requests, for example in the HTTP response headers.</p> <p>By default, Express sends the <code class=\"language-plaintext highlighter-rouge\">X-Powered-By</code> response header that you can disable using the <code class=\"language-plaintext highlighter-rouge\">app.disable()</code> method:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.disable('x-powered-by')\n</pre></div> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>Disabling the <code class=\"language-plaintext highlighter-rouge\">X-Powered-By header</code> does not prevent a sophisticated attacker from determining that an app is running Express. It may discourage a casual exploit, but there are other ways to determine an app is running Express.</p> </div> <p>Express also sends its own formatted “404 Not Found” messages and formatter error response messages. These can be changed by <a href=\"../starter/faq#how-do-i-handle-404-responses\">adding your own not found handler</a> and <a href=\"../guide/error-handling#writing-error-handlers\">writing your own error handler</a>:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// last app.use calls right before app.listen():\n\n// custom 404\napp.use((req, res, next) =&gt; {\n  res.status(404).send(\"Sorry can't find that!\")\n})\n\n// custom error handler\napp.use((err, req, res, next) =&gt; {\n  console.error(err.stack)\n  res.status(500).send('Something broke!')\n})\n</pre></div> <h2 id=\"use-cookies-securely\">Use cookies securely</h2> <p>To ensure cookies don’t open your app to exploits, don’t use the default session cookie name and set cookie security options appropriately.</p> <p>There are two main middleware cookie session modules:</p> <ul> <li>\n<a href=\"https://www.npmjs.com/package/express-session\">express-session</a> that replaces <code class=\"language-plaintext highlighter-rouge\">express.session</code> middleware built-in to Express 3.x.</li> <li>\n<a href=\"https://www.npmjs.com/package/cookie-session\">cookie-session</a> that replaces <code class=\"language-plaintext highlighter-rouge\">express.cookieSession</code> middleware built-in to Express 3.x.</li> </ul> <p>The main difference between these two modules is how they save cookie session data. The <a href=\"https://www.npmjs.com/package/express-session\">express-session</a> middleware stores session data on the server; it only saves the session ID in the cookie itself, not session data. By default, it uses in-memory storage and is not designed for a production environment. In production, you’ll need to set up a scalable session-store; see the list of <a href=\"https://github.com/expressjs/session#compatible-session-stores\">compatible session stores</a>.</p> <p>In contrast, <a href=\"https://www.npmjs.com/package/cookie-session\">cookie-session</a> middleware implements cookie-backed storage: it serializes the entire session to the cookie, rather than just a session key. Only use it when session data is relatively small and easily encoded as primitive values (rather than objects). Although browsers are supposed to support at least 4096 bytes per cookie, to ensure you don’t exceed the limit, don’t exceed a size of 4093 bytes per domain. Also, be aware that the cookie data will be visible to the client, so if there is any reason to keep it secure or obscure, then <code class=\"language-plaintext highlighter-rouge\">express-session</code> may be a better choice.</p> <h3 id=\"dont-use-the-default-session-cookie-name\">Don’t use the default session cookie name</h3> <p>Using the default session cookie name can open your app to attacks. The security issue posed is similar to <code class=\"language-plaintext highlighter-rouge\">X-Powered-By</code>: a potential attacker can use it to fingerprint the server and target attacks accordingly.</p> <p>To avoid this problem, use generic cookie names; for example using <a href=\"https://www.npmjs.com/package/express-session\">express-session</a> middleware:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const session = require('express-session')\napp.set('trust proxy', 1) // trust first proxy\napp.use(session({\n  secret: 's3Cur3',\n  name: 'sessionId'\n}))\n</pre></div> <h3 id=\"set-cookie-security-options\">Set cookie security options</h3> <p>Set the following cookie options to enhance security:</p> <ul> <li>\n<code class=\"language-plaintext highlighter-rouge\">secure</code> - Ensures the browser only sends the cookie over HTTPS.</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">httpOnly</code> - Ensures the cookie is sent only over HTTP(S), not client JavaScript, helping to protect against cross-site scripting attacks.</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">domain</code> - indicates the domain of the cookie; use it to compare against the domain of the server in which the URL is being requested. If they match, then check the path attribute next.</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">path</code> - indicates the path of the cookie; use it to compare against the request path. If this and domain match, then send the cookie in the request.</li> <li>\n<code class=\"language-plaintext highlighter-rouge\">expires</code> - use to set expiration date for persistent cookies.</li> </ul> <p>Here is an example using <a href=\"https://www.npmjs.com/package/cookie-session\">cookie-session</a> middleware:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const session = require('cookie-session')\nconst express = require('express')\nconst app = express()\n\nconst expiryDate = new Date(Date.now() + 60 * 60 * 1000) // 1 hour\napp.use(session({\n  name: 'session',\n  keys: ['key1', 'key2'],\n  cookie: {\n    secure: true,\n    httpOnly: true,\n    domain: 'example.com',\n    path: 'foo/bar',\n    expires: expiryDate\n  }\n}))\n</pre></div> <h2 id=\"prevent-brute-force-attacks-against-authorization\">Prevent brute-force attacks against authorization</h2> <p>Make sure login endpoints are protected to make private data more secure.</p> <p>A simple and powerful technique is to block authorization attempts using two metrics:</p> <ol> <li>The number of consecutive failed attempts by the same user name and IP address.</li> <li>The number of failed attempts from an IP address over some long period of time. For example, block an IP address if it makes 100 failed attempts in one day.</li> </ol> <p><a href=\"https://github.com/animir/node-rate-limiter-flexible\">rate-limiter-flexible</a> package provides tools to make this technique easy and fast. You can find <a href=\"https://github.com/animir/node-rate-limiter-flexible/wiki/Overall-example#login-endpoint-protection\">an example of brute-force protection in the documentation</a></p> <h2 id=\"ensure-your-dependencies-are-secure\">Ensure your dependencies are secure</h2> <p>Using npm to manage your application’s dependencies is powerful and convenient. But the packages that you use may contain critical security vulnerabilities that could also affect your application. The security of your app is only as strong as the “weakest link” in your dependencies.</p> <p>Since npm@6, npm automatically reviews every install request. Also, you can use <code class=\"language-plaintext highlighter-rouge\">npm audit</code> to analyze your dependency tree.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm audit\n</pre></div> <p>If you want to stay more secure, consider <a href=\"https://snyk.io/\">Snyk</a>.</p> <p>Snyk offers both a <a href=\"https://www.npmjs.com/package/snyk\">command-line tool</a> and a <a href=\"https://snyk.io/docs/github\">Github integration</a> that checks your application against <a href=\"https://snyk.io/vuln/\">Snyk’s open source vulnerability database</a> for any known vulnerabilities in your dependencies. Install the CLI as follows:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install -g snyk\n$ cd your-app\n</pre></div> <p>Use this command to test your application for vulnerabilities:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ snyk test\n</pre></div> <h3 id=\"avoid-other-known-vulnerabilities\">Avoid other known vulnerabilities</h3> <p>Keep an eye out for <a href=\"https://npmjs.com/advisories\">Node Security Project</a> or <a href=\"https://snyk.io/vuln/\">Snyk</a> advisories that may affect Express or other modules that your app uses. In general, these databases are excellent resources for knowledge and tools about Node security.</p> <p>Finally, Express apps—like any other web apps—can be vulnerable to a variety of web-based attacks. Familiarize yourself with known <a href=\"https://www.owasp.org/www-project-top-ten/\">web vulnerabilities</a> and take precautions to avoid them.</p> <h2 id=\"additional-considerations\">Additional considerations</h2> <p>Here are some further recommendations from the excellent <a href=\"https://blog.risingstack.com/node-js-security-checklist/\">Node.js Security Checklist</a>. Refer to that blog post for all the details on these recommendations:</p> <ul> <li>Always filter and sanitize user input to protect against cross-site scripting (XSS) and command injection attacks.</li> <li>Defend against SQL injection attacks by using parameterized queries or prepared statements.</li> <li>Use the open-source <a href=\"http://sqlmap.org/\">sqlmap</a> tool to detect SQL injection vulnerabilities in your app.</li> <li>Use the <a href=\"https://nmap.org/\">nmap</a> and <a href=\"https://github.com/nabla-c0d3/sslyze\">sslyze</a> tools to test the configuration of your SSL ciphers, keys, and renegotiation as well as the validity of your certificate.</li> <li>Use <a href=\"https://www.npmjs.com/package/safe-regex\">safe-regex</a> to ensure your regular expressions are not susceptible to <a href=\"https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS\">regular expression denial of service</a> attacks.</li> </ul>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/advanced/best-practice-security.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/advanced/best-practice-security.html\" class=\"_attribution-link\">https://expressjs.com/en/advanced/best-practice-security.html</a>\n  </p>\n</div>\n","starter/static-files":"<main> <h1 id=\"serving-static-files-in-express\" data-level=\"5\">Serving static files in Express</h1> <p>To serve static files such as images, CSS files, and JavaScript files, use the <code class=\"language-plaintext highlighter-rouge\">express.static</code> built-in middleware function in Express.</p> <p>The function signature is:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">express.static(root, [options])\n</pre></div> <p>The <code class=\"language-plaintext highlighter-rouge\">root</code> argument specifies the root directory from which to serve static assets. For more information on the <code class=\"language-plaintext highlighter-rouge\">options</code> argument, see <a href=\"../5x/api#express.static\">express.static</a>.</p> <p>For example, use the following code to serve images, CSS files, and JavaScript files in a directory named <code class=\"language-plaintext highlighter-rouge\">public</code>:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use(express.static('public'))\n</pre></div> <p>Now, you can load the files that are in the <code class=\"language-plaintext highlighter-rouge\">public</code> directory:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">http://localhost:3000/images/kitten.jpg\nhttp://localhost:3000/css/style.css\nhttp://localhost:3000/js/app.js\nhttp://localhost:3000/images/bg.png\nhttp://localhost:3000/hello.html\n</pre></div> <div class=\"doc-box doc-info\"> Express looks up the files relative to the static directory, so the name of the static directory is not part of the URL. </div> <p>To use multiple static assets directories, call the <code class=\"language-plaintext highlighter-rouge\">express.static</code> middleware function multiple times:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use(express.static('public'))\napp.use(express.static('files'))\n</pre></div> <p>Express looks up the files in the order in which you set the static directories with the <code class=\"language-plaintext highlighter-rouge\">express.static</code> middleware function.</p> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>For best results, <a href=\"../advanced/best-practice-performance#use-a-reverse-proxy\">use a reverse proxy</a> cache to improve performance of serving static assets.</p> </div> <p>To create a virtual path prefix (where the path does not actually exist in the file system) for files that are served by the <code class=\"language-plaintext highlighter-rouge\">express.static</code> function, <a href=\"../5x/api#app.use\">specify a mount path</a> for the static directory, as shown below:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use('/static', express.static('public'))\n</pre></div> <p>Now, you can load the files that are in the <code class=\"language-plaintext highlighter-rouge\">public</code> directory from the <code class=\"language-plaintext highlighter-rouge\">/static</code> path prefix.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">http://localhost:3000/static/images/kitten.jpg\nhttp://localhost:3000/static/css/style.css\nhttp://localhost:3000/static/js/app.js\nhttp://localhost:3000/static/images/bg.png\nhttp://localhost:3000/static/hello.html\n</pre></div> <p>However, the path that you provide to the <code class=\"language-plaintext highlighter-rouge\">express.static</code> function is relative to the directory from where you launch your <code class=\"language-plaintext highlighter-rouge\">node</code> process. If you run the express app from another directory, it’s safer to use the absolute path of the directory that you want to serve:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const path = require('path')\napp.use('/static', express.static(path.join(__dirname, 'public')))\n</pre></div> <p>For more details about the <code class=\"language-plaintext highlighter-rouge\">serve-static</code> function and its options, see <a href=\"https://expressjs.com/resources/middleware/serve-static.html\">serve-static</a>.</p>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/starter/static-files.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/starter/static-files.html\" class=\"_attribution-link\">https://expressjs.com/en/starter/static-files.html</a>\n  </p>\n</div>\n","guide/behind-proxies":"<main> <h1 id=\"express-behind-proxies\" data-level=\"8\">Express behind proxies</h1> <p>When running an Express app behind a reverse proxy, some of the Express APIs may return different values than expected. In order to adjust for this, the <code class=\"language-plaintext highlighter-rouge\">trust proxy</code> application setting may be used to expose information provided by the reverse proxy in the Express APIs. The most common issue is express APIs that expose the client’s IP address may instead show an internal IP address of the reverse proxy.</p> <div class=\"doc-box doc-info\"> <p>When configuring the <code class=\"language-plaintext highlighter-rouge\">trust proxy</code> setting, it is important to understand the exact setup of the reverse proxy. Since this setting will trust values provided in the request, it is important that the combination of the setting in Express matches how the reverse proxy operates.</p> </div> <p>The application setting <code class=\"language-plaintext highlighter-rouge\">trust proxy</code> may be set to one of the values listed in the following table.</p> <table class=\"doctable\"> <thead><tr>\n<th>Type</th>\n<th>Value</th>\n</tr></thead> <tbody> <tr> <td>Boolean</td> <td> <p>If <code class=\"language-plaintext highlighter-rouge\">true</code>, the client’s IP address is understood as the left-most entry in the <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-For</code> header.</p> <p>If <code class=\"language-plaintext highlighter-rouge\">false</code>, the app is understood as directly facing the client and the client’s IP address is derived from <code class=\"language-plaintext highlighter-rouge\">req.socket.remoteAddress</code>. This is the default setting.</p> <div class=\"doc-box doc-warn\"> <p>When setting to <code class=\"language-plaintext highlighter-rouge\">true</code>, it is important to ensure that the last reverse proxy trusted is removing/overwriting all of the following HTTP headers: <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-For</code>, <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-Host</code>, and <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-Proto</code>, otherwise it may be possible for the client to provide any value.</p> </div> </td> </tr> <tr> <td>IP addresses</td> <td> <p>An IP address, subnet, or an array of IP addresses and subnets to trust as being a reverse proxy. The following list shows the pre-configured subnet names:</p> <ul> <li>loopback - <code class=\"language-plaintext highlighter-rouge\">127.0.0.1/8</code>, <code class=\"language-plaintext highlighter-rouge\">::1/128</code>\n</li> <li>linklocal - <code class=\"language-plaintext highlighter-rouge\">169.254.0.0/16</code>, <code class=\"language-plaintext highlighter-rouge\">fe80::/10</code>\n</li> <li>uniquelocal - <code class=\"language-plaintext highlighter-rouge\">10.0.0.0/8</code>, <code class=\"language-plaintext highlighter-rouge\">172.16.0.0/12</code>, <code class=\"language-plaintext highlighter-rouge\">192.168.0.0/16</code>, <code class=\"language-plaintext highlighter-rouge\">fc00::/7</code>\n</li> </ul> <p>You can set IP addresses in any of the following ways:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.set('trust proxy', 'loopback') // specify a single subnet\napp.set('trust proxy', 'loopback, 123.123.123.123') // specify a subnet and an address\napp.set('trust proxy', 'loopback, linklocal, uniquelocal') // specify multiple subnets as CSV\napp.set('trust proxy', ['loopback', 'linklocal', 'uniquelocal']) // specify multiple subnets as an array\n</pre></div>  <p>When specified, the IP addresses or the subnets are excluded from the address determination process, and the untrusted IP address nearest to the application server is determined as the client’s IP address. This works by checking if <code class=\"language-plaintext highlighter-rouge\">req.socket.remoteAddress</code> is trusted. If so, then each address in <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-For</code> is checked from right to left until the first non-trusted address.</p> </td> </tr> <tr> <td>Number</td> <td> <p>Use the address that is at most <code class=\"language-plaintext highlighter-rouge\">n</code> number of hops away from the Express application. <code class=\"language-plaintext highlighter-rouge\">req.socket.remoteAddress</code> is the first hop, and the rest are looked for in the <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-For</code> header from right to left. A value of <code class=\"language-plaintext highlighter-rouge\">0</code> means that the first untrusted address would be <code class=\"language-plaintext highlighter-rouge\">req.socket.remoteAddress</code>, i.e. there is no reverse proxy.</p> <div class=\"doc-box doc-warn\"> <p>When using this setting, it is important to ensure there are not multiple, different-length paths to the Express application such that the client can be less than the configured number of hops away, otherwise it may be possible for the client to provide any value.</p> </div> </td> </tr> <tr> <td>Function</td> <td> <p>Custom trust implementation.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.set('trust proxy', (ip) =&gt; {\n  if (ip === '127.0.0.1' || ip === '123.123.123.123') return true // trusted IPs\n  else return false\n})\n</pre></div>  </td> </tr> </tbody> </table> <p>Enabling <code class=\"language-plaintext highlighter-rouge\">trust proxy</code> will have the following impact:</p> <ul> <li> <p>The value of <a href=\"https://expressjs.com/en/api.html#req.hostname\">req.hostname</a> is derived from the value set in the <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-Host</code> header, which can be set by the client or by the proxy.</p> </li> <li> <p><code class=\"language-plaintext highlighter-rouge\">X-Forwarded-Proto</code> can be set by the reverse proxy to tell the app whether it is <code class=\"language-plaintext highlighter-rouge\">https</code> or <code class=\"language-plaintext highlighter-rouge\">http</code> or even an invalid name. This value is reflected by <a href=\"https://expressjs.com/en/api.html#req.protocol\">req.protocol</a>.</p> </li> <li> <p>The <a href=\"https://expressjs.com/en/api.html#req.ip\">req.ip</a> and <a href=\"https://expressjs.com/en/api.html#req.ips\">req.ips</a> values are populated based on the socket address and <code class=\"language-plaintext highlighter-rouge\">X-Forwarded-For</code> header, starting at the first untrusted address.</p> </li> </ul> <p>The <code class=\"language-plaintext highlighter-rouge\">trust proxy</code> setting is implemented using the <a href=\"https://www.npmjs.com/package/proxy-addr\">proxy-addr</a> package. For more information, see its documentation.</p>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/guide/behind-proxies.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/guide/behind-proxies.html\" class=\"_attribution-link\">https://expressjs.com/en/guide/behind-proxies.html</a>\n  </p>\n</div>\n","guide/migrating-4":"<main> <h1 id=\"moving-to-express-4\" data-level=\"9\">Moving to Express 4</h1> <h2 id=\"overview\">Overview</h2> <p>Express 4 is a breaking change from Express 3. That means an existing Express 3 app will <em>not</em> work if you update the Express version in its dependencies.</p> <p>This article covers:</p> <ul class=\"doclist\"> <li>\n<a href=\"#changes\">Changes in Express 4</a>.</li> <li>\n<a href=\"#example-migration\">An example</a> of migrating an Express 3 app to Express 4.</li> <li>\n<a href=\"#app-gen\">Upgrading to the Express 4 app generator</a>.</li> </ul> <h2 id=\"changes\">Changes in Express 4</h2> <p>There are several significant changes in Express 4:</p> <ul class=\"doclist\"> <li>\n<a href=\"#core-changes\">Changes to Express core and middleware system.</a> The dependencies on Connect and built-in middleware were removed, so you must add middleware yourself. </li> <li><a href=\"#routing\">Changes to the routing system.</a></li> <li><a href=\"#other-changes\">Various other changes.</a></li> </ul> <p>See also:</p> <ul> <li><a href=\"https://github.com/expressjs/express/wiki/New-features-in-4.x\">New features in 4.x.</a></li> <li><a href=\"https://github.com/expressjs/express/wiki/Migrating-from-3.x-to-4.x\">Migrating from 3.x to 4.x.</a></li> </ul> <h3 id=\"core-changes\"> Changes to Express core and middleware system </h3> <p>Express 4 no longer depends on Connect, and removes all built-in middleware from its core, except for the <code class=\"language-plaintext highlighter-rouge\">express.static</code> function. This means that Express is now an independent routing and middleware web framework, and Express versioning and releases are not affected by middleware updates.</p> <p>Without built-in middleware, you must explicitly add all the middleware that is required to run your app. Simply follow these steps:</p> <ol> <li>Install the module: <code class=\"language-plaintext highlighter-rouge\">npm install --save &lt;module-name&gt;</code>\n</li> <li>In your app, require the module: <code class=\"language-plaintext highlighter-rouge\">require('module-name')</code>\n</li> <li>Use the module according to its documentation: <code class=\"language-plaintext highlighter-rouge\">app.use( ... )</code>\n</li> </ol> <p>The following table lists Express 3 middleware and their counterparts in Express 4.</p> <table class=\"doctable\"> <tr>\n<th>Express 3</th>\n<th>Express 4</th>\n</tr> <tr>\n<td><code>express.bodyParser</code></td> <td>\n<a href=\"https://github.com/expressjs/body-parser\">body-parser</a> + <a href=\"https://github.com/expressjs/multer\">multer</a>\n</td>\n</tr> <tr>\n<td><code>express.compress</code></td> <td><a href=\"https://github.com/expressjs/compression\">compression</a></td>\n</tr> <tr>\n<td><code>express.cookieSession</code></td> <td><a href=\"https://github.com/expressjs/cookie-session\">cookie-session</a></td>\n</tr> <tr>\n<td><code>express.cookieParser</code></td> <td><a href=\"https://github.com/expressjs/cookie-parser\">cookie-parser</a></td>\n</tr> <tr>\n<td><code>express.logger</code></td> <td><a href=\"https://github.com/expressjs/morgan\">morgan</a></td>\n</tr> <tr>\n<td><code>express.session</code></td> <td><a href=\"https://github.com/expressjs/session\">express-session</a></td>\n</tr> <tr>\n<td><code>express.favicon</code></td> <td><a href=\"https://github.com/expressjs/serve-favicon\">serve-favicon</a></td>\n</tr> <tr>\n<td><code>express.responseTime</code></td> <td><a href=\"https://github.com/expressjs/response-time\">response-time</a></td>\n</tr> <tr>\n<td><code>express.errorHandler</code></td> <td><a href=\"https://github.com/expressjs/errorhandler\">errorhandler</a></td>\n</tr> <tr>\n<td><code>express.methodOverride</code></td> <td><a href=\"https://github.com/expressjs/method-override\">method-override</a></td>\n</tr> <tr>\n<td><code>express.timeout</code></td> <td><a href=\"https://github.com/expressjs/timeout\">connect-timeout</a></td>\n</tr> <tr>\n<td><code>express.vhost</code></td> <td><a href=\"https://github.com/expressjs/vhost\">vhost</a></td>\n</tr> <tr>\n<td><code>express.csrf</code></td> <td><a href=\"https://github.com/expressjs/csurf\">csurf</a></td>\n</tr> <tr>\n<td><code>express.directory</code></td> <td><a href=\"https://github.com/expressjs/serve-index\">serve-index</a></td>\n</tr> <tr>\n<td><code>express.static</code></td> <td><a href=\"https://github.com/expressjs/serve-static\">serve-static</a></td>\n</tr> </table> <p>Here is the <a href=\"https://github.com/senchalabs/connect#middleware\">complete list</a> of Express 4 middleware.</p> <p>In most cases, you can simply replace the old version 3 middleware with its Express 4 counterpart. For details, see the module documentation in GitHub.</p> <h4 id=\"app-use\">\n<code>app.use</code> accepts parameters</h4> <p>In version 4 you can use a variable parameter to define the path where middleware functions are loaded, then read the value of the parameter from the route handler. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use('/book/:id', (req, res, next) =&gt; {\n  console.log('ID:', req.params.id)\n  next()\n})\n</pre></div> <h3 id=\"routing\"> The routing system </h3> <p>Apps now implicitly load routing middleware, so you no longer have to worry about the order in which middleware is loaded with respect to the <code class=\"language-plaintext highlighter-rouge\">router</code> middleware.</p> <p>The way you define routes is unchanged, but the routing system has two new features to help organize your routes:</p> <ul class=\"doclist\"> <li>A new method, <code class=\"language-plaintext highlighter-rouge\">app.route()</code>, to create chainable route handlers for a route path.</li> <li>A new class, <code class=\"language-plaintext highlighter-rouge\">express.Router</code>, to create modular mountable route handlers.</li> </ul> <h4 id=\"app-route\">\n<code>app.route()</code> method</h4> <p>The new <code class=\"language-plaintext highlighter-rouge\">app.route()</code> method enables you to create chainable route handlers for a route path. Because the path is specified in a single location, creating modular routes is helpful, as is reducing redundancy and typos. For more information about routes, see <a href=\"https://expressjs.com/en/index.html#router\"><code class=\"language-plaintext highlighter-rouge\">Router()</code> documentation</a>.</p> <p>Here is an example of chained route handlers that are defined by using the <code class=\"language-plaintext highlighter-rouge\">app.route()</code> function.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.route('/book')\n  .get((req, res) =&gt; {\n    res.send('Get a random book')\n  })\n  .post((req, res) =&gt; {\n    res.send('Add a book')\n  })\n  .put((req, res) =&gt; {\n    res.send('Update the book')\n  })\n</pre></div> <h4 id=\"express-router\">\n<code>express.Router</code> class</h4> <p>The other feature that helps to organize routes is a new class, <code class=\"language-plaintext highlighter-rouge\">express.Router</code>, that you can use to create modular mountable route handlers. A <code class=\"language-plaintext highlighter-rouge\">Router</code> instance is a complete middleware and routing system; for this reason it is often referred to as a “mini-app”.</p> <p>The following example creates a router as a module, loads middleware in it, defines some routes, and mounts it on a path on the main app.</p> <p>For example, create a router file named <code class=\"language-plaintext highlighter-rouge\">birds.js</code> in the app directory, with the following content:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">var express = require('express')\nvar router = express.Router()\n\n// middleware specific to this router\nrouter.use((req, res, next) =&gt; {\n  console.log('Time: ', Date.now())\n  next()\n})\n// define the home page route\nrouter.get('/', (req, res) =&gt; {\n  res.send('Birds home page')\n})\n// define the about route\nrouter.get('/about', (req, res) =&gt; {\n  res.send('About birds')\n})\n\nmodule.exports = router\n</pre></div> <p>Then, load the router module in the app:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">var birds = require('./birds')\n\n// ...\n\napp.use('/birds', birds)\n</pre></div> <p>The app will now be able to handle requests to the <code class=\"language-plaintext highlighter-rouge\">/birds</code> and <code class=\"language-plaintext highlighter-rouge\">/birds/about</code> paths, and will call the <code class=\"language-plaintext highlighter-rouge\">timeLog</code> middleware that is specific to the route.</p> <h3 id=\"other-changes\"> Other changes </h3> <p>The following table lists other small but important changes in Express 4:</p> <table class=\"doctable\"> <tr> <th>Object</th> <th>Description</th> </tr> <tr> <td>Node.js</td> <td>Express 4 requires Node.js 0.10.x or later and has dropped support for Node.js 0.8.x.</td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">http.createServer()</code></p> </td> <td> <p>The <code class=\"language-plaintext highlighter-rouge\">http</code> module is no longer needed, unless you need to directly work with it (socket.io/SPDY/HTTPS). The app can be started by using the <code class=\"language-plaintext highlighter-rouge\">app.listen()</code> function.</p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">app.configure()</code></p> </td> <td> <p>The <code class=\"language-plaintext highlighter-rouge\">app.configure()</code> function has been removed. Use the <code class=\"language-plaintext highlighter-rouge\">process.env.NODE_ENV</code> or <code class=\"language-plaintext highlighter-rouge\">app.get('env')</code> function to detect the environment and configure the app accordingly.</p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">json spaces</code></p> </td> <td> <p>The <code class=\"language-plaintext highlighter-rouge\">json spaces</code> application property is disabled by default in Express 4.</p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">req.accepted()</code></p> </td> <td> <p>Use <code class=\"language-plaintext highlighter-rouge\">req.accepts()</code>, <code class=\"language-plaintext highlighter-rouge\">req.acceptsEncodings()</code>, <code class=\"language-plaintext highlighter-rouge\">req.acceptsCharsets()</code>, and <code class=\"language-plaintext highlighter-rouge\">req.acceptsLanguages()</code>.</p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">res.location()</code></p> </td> <td> <p>No longer resolves relative URLs.</p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">req.params</code></p> </td> <td> <p>Was an array; now an object.</p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">res.locals</code></p> </td> <td> <p>Was a function; now an object.</p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">res.headerSent</code></p> </td> <td> <p>Changed to <code class=\"language-plaintext highlighter-rouge\">res.headersSent</code>.</p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">app.route</code></p> </td> <td> <p>Now available as <code class=\"language-plaintext highlighter-rouge\">app.mountpath</code>.</p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">res.on('header')</code></p> </td> <td> <p>Removed.</p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">res.charset</code></p> </td> <td> <p>Removed.</p> </td> </tr> <tr> <td> <p><code class=\"language-plaintext highlighter-rouge\">res.setHeader('Set-Cookie', val)</code></p> </td> <td> <p>Functionality is now limited to setting the basic cookie value. Use <code class=\"language-plaintext highlighter-rouge\">res.cookie()</code> for added functionality.</p> </td> </tr> </table> <h2 id=\"example-migration\">Example app migration</h2> <p>Here is an example of migrating an Express 3 application to Express 4. The files of interest are <code class=\"language-plaintext highlighter-rouge\">app.js</code> and <code class=\"language-plaintext highlighter-rouge\">package.json</code>.</p> <h3> Version 3 app </h3> <h4><code>app.js</code></h4> <p>Consider an Express v.3 application with the following <code class=\"language-plaintext highlighter-rouge\">app.js</code> file:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">var express = require('express')\nvar routes = require('./routes')\nvar user = require('./routes/user')\nvar http = require('http')\nvar path = require('path')\n\nvar app = express()\n\n// all environments\napp.set('port', process.env.PORT || 3000)\napp.set('views', path.join(__dirname, 'views'))\napp.set('view engine', 'pug')\napp.use(express.favicon())\napp.use(express.logger('dev'))\napp.use(express.methodOverride())\napp.use(express.session({ secret: 'your secret here' }))\napp.use(express.bodyParser())\napp.use(app.router)\napp.use(express.static(path.join(__dirname, 'public')))\n\n// development only\nif (app.get('env') === 'development') {\n  app.use(express.errorHandler())\n}\n\napp.get('/', routes.index)\napp.get('/users', user.list)\n\nhttp.createServer(app).listen(app.get('port'), () =&gt; {\n  console.log('Express server listening on port ' + app.get('port'))\n})\n</pre></div> <h4><code>package.json</code></h4> <p>The accompanying version 3 <code class=\"language-plaintext highlighter-rouge\">package.json</code> file might look something like this:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">{\n  \"name\": \"application-name\",\n  \"version\": \"0.0.1\",\n  \"private\": true,\n  \"scripts\": {\n    \"start\": \"node app.js\"\n  },\n  \"dependencies\": {\n    \"express\": \"3.12.0\",\n    \"pug\": \"*\"\n  }\n}\n</pre></div> <h3> Process </h3> <p>Begin the migration process by installing the required middleware for the Express 4 app and updating Express and Pug to their respective latest version with the following command:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install serve-favicon morgan method-override express-session body-parser multer errorhandler express@latest pug@latest --save\n</pre></div> <p>Make the following changes to <code class=\"language-plaintext highlighter-rouge\">app.js</code>:</p> <ol> <li> <p>The built-in Express middleware functions <code class=\"language-plaintext highlighter-rouge\">express.favicon</code>, <code class=\"language-plaintext highlighter-rouge\">express.logger</code>, <code class=\"language-plaintext highlighter-rouge\">express.methodOverride</code>, <code class=\"language-plaintext highlighter-rouge\">express.session</code>, <code class=\"language-plaintext highlighter-rouge\">express.bodyParser</code> and <code class=\"language-plaintext highlighter-rouge\">express.errorHandler</code> are no longer available on the <code class=\"language-plaintext highlighter-rouge\">express</code> object. You must install their alternatives manually and load them in the app.</p> </li> <li> <p>You no longer need to load the <code class=\"language-plaintext highlighter-rouge\">app.router</code> function. It is not a valid Express 4 app object, so remove the <code class=\"language-plaintext highlighter-rouge\">app.use(app.router);</code> code.</p> </li> <li> <p>Make sure that the middleware functions are loaded in the correct order - load <code class=\"language-plaintext highlighter-rouge\">errorHandler</code> after loading the app routes.</p> </li> </ol> <h3>Version 4 app</h3> <h4><code>package.json</code></h4> <p>Running the above <code class=\"language-plaintext highlighter-rouge\">npm</code> command will update <code class=\"language-plaintext highlighter-rouge\">package.json</code> as follows:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">{\n  \"name\": \"application-name\",\n  \"version\": \"0.0.1\",\n  \"private\": true,\n  \"scripts\": {\n    \"start\": \"node app.js\"\n  },\n  \"dependencies\": {\n    \"body-parser\": \"^1.5.2\",\n    \"errorhandler\": \"^1.1.1\",\n    \"express\": \"^4.8.0\",\n    \"express-session\": \"^1.7.2\",\n    \"pug\": \"^2.0.0\",\n    \"method-override\": \"^2.1.2\",\n    \"morgan\": \"^1.2.2\",\n    \"multer\": \"^0.1.3\",\n    \"serve-favicon\": \"^2.0.1\"\n  }\n}\n</pre></div> <h4><code>app.js</code></h4> <p>Then, remove invalid code, load the required middleware, and make other changes as necessary. The <code class=\"language-plaintext highlighter-rouge\">app.js</code> file will look like this:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">var http = require('http')\nvar express = require('express')\nvar routes = require('./routes')\nvar user = require('./routes/user')\nvar path = require('path')\n\nvar favicon = require('serve-favicon')\nvar logger = require('morgan')\nvar methodOverride = require('method-override')\nvar session = require('express-session')\nvar bodyParser = require('body-parser')\nvar multer = require('multer')\nvar errorHandler = require('errorhandler')\n\nvar app = express()\n\n// all environments\napp.set('port', process.env.PORT || 3000)\napp.set('views', path.join(__dirname, 'views'))\napp.set('view engine', 'pug')\napp.use(favicon(path.join(__dirname, '/public/favicon.ico')))\napp.use(logger('dev'))\napp.use(methodOverride())\napp.use(session({\n  resave: true,\n  saveUninitialized: true,\n  secret: 'uwotm8'\n}))\napp.use(bodyParser.json())\napp.use(bodyParser.urlencoded({ extended: true }))\napp.use(multer())\napp.use(express.static(path.join(__dirname, 'public')))\n\napp.get('/', routes.index)\napp.get('/users', user.list)\n\n// error handling middleware should be loaded after the loading the routes\nif (app.get('env') === 'development') {\n  app.use(errorHandler())\n}\n\nvar server = http.createServer(app)\nserver.listen(app.get('port'), () =&gt; {\n  console.log('Express server listening on port ' + app.get('port'))\n})\n</pre></div> <div class=\"doc-box doc-info\"> <p>Unless you need to work directly with the <code class=\"language-plaintext highlighter-rouge\">http</code> module (socket.io/SPDY/HTTPS), loading it is not required, and the app can be simply started this way:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.listen(app.get('port'), () =&gt; {\n  console.log('Express server listening on port ' + app.get('port'))\n})\n</pre></div>  </div> <h3>Run the app</h3> <p>The migration process is complete, and the app is now an Express 4 app. To confirm, start the app by using the following command:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ node .\n</pre></div> <p>Load <a href=\"http://localhost:3000\">http://localhost:3000</a> and see the home page being rendered by Express 4.</p> <h2 id=\"app-gen\">Upgrading to the Express 4 app generator</h2> <p>The command-line tool to generate an Express app is still <code class=\"language-plaintext highlighter-rouge\">express</code>, but to upgrade to the new version, you must uninstall the Express 3 app generator and then install the new <code class=\"language-plaintext highlighter-rouge\">express-generator</code>.</p> <h3>Installing </h3> <p>If you already have the Express 3 app generator installed on your system, you must uninstall it:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm uninstall -g express\n</pre></div> <p>Depending on how your file and directory privileges are configured, you might need to run this command with <code class=\"language-plaintext highlighter-rouge\">sudo</code>.</p> <p>Now install the new generator:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install -g express-generator\n</pre></div> <p>Depending on how your file and directory privileges are configured, you might need to run this command with <code class=\"language-plaintext highlighter-rouge\">sudo</code>.</p> <p>Now the <code class=\"language-plaintext highlighter-rouge\">express</code> command on your system is updated to the Express 4 generator.</p> <h3>Changes to the app generator </h3> <p>Command options and use largely remain the same, with the following exceptions:</p> <ul class=\"doclist\"> <li>Removed the <code class=\"language-plaintext highlighter-rouge\">--sessions</code> option.</li> <li>Removed the <code class=\"language-plaintext highlighter-rouge\">--jshtml</code> option.</li> <li>Added the <code class=\"language-plaintext highlighter-rouge\">--hogan</code> option to support <a href=\"http://twitter.github.io/hogan.js/\">Hogan.js</a>.</li> </ul> <h3>Example</h3> <p>Execute the following command to create an Express 4 app:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ express app4\n</pre></div> <p>If you look at the contents of the <code class=\"language-plaintext highlighter-rouge\">app4/app.js</code> file, you will notice that all the middleware functions (except <code class=\"language-plaintext highlighter-rouge\">express.static</code>) that are required for the app are loaded as independent modules, and the <code class=\"language-plaintext highlighter-rouge\">router</code> middleware is no longer explicitly loaded in the app.</p> <p>You will also notice that the <code class=\"language-plaintext highlighter-rouge\">app.js</code> file is now a Node.js module, in contrast to the standalone app that was generated by the old generator.</p> <p>After installing the dependencies, start the app by using the following command:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm start\n</pre></div> <p>If you look at the <code class=\"language-plaintext highlighter-rouge\">npm start</code> script in the <code class=\"language-plaintext highlighter-rouge\">package.json</code> file, you will notice that the actual command that starts the app is <code class=\"language-plaintext highlighter-rouge\">node ./bin/www</code>, which used to be <code class=\"language-plaintext highlighter-rouge\">node app.js</code> in Express 3.</p> <p>Because the <code class=\"language-plaintext highlighter-rouge\">app.js</code> file that was generated by the Express 4 generator is now a Node.js module, it can no longer be started independently as an app (unless you modify the code). The module must be loaded in a Node.js file and started via the Node.js file. The Node.js file is <code class=\"language-plaintext highlighter-rouge\">./bin/www</code> in this case.</p> <p>Neither the <code class=\"language-plaintext highlighter-rouge\">bin</code> directory nor the extensionless <code class=\"language-plaintext highlighter-rouge\">www</code> file is mandatory for creating an Express app or starting the app. They are just suggestions made by the generator, so feel free to modify them to suit your needs.</p> <p>To get rid of the <code class=\"language-plaintext highlighter-rouge\">www</code> directory and keep things the “Express 3 way”, delete the line that says <code class=\"language-plaintext highlighter-rouge\">module.exports = app;</code> at the end of the <code class=\"language-plaintext highlighter-rouge\">app.js</code> file, then paste the following code in its place:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.set('port', process.env.PORT || 3000)\n\nvar server = app.listen(app.get('port'), () =&gt; {\n  debug('Express server listening on port ' + server.address().port)\n})\n</pre></div> <p>Ensure that you load the <code class=\"language-plaintext highlighter-rouge\">debug</code> module at the top of the <code class=\"language-plaintext highlighter-rouge\">app.js</code> file by using the following code:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">var debug = require('debug')('app4')\n</pre></div> <p>Next, change <code class=\"language-plaintext highlighter-rouge\">\"start\": \"node ./bin/www\"</code> in the <code class=\"language-plaintext highlighter-rouge\">package.json</code> file to <code class=\"language-plaintext highlighter-rouge\">\"start\": \"node app.js\"</code>.</p> <p>You have now moved the functionality of <code class=\"language-plaintext highlighter-rouge\">./bin/www</code> back to <code class=\"language-plaintext highlighter-rouge\">app.js</code>. This change is not recommended, but the exercise helps you to understand how the <code class=\"language-plaintext highlighter-rouge\">./bin/www</code> file works, and why the <code class=\"language-plaintext highlighter-rouge\">app.js</code> file no longer starts on its own.</p>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/guide/migrating-4.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/guide/migrating-4.html\" class=\"_attribution-link\">https://expressjs.com/en/guide/migrating-4.html</a>\n  </p>\n</div>\n","advanced/security-updates":"<main> <h1 id=\"security-updates\" data-level=\"2\">Security updates</h1> <div class=\"doc-box doc-notice\"> <p>Node.js vulnerabilities directly affect Express. Therefore, <a href=\"https://nodejs.org/en/blog/vulnerability/\">keep a watch on Node.js vulnerabilities</a> and make sure you are using the latest stable version of Node.js.</p> </div> <p>The list below enumerates the Express vulnerabilities that were fixed in the specified version update.</p> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>If you believe you have discovered a security vulnerability in Express, please see <a href=\"https://expressjs.com/en/resources/contributing.html#security-policies-and-procedures\">Security Policies and Procedures</a>.</p> </div> <h2 id=\"4x\">4.x</h2> <ul> <li>4.21.2 <ul> <li>The dependency <code class=\"language-plaintext highlighter-rouge\">path-to-regexp</code> has been updated to address a <a href=\"https://github.com/pillarjs/path-to-regexp/security/advisories/GHSA-rhx6-c78j-4q9w\">vulnerability</a>.</li> </ul> </li> <li>4.21.1 <ul> <li>The dependency <code class=\"language-plaintext highlighter-rouge\">cookie</code> has been updated to address a <a href=\"https://github.com/jshttp/cookie/security/advisories/GHSA-pxg6-pf52-xh8x\">vulnerability</a>, This may affect your application if you use <code class=\"language-plaintext highlighter-rouge\">res.cookie</code>.</li> </ul> </li> <li>4.20.0 <ul> <li>Fixed XSS vulnerability in <code class=\"language-plaintext highlighter-rouge\">res.redirect</code> (<a href=\"https://github.com/expressjs/express/security/advisories/GHSA-qw6h-vgh9-j6wx\">advisory</a>, <a href=\"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-43796\">CVE-2024-43796</a>).</li> <li>The dependency <code class=\"language-plaintext highlighter-rouge\">serve-static</code> has been updated to address a <a href=\"https://github.com/advisories/GHSA-cm22-4g7w-348p\">vulnerability</a>.</li> <li>The dependency <code class=\"language-plaintext highlighter-rouge\">send</code> has been updated to address a <a href=\"https://github.com/advisories/GHSA-m6fv-jmcg-4jfg\">vulnerability</a>.</li> <li>The dependency <code class=\"language-plaintext highlighter-rouge\">path-to-regexp</code> has been updated to address a <a href=\"https://github.com/pillarjs/path-to-regexp/security/advisories/GHSA-9wv6-86v2-598j\">vulnerability</a>.</li> <li>The dependency <code class=\"language-plaintext highlighter-rouge\">body-parser</code> has been updated to addres a <a href=\"https://github.com/advisories/GHSA-qwcr-r2fm-qrc7\">vulnerability</a>, This may affect your application if you had url enconding activated.</li> </ul> </li> <li>4.19.0, 4.19.1 <ul> <li>Fixed open redirect vulnerability in <code class=\"language-plaintext highlighter-rouge\">res.location</code> and <code class=\"language-plaintext highlighter-rouge\">res.redirect</code> (<a href=\"https://github.com/expressjs/express/security/advisories/GHSA-rv95-896h-c2vc\">advisory</a>, <a href=\"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-29041\">CVE-2024-29041</a>).</li> </ul> </li> <li>4.17.3 <ul> <li>The dependency <code class=\"language-plaintext highlighter-rouge\">qs</code> has been updated to address a <a href=\"https://github.com/advisories/GHSA-hrpp-h998-j3pp\">vulnerability</a>. This may affect your application if the following APIs are used: <code class=\"language-plaintext highlighter-rouge\">req.query</code>, <code class=\"language-plaintext highlighter-rouge\">req.body</code>, <code class=\"language-plaintext highlighter-rouge\">req.param</code>.</li> </ul> </li> <li>4.16.0 <ul> <li>The dependency <code class=\"language-plaintext highlighter-rouge\">forwarded</code> has been updated to address a <a href=\"https://npmjs.com/advisories/527\">vulnerability</a>. This may affect your application if the following APIs are used: <code class=\"language-plaintext highlighter-rouge\">req.host</code>, <code class=\"language-plaintext highlighter-rouge\">req.hostname</code>, <code class=\"language-plaintext highlighter-rouge\">req.ip</code>, <code class=\"language-plaintext highlighter-rouge\">req.ips</code>, <code class=\"language-plaintext highlighter-rouge\">req.protocol</code>.</li> <li>The dependency <code class=\"language-plaintext highlighter-rouge\">mime</code> has been updated to address a <a href=\"https://npmjs.com/advisories/535\">vulnerability</a>, but this issue does not impact Express.</li> <li>The dependency <code class=\"language-plaintext highlighter-rouge\">send</code> has been updated to provide a protection against a <a href=\"https://nodejs.org/en/blog/vulnerability/september-2017-path-validation/\">Node.js 8.5.0 vulnerability</a>. This only impacts running Express on the specific Node.js version 8.5.0.</li> </ul> </li> <li>4.15.5 <ul> <li>The dependency <code class=\"language-plaintext highlighter-rouge\">debug</code> has been updated to address a <a href=\"https://snyk.io/vuln/npm:debug:20170905\">vulnerability</a>, but this issue does not impact Express.</li> <li>The dependency <code class=\"language-plaintext highlighter-rouge\">fresh</code> has been updated to address a <a href=\"https://npmjs.com/advisories/526\">vulnerability</a>. This will affect your application if the following APIs are used: <code class=\"language-plaintext highlighter-rouge\">express.static</code>, <code class=\"language-plaintext highlighter-rouge\">req.fresh</code>, <code class=\"language-plaintext highlighter-rouge\">res.json</code>, <code class=\"language-plaintext highlighter-rouge\">res.jsonp</code>, <code class=\"language-plaintext highlighter-rouge\">res.send</code>, <code class=\"language-plaintext highlighter-rouge\">res.sendfile</code> <code class=\"language-plaintext highlighter-rouge\">res.sendFile</code>, <code class=\"language-plaintext highlighter-rouge\">res.sendStatus</code>.</li> </ul> </li> <li>4.15.3 <ul> <li>The dependency <code class=\"language-plaintext highlighter-rouge\">ms</code> has been updated to address a <a href=\"https://snyk.io/vuln/npm:ms:20170412\">vulnerability</a>. This may affect your application if untrusted string input is passed to the <code class=\"language-plaintext highlighter-rouge\">maxAge</code> option in the following APIs: <code class=\"language-plaintext highlighter-rouge\">express.static</code>, <code class=\"language-plaintext highlighter-rouge\">res.sendfile</code>, and <code class=\"language-plaintext highlighter-rouge\">res.sendFile</code>.</li> </ul> </li> <li>4.15.2 <ul> <li>The dependency <code class=\"language-plaintext highlighter-rouge\">qs</code> has been updated to address a <a href=\"https://snyk.io/vuln/npm:qs:20170213\">vulnerability</a>, but this issue does not impact Express. Updating to 4.15.2 is a good practice, but not required to address the vulnerability.</li> </ul> </li> <li>4.11.1 <ul> <li>Fixed root path disclosure vulnerability in <code class=\"language-plaintext highlighter-rouge\">express.static</code>, <code class=\"language-plaintext highlighter-rouge\">res.sendfile</code>, and <code class=\"language-plaintext highlighter-rouge\">res.sendFile</code>\n</li> </ul> </li> <li>4.10.7 <ul> <li>Fixed open redirect vulnerability in <code class=\"language-plaintext highlighter-rouge\">express.static</code> (<a href=\"https://npmjs.com/advisories/35\">advisory</a>, <a href=\"http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1164\">CVE-2015-1164</a>).</li> </ul> </li> <li>4.8.8 <ul> <li>Fixed directory traversal vulnerabilities in <code class=\"language-plaintext highlighter-rouge\">express.static</code> (<a href=\"http://npmjs.com/advisories/32\">advisory</a> , <a href=\"http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6394\">CVE-2014-6394</a>).</li> </ul> </li> <li>4.8.4 <ul> <li>Node.js 0.10 can leak <code class=\"language-plaintext highlighter-rouge\">fd</code>s in certain situations that affect <code class=\"language-plaintext highlighter-rouge\">express.static</code> and <code class=\"language-plaintext highlighter-rouge\">res.sendfile</code>. Malicious requests could cause <code class=\"language-plaintext highlighter-rouge\">fd</code>s to leak and eventually lead to <code class=\"language-plaintext highlighter-rouge\">EMFILE</code> errors and server unresponsiveness.</li> </ul> </li> <li>4.8.0 <ul> <li>Sparse arrays that have extremely high indexes in the query string could cause the process to run out of memory and crash the server.</li> <li>Extremely nested query string objects could cause the process to block and make the server unresponsive temporarily.</li> </ul> </li> </ul> <h2 id=\"3x\">3.x</h2> <div class=\"doc-box doc-warn\"> <p><strong>Express 3.x IS END-OF-LIFE AND NO LONGER MAINTAINED</strong></p> <p>Known and unknown security and performance issues in 3.x have not been addressed since the last update (1 August, 2015). It is highly recommended to use the latest version of Express.</p> <p>If you are unable to upgrade past 3.x, please consider <a href=\"https://expressjs.com/en/support#commercial-support-options\">Commercial Support Options</a>.</p> </div> <ul> <li>3.19.1 <ul> <li>Fixed root path disclosure vulnerability in <code class=\"language-plaintext highlighter-rouge\">express.static</code>, <code class=\"language-plaintext highlighter-rouge\">res.sendfile</code>, and <code class=\"language-plaintext highlighter-rouge\">res.sendFile</code>\n</li> </ul> </li> <li>3.19.0 <ul> <li>Fixed open redirect vulnerability in <code class=\"language-plaintext highlighter-rouge\">express.static</code> (<a href=\"https://npmjs.com/advisories/35\">advisory</a>, <a href=\"http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1164\">CVE-2015-1164</a>).</li> </ul> </li> <li>3.16.10 <ul> <li>Fixed directory traversal vulnerabilities in <code class=\"language-plaintext highlighter-rouge\">express.static</code>.</li> </ul> </li> <li>3.16.6 <ul> <li>Node.js 0.10 can leak <code class=\"language-plaintext highlighter-rouge\">fd</code>s in certain situations that affect <code class=\"language-plaintext highlighter-rouge\">express.static</code> and <code class=\"language-plaintext highlighter-rouge\">res.sendfile</code>. Malicious requests could cause <code class=\"language-plaintext highlighter-rouge\">fd</code>s to leak and eventually lead to <code class=\"language-plaintext highlighter-rouge\">EMFILE</code> errors and server unresponsiveness.</li> </ul> </li> <li>3.16.0 <ul> <li>Sparse arrays that have extremely high indexes in query string could cause the process to run out of memory and crash the server.</li> <li>Extremely nested query string objects could cause the process to block and make the server unresponsive temporarily.</li> </ul> </li> <li>3.3.0 <ul> <li>The 404 response of an unsupported method override attempt was susceptible to cross-site scripting attacks.</li> </ul> </li> </ul>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/advanced/security-updates.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/advanced/security-updates.html\" class=\"_attribution-link\">https://expressjs.com/en/advanced/security-updates.html</a>\n  </p>\n</div>\n","starter/examples":"<main> <h1 id=\"express-examples\" data-level=\"6\">Express examples</h1> <p>This page contains list of examples using Express.</p> <ul> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/auth\">auth</a> - Authentication with login and password</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/content-negotiation\">content-negotiation</a> - HTTP content negotiation</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/cookie-sessions\">cookie-sessions</a> - Working with cookie-based sessions</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/cookies\">cookies</a> - Working with cookies</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/downloads\">downloads</a> - Transferring files to client</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/ejs\">ejs</a> - Working with Embedded JavaScript templating (ejs)</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/error-pages\">error-pages</a> - Creating error pages</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/error\">error</a> - Working with error middleware</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/hello-world\">hello-world</a> - Simple request handler</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/markdown\">markdown</a> - Markdown as template engine</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/multi-router\">multi-router</a> - Working with multiple Express routers</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/mvc\">mvc</a> - MVC-style controllers</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/online\">online</a> - Tracking online user activity with <code class=\"language-plaintext highlighter-rouge\">online</code> and <code class=\"language-plaintext highlighter-rouge\">redis</code> packages</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/params\">params</a> - Working with route parameters</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/resource\">resource</a> - Multiple HTTP operations on the same resource</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/route-map\">route-map</a> - Organizing routes using a map</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/route-middleware\">route-middleware</a> - Working with route middleware</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/route-separation\">route-separation</a> - Organizing routes per each resource</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/search\">search</a> - Search API</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/session\">session</a> - User sessions</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/static-files\">static-files</a> - Serving static files</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/vhost\">vhost</a> - Working with virtual hosts</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/view-constructor\">view-constructor</a> - Rendering views dynamically</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/view-locals\">view-locals</a> - Saving data in request object between middleware calls</li> <li>\n<a href=\"https://github.com/expressjs/express/tree/master/examples/web-service\">web-service</a> - Simple API service</li> </ul> <h2 id=\"additional-examples\">Additional examples</h2> <p>These are some additional examples with more extensive integrations.</p> <div class=\"doc-box doc-warn\"> <p class=\"doc-title\"><svg viewbox=\"0 0 24 24\" width=\"24\" height=\"24\" fill=\"currentColor\"><path d=\"M12 7C11.7348 7 11.4804 7.10536 11.2929 7.29289C11.1054 7.48043 11 7.73478 11 8V12C11 12.2652 11.1054 12.5196 11.2929 12.7071C11.4804 12.8946 11.7348 13 12 13C12.2652 13 12.5196 12.8946 12.7071 12.7071C12.8946 12.5196 13 12.2652 13 12V8C13 7.73478 12.8946 7.48043 12.7071 7.29289C12.5196 7.10536 12.2652 7 12 7ZM12 15C11.8022 15 11.6089 15.0586 11.4444 15.1685C11.28 15.2784 11.1518 15.4346 11.0761 15.6173C11.0004 15.8 10.9806 16.0011 11.0192 16.1951C11.0578 16.3891 11.153 16.5673 11.2929 16.7071C11.4327 16.847 11.6109 16.9422 11.8049 16.9808C11.9989 17.0194 12.2 16.9996 12.3827 16.9239C12.5654 16.8482 12.7216 16.72 12.8315 16.5556C12.9414 16.3911 13 16.1978 13 16C13 15.7348 12.8946 15.4804 12.7071 15.2929C12.5196 15.1054 12.2652 15 12 15ZM21.71 7.56L16.44 2.29C16.2484 2.10727 15.9948 2.00368 15.73 2H8.27C8.00523 2.00368 7.75163 2.10727 7.56 2.29L2.29 7.56C2.10727 7.75163 2.00368 8.00523 2 8.27V15.73C2.00368 15.9948 2.10727 16.2484 2.29 16.44L7.56 21.71C7.75163 21.8927 8.00523 21.9963 8.27 22H15.73C15.9948 21.9963 16.2484 21.8927 16.44 21.71L21.71 16.44C21.8927 16.2484 21.9963 15.9948 22 15.73V8.27C21.9963 8.00523 21.8927 7.75163 21.71 7.56ZM20 15.31L15.31 20H8.69L4 15.31V8.69L8.69 4H15.31L20 8.69V15.31Z\"></path></svg> Warning</p> <p>This information refers to third-party sites, products, or modules that are not maintained by the Expressjs team. Listing here does not constitute an endorsement or recommendation from the Expressjs project team.</p> </div> <ul> <li>\n<a href=\"https://github.com/prisma/prisma-examples/tree/latest/pulse/fullstack-simple-chat\">prisma-fullstack</a> - Fullstack app with Express and Next.js using <a href=\"https://www.npmjs.com/package/prisma\">Prisma</a> as an ORM</li> <li>\n<a href=\"https://github.com/prisma/prisma-examples/tree/latest/orm/express\">prisma-rest-api-ts</a> - REST API with Express in TypeScript using <a href=\"https://www.npmjs.com/package/prisma\">Prisma</a> as an ORM</li> </ul>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/starter/examples.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/starter/examples.html\" class=\"_attribution-link\">https://expressjs.com/en/starter/examples.html</a>\n  </p>\n</div>\n","starter/faq":"<main> <h1 id=\"faq\" data-level=\"7\">FAQ</h1> <h2 id=\"how-should-i-structure-my-application\">How should I structure my application?</h2> <p>There is no definitive answer to this question. The answer depends on the scale of your application and the team that is involved. To be as flexible as possible, Express makes no assumptions in terms of structure.</p> <p>Routes and other application-specific logic can live in as many files as you wish, in any directory structure you prefer. View the following examples for inspiration:</p> <ul> <li><a href=\"https://github.com/expressjs/express/blob/4.13.1/examples/route-separation/index.js#L32-L47\">Route listings</a></li> <li><a href=\"https://github.com/expressjs/express/blob/4.13.1/examples/route-map/index.js#L52-L66\">Route map</a></li> <li><a href=\"https://github.com/expressjs/express/tree/master/examples/mvc\">MVC style controllers</a></li> </ul> <p>Also, there are third-party extensions for Express, which simplify some of these patterns:</p> <ul> <li><a href=\"https://github.com/expressjs/express-resource\">Resourceful routing</a></li> </ul> <h2 id=\"how-do-i-define-models\">How do I define models?</h2> <p>Express has no notion of a database. This concept is left up to third-party Node modules, allowing you to interface with nearly any database.</p> <p>See <a href=\"http://loopback.io\">LoopBack</a> for an Express-based framework that is centered around models.</p> <h2 id=\"how-can-i-authenticate-users\">How can I authenticate users?</h2> <p>Authentication is another opinionated area that Express does not venture into. You may use any authentication scheme you wish. For a simple username / password scheme, see <a href=\"https://github.com/expressjs/express/tree/master/examples/auth\">this example</a>.</p> <h2 id=\"which-template-engines-does-express-support\">Which template engines does Express support?</h2> <p>Express supports any template engine that conforms with the <code class=\"language-plaintext highlighter-rouge\">(path, locals, callback)</code> signature. To normalize template engine interfaces and caching, see the <a href=\"https://github.com/visionmedia/consolidate.js\">consolidate.js</a> project for support. Unlisted template engines might still support the Express signature.</p> <p>For more information, see <a href=\"../guide/using-template-engines\">Using template engines with Express</a>.</p> <h2 id=\"how-do-i-handle-404-responses\">How do I handle 404 responses?</h2> <p>In Express, 404 responses are not the result of an error, so the error-handler middleware will not capture them. This behavior is because a 404 response simply indicates the absence of additional work to do; in other words, Express has executed all middleware functions and routes, and found that none of them responded. All you need to do is add a middleware function at the very bottom of the stack (below all other functions) to handle a 404 response:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use((req, res, next) =&gt; {\n  res.status(404).send(\"Sorry can't find that!\")\n})\n</pre></div> <p>Add routes dynamically at runtime on an instance of <code class=\"language-plaintext highlighter-rouge\">express.Router()</code> so the routes are not superseded by a middleware function.</p> <h2 id=\"how-do-i-setup-an-error-handler\">How do I setup an error handler?</h2> <p>You define error-handling middleware in the same way as other middleware, except with four arguments instead of three; specifically with the signature <code class=\"language-plaintext highlighter-rouge\">(err, req, res, next)</code>:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use((err, req, res, next) =&gt; {\n  console.error(err.stack)\n  res.status(500).send('Something broke!')\n})\n</pre></div> <p>For more information, see <a href=\"../guide/error-handling\">Error handling</a>.</p> <h2 id=\"how-do-i-render-plain-html\">How do I render plain HTML?</h2> <p>You don’t! There’s no need to “render” HTML with the <code class=\"language-plaintext highlighter-rouge\">res.render()</code> function. If you have a specific file, use the <code class=\"language-plaintext highlighter-rouge\">res.sendFile()</code> function. If you are serving many assets from a directory, use the <code class=\"language-plaintext highlighter-rouge\">express.static()</code> middleware function.</p> <h2 id=\"what-version-of-nodejs-does-express-require\">What version of Node.js does Express require?</h2> <ul> <li>\n<a href=\"https://expressjs.com/en/index.html\">Express 4.x</a> requires Node.js 0.10 or higher.</li> <li>\n<a href=\"../index\">Express 5.x</a> requires Node.js 18 or higher.</li> </ul>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/starter/faq.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/starter/faq.html\" class=\"_attribution-link\">https://expressjs.com/en/starter/faq.html</a>\n  </p>\n</div>\n","guide/writing-middleware":"<main> <h1 id=\"writing-middleware-for-use-in-express-apps\" data-level=\"2\">Writing middleware for use in Express apps</h1> <h2>Overview</h2> <p><em>Middleware</em> functions are functions that have access to the <a href=\"https://expressjs.com/en/index.html#req\">request object</a> (<code class=\"language-plaintext highlighter-rouge\">req</code>), the <a href=\"https://expressjs.com/en/index.html#res\">response object</a> (<code class=\"language-plaintext highlighter-rouge\">res</code>), and the <code class=\"language-plaintext highlighter-rouge\">next</code> function in the application’s request-response cycle. The <code class=\"language-plaintext highlighter-rouge\">next</code> function is a function in the Express router which, when invoked, executes the middleware succeeding the current middleware.</p> <p>Middleware functions can perform the following tasks:</p> <ul> <li>Execute any code.</li> <li>Make changes to the request and the response objects.</li> <li>End the request-response cycle.</li> <li>Call the next middleware in the stack.</li> </ul> <p>If the current middleware function does not end the request-response cycle, it must call <code class=\"language-plaintext highlighter-rouge\">next()</code> to pass control to the next middleware function. Otherwise, the request will be left hanging.</p> <p>The following figure shows the elements of a middleware function call:</p> <div class=\"table-scroller\"> <table id=\"mw-fig\"> <tr>\n<td id=\"mw-fig-imgcell\"> <img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZoAAAE0CAMAAAAizgXPAAADAFBMVEX///8ABk8vN6AriOj0//+aNYolhOgcf+cAAACMNpn7//////xoqu/t9P2WxPSkzPX/9s2s0PZSAAL///LK4foggedTnuz///fy9/7n8fz8/f6dyPX/9uBNm+w8kerc8//Q5Pre7PxGl+uPwPNClOoxi+ni7vtYoe1zsPCaNpmeEgZepO7F8//G3vnB3Phure+x0/fY6fv2+f7+/v42jurh+v/T5/vJ8v+11vfW+P/5+/6EuvLal1F4s/D10Zj/8c2gTgPs/f/59/iAuPDHc5qLvvL3+//mnp+MN6V9tfGqNYr///RgAQKIvPJjp+7n///A2vmYmN71zJUAAi6Jzu7/6NW72Pfywbik3vgAC2erh7vo5eXA7/8ABUGkNpkAM4z/8uFDAAHv6fItk8z/+/FdOqCgk9AAMGSWR6Krve3Thp3DWI+qtOWSg80ARpjMzMv//+3Uk6nl6vD937EuOKjl2eb07+y44fjLo78wAAH23cL46OSdhmzotLbU8P/svYTw8fby39rt9/7FZJi6z/L31smGwuXVikz4zr/71L3/9/ARfrqTVbq3k73Qssfnz9OJasvAx+iYU6Cmvct9TjeWYKaMc8vYn1ssTLfGeTRLLQDWq4NBk83pwMTmrXGseq+hcK3//uAAQmH10aDFqIzjpq+LorOJzvJIep2MZMH+7tqykG6vWZZnbGVpm8P/6r7Z4vVpipOFXUGfFUSNSb6gpeK4v+q7hWOMOKxJQ0H/+t8TYY6objTDirCLObOaN6Guq6sxisePLQNkkL+ntLuPYV3/+/gcZrLavqGR0/J7AQIrOru5RZRnrtwpRmj92aFpbpWlXQS2ptKymtBDd8JrUGqqEgb//uhCY4hAmtHL0uiyZZnOyL0AUH3oxaLOZSO1zc0ALjnFwMfEttt9sden0+rCRREAk80mUYKIAQTNlGCbRpOR0PVcW1GKkZKMi9v+9tOS1PdfLQJeQAEAE4mR0PeAye7X38KXq5iHWy6PQAMARZ+cNIAfdNL70ZgAN+gif9CZAAAfKElEQVR42uyde1BU1x3HD1cWzu7KQ94gKiIvR0RgBQE1+AZFFFEURRSsq0QloqW+8iImUYJRoxHFNNZqoqmJRs20MZqYjO8kpolp6Gi1zbRTO21S207aZtq005n+zn3u3d3LhQX3gb/PH+6Be+7d5fe79/x++/uecyQEQRAEQRAEQRAEQRAEQRAEQRAEQRAEQRAEQRAEQRAEQZBewQ+Pjtc+uG7HF3DUtHPXbVMPvJV4nfANv49Fu+vT8BVdqHWsZI3RWDwIXuu46+N74L3E68QPNRqX+aPpdflQ86mJnmR8/hTfWsMl9ch7Sdd56rjxBfRNN3jcuFe03+Nc3565onQd8PoqT/5p0SsOshsyfMUCf1Jz/vjuHx/cTCrunJr3iaEux6bbprfo7Df9SflfLplI9JlbC+OvbNm0h/7pCUK+/8v1H/6dLs+X+5DoV1+i9NP1No0OcDyd1Lxx9uyJG/nxV+6yKHMr/9yVEycu+TvvXDP0nXzxSs9y3wp3eyvXCIeab8wyEfP29oUtrcHwq2vwUZ86tv6AlWvLl/sQ8wYrx7Wtt2ko14FBbVExnEXMa4wPe8Q3RYa32ecxzCIV0wytBw1DB5Fmw58Nu49DQzHgRnp6D/0eOXeR/pz8iG4zFYZROvslungmKae/o4f/4Zcu94Hjy//6WO0cm0YHOJ5eOJ0ePlHrl14YBj+QMdXp5/acpY+Md955nnJjtyzjP3AFx11q5RLJ0jpuLDwBF0w1YPRG8MhM0sy1cW3WxnS5DxxvW1ZvvWfTkK/DmMf7pGSl8QWTJ1zz+rTn/Yl50tAnwlcaVhFzEXjkOYPhC1Jk45rwcdWV8M/8fHKytvrfteCQ0On03ZyGz2kleYjSS8yASp8xs4WYbZIaMo/+QGCt8iuH06Pfo2+ayD6/UaGCa/xGweM37hF/p51JkTFCupJZGAWON1aS6Nbr+aTC2njZCg6Jt3L/yym5w1XC88BFkaLGdKXPmsaFwnlyQ7oOw1JhnAUvcUfqdnlmSFthKAP/1JsqDHvh3hBcA61mGNkkCsP8frt69Xtwu5InKfWD5z50OtiFbKVzwFzX/MmXN/KVPmNo9dEUdprckN/KKPA3W9fYnR4axtwwRuWacNk1dp3Nk4rz1X9NjbXxmV23D8KjQQ7A0wIfNd4KPoDgfg9c0+5Pdu7NV/oUcY13+U8oN1TEL2ImIRYPBRvzJkM9jGplMIyxe0NwzVz1x4FnhMFcEz6OLgYzCXbbSl8Dc31k16fhDXi9BaO03JDHnCUCQbausTv9MzZOKU/NPrVr7DqDawbZWROGL4C5JrqVa/Nnv0nk865vwTXfwN9rsulTsh1e21nqLTXsXOPZHC185QdVbFB7jrkmfCXvmmfUXQrDtvlPAAiLHxTCDbjmZfhhf3U6mGuOfR9SA/GfN6bcEDiwQOBtW9fYnV5OtzFfMNfAW9wcp3aN/XsVGXPtn5oL7FA2n2pxXBpzzQD44Tw44lnunn0f0rLDyjtQadhQMXSWR9NP8zyDgaUCzYZlkK8ZnLnm0Md+LGq0mCD+Lv7XdIgwoWG/IuQVlgZI5pL7mJfAy82v4JaWGvJ1jtTtZtT9zNE18umf0XZCvqZ+owrDLhDzGSq45r/+TjuLgdr222lxIzs0wQSxvq3KChEm3hrF0i6IOpJr5D78JwwvbkyXG+qLiVffuf2Uh3xzc5rhA0iUa6YZtt8xsKaDayDCLH/x14/NXnjoIrilnM7PDw37zWUYrioVc8l9Gi6+e3n1q7X/nCk3Onpzh9MPfUxPv0Xp/FHnplcf/U4aRecfPZrjpDPc1+/nqC94gGt7ePWCxvSGOnBLM3c9P9567UUYriqJ7Bq5T0ld+6rbO6zXZ8oNtWEWFbNnsuQT4089Na4VGfjbmH965hmG87HGvojFxvaf5Ixhg5nla7qNH+0P/4GwR+cjdZ/oM+x1eR6RGx3hcDp5ZSOld1mIgYyDbtnH0o3ozymFsdNJZ3LEWK9ObM07WBxpzznCBjPTGi6Zjyxtmfw3lm/Ufczn2WtbHpEbqiutMPJ2iX7aaB/R3E7Lkimax5ZWrbU9GBp2IbpJq8/VdVVrTapGp5BOb6mKERIz1tDKj6TOJU8bj2WpLXp1ieqjxluTzE02KbGqz9WmteJHlRpKpj/JeMxfLAu8P9N36iNCGnD/4F3TGSxLISN/p6ObWkgDNM+32Dek5MxorBcKd+YDxlm+4xlSWPvH+3r9rbPTO9nTYnp0w4KOSs41VlfKnkvP/0KK/fHGel8qc5rXxdzfsbWpx0oj5qbuftQJWEVGEKQHYOKyrhZsscQVFBRMyc6OATYHMWKBFGAwkMXIzc1NYEQwhgMZGWXAXCAPyAT68YQI9BcI5hnCmDx5cmnpaGAiMBUYC6QBIxh9GTMYwxipQBRjgEAikMQYyBjJSE5O9mHHCOKynhY8NtBX8V3PyOJyh1pwv0h0jdtRxGVtLbjAd58ZPdd0UoB+/TFRFBZ1Z0WA7ojuydY24rKmFpySGNhrXdM5AfpkLf30xEYmCou6syJAd0A3ZWsbcZlYnGvBeX3EPzIyMjKApw8jmcHHWj7qsvDL4nCiGJNZeGZxOpWP2Hzs5qM4C+csrqexAM8CPcR7FvdLS0shB+BzASEtEHMEMWPgsweWR2SyhIIlFpBfZGRksGSDzzpY+gFpSC5LR1hewvITlqcE6bhGLUATpwJ0wzh6V1AeJd1ZEaDlkpODuOyabK00bMRlQgQt2KzSguNGi44Zkd0r01NzJwTokxuvmUTXiLqzIkBLOIrL3ZSt1eKyoAWrCl2xUeITE9Jbvzo4F6BVBd9yuoXYiMJb6WuKAK2Ure3F5W7K1mpx2VELzhAHs4EJvfZbXScE6IeYa27+RxSFLfur0+WGkk45iMsasrWls7K1Sly214ItQ8TBbEYM6b3oC9Dl9AKJ3k+Za0TdWRGgJRzF5e7K1ipx2U4LDkoVB7PgXl0M0RegIbM6/R2l89Nl3VkRoDugm7K1rbhspwVHjBQ8kxzRywtV+gL0l5D0bnmST8wE3VkRoDvCVrYmXZetFXHZTgvuLxYAUoPIA4K2AG1uqeIPybqzUwHake7J1rK4rNaCY2aIYWayhSCKbV+2a7h2eicRxGU7LTh3oOCYPmXoD9ugI+nOrgnQXT3LZGHisloLDgkQPDMAF42pBzZJd3ZNgHbpLNWo1TRCHMwmFqA3vIrBSeJgloe28C4yxcEscTDawqsomCoOZmlT0BheRcoAwTEB/dAW3sVcqZqZhbbwKuJKxcGsbwwaw6uQpZn+aAvvYniy4JmRCWgLr8ISLA5mwzajMbyKoGGiZ4KxmuldJEjSzHC0hXchSTNRQWgLryKmrziYlcahMbyKLEmamYu28C76SdJMCtrCq8hOEwezqVrSTFaQxRIXx6+ssVta47C2RndxjXp1jfPlNRrrazQX2KiW2CQ6LrHx1fU1g8WJ5gGZWj0yA0YG+ja+6Zk8cTBL0pJmCiYG+jy+6BjZ7mlaE81jBwSiazyAZPcAzYnmZX0C0TUeQLL7wFy9qprDyhpnS2sc1tZoLq5RVtd0uLzG2foaZYGN1gqbBHGFDb/ERlhj43PVzMl6E82lqlovn/DsfdXMVD1pRqqqjYxAa7mTiGQ9u4c8cBOevWMwCxbtPkzL7tnSHMFSlAjcWs2UJpoP0bK7PEewDK3lTmRpJkO7AIBVNU8gBZGoWN0vojjh2a3VTCmIjI7T+yKKcwTdSlaSnjQjTavBOYLuRZJmElP0CgA4R9CtyHsAjdUKIpuxAOARpD2AtINIwoOy4tnLkPYASsrCAoBXob8HkH7uhtwP9PcAGpyE02o8gf4eQHl6uRtyP9DfA0ge7rAA4Fb09wCShjssALgX/T2AsADgGXT3AJILADOwAOBO9PcAisECgEfQ3wNI6oEFAPeivweQ1APX1biVbN09gOSp6FgAcCv6ewBJU9GxAOBe9PcAkuqdWABwK/p7ACkFANwlyJ3o7wEkFwBC0FruRH8PILkAkIvWciOd2AMICwAeQX8PIKlE0PUCQEqBD67qHOgtntHfA0guAHR5Y42ISFz65DLKHkCaX++lCU9RXV4SlBmJq9JcRn8PoCmuFwCCccGg6+jvASRNeOr6NsFxabiW03X66000l7Pqrm8THJPqs6s6Pb8lsv4eQHJW3fX/9CxWLMj1xdJB19HfAyjI9QJArpj2jcY1al1Hfw+gCNcLAHPFi2NRp+tM0d0DiEjLN10oAISIT1vZ/9k7sugoquxL6EpXdSdgyL5DFkJOCFmaJRt7QiAQiIEQSEAIgxCJCAHFBIiyCMYAwYDIwRFBkFEQZDkKCiKICo644nhQGD3jMmdmdBxn387xnHnvVdWr6qrqrqWTrnZO3Z+8VN+qd+ved++77973blmM1g3qNYDIHgH9lTVdXIg6wwq36QfVGkA+BADARM67SLU+ZKMb1GsA+RAAAGFceiHTCoTqj2aq1gAiJ54m6N8BMJBTt8HW5gHdoFoDSDjxZOA7QZHc09MsRuueolVrAPkQACDxzKg8i9O6JwLVGkA+BABIPLOPtXtQv7lRrQFEZGdgscjHM5Otz3LpNmZ9VY9eRvrwaQ0+nplk7evUzTrVGkAkEm3k0xpxqVY80yCo1wAikeg0AzFJK55pGFRrAJFItKFPa1Rb8UyDoOEcebgvHwrm45nWXmi9oF4DyJcAgBXPNA6qNYCEfbVG1op8PDPdimfqBA81gOIi5QGAdM0rkonChGTFM42CpxpAaSQgQII3OgIAeSV8y4pn6grHiNqeagDFDxvlSwBgWjS/SLXimXoWf+WCADzWACq0c8zlqwToCgDEhoSw1tGKZ+qCtGwiJM81gDLtfdwDALrCK+F2O5akFc/UBfEZ/E73oRkeawANhJfjjAcAsu32vlY8UzcU2u3YenmtAYRy0EOFrWhDdU5mUNWmWfFM3QCN2AigUgOoAE3eCYYDAGjxn2HFM3Wv/CG3wtVqAOHASrrqVjQv0odPtuKZOgGdZK5SqwEk+mqWgQBAnGhTvRXP1OHWIndLpQbQAIG16QbqZiUIcrXimfqmAXuUSg0g4eSLkR0Ags5Z8Uw9kC4ohMfZPTaER0meZWCmGER6SE6wnDPNkCNIxmMNIJFBggatn24nIE10e1RoteUGaINQMgt43t/nSnY7HZeRttGwYuIIT5VVskaL7yQcOU7N8xQKHio9uhhSoieen+9+c5/oCeHWykYdyt2Gc4LyHD9NpDFJueXhkXG6bFKVcHd2VaGlMdogPkMyosvDlDUrJD17csKsfCPuGcDmMHlaWrWV1NQBeRJDlZ5dIpfNCL1qIrk9PTchx0poGgqgQLcpOXNU37wBlmMbOJA/LBpOHTlxljsb+LC66+NxADh3dN90kGsNJ6VXJLC2dXvrTW3Pd7Z/bFPr3UyIaP06TvEF600JYxz9iqdmSgvDTEqBf5uCrxEeHQ3+UXJFAh0UhB+8S3wfZyunVFIpnpD43oGJTEjMYpjF0sFzFF5kTIn91dD/ZBsxZcy2k7jVEpxOxvn+e+e6X5EOtOasSHBlvdcuOqiHuNa+6560RujdVCZsOMY8KiGxg7nbJKpG08+yjXbmcY6o9uBQ/tfNbFN0RQILKm9X7eIRIhrPIPRuKhPQELlbKpq7fNfKda+8cvzDosS3tqx5jP79A4A0xJx8HuMAsOY0PeMFG3A6augtzuJi+EvWy0VEHv/gdaLp2nT3KxIoPlq52HGlGCRuOoP4e2D4orIztbeonQPQzS0U9V39OKejg+pGXSwq27+/3sbOOZVU1tcOICCT3ld9cv/bf6WXCBSKaJaBHDnmmSdo+v37FXDPvTXhxGn2Jw655vs3HCDm7KdzBSYgo3bHpAfcB1/WD75K5kQj/f7xtqAhY/rT9Iwn6PnTSUPAGTOVPni8MWgIWNVGn3qM/hnUZAzzx4E6YbQkLuZsvqs9+I/uV6QTxLtopqFetLHKU5GVsqDyO4q6RTWNAzeaqd3by6gUPBkhnBvNx6htiNeuCqqp9V1qMRCQSe819Jf0wb+JKBRoVrJDUuSn6CV/Wtc4UwF3TP8v22Z8j7jBI5+7TL8Hb9jqEJiAiKuTaEnEsRd91OcVY+lvACgNGnnbVPr88BUf0bNJQzDor9IvOMCeoJERY+fNBhFj5xTVXlpHP3fp0i4bqGDkqecFd/7onaqYfa3U7q6ubkciL5rESmr3RrA0KwVUQN4DMN5R29VC1Xd1QSUBMc1YNLXUNiy5ESJkvvfRNP0GKJ03hFBIaFa0QxJkUDpjrgdSITc+LwJ7g0TIJxrn/bsRykpgAoJaxt1E12Yt81Vp2q46ONHAXsHD9EzSEMjrf48N44zpH/Sb5ctfRUPxA/ov2MaUTZKZDNeFe+eqdXuu8iWICESiuTgcNyKaUYObazgHZwoWjauDQtavjuomyELvo+mrNvDFh0WEQkKzomgkyKCUnveLQR5Eg7ixx+3dH6TpIGThXBwTOIv2uGih0H6AmeTrB5GguQS469v6Q8WGEnmWNAjOB0jnMc5UrMKIvNGs6CBzZDZrc3C0aresTMSi4RoxzUdsUjeA05oK/P8j1GKCLPQ+mv4lP8hZCgnNiqKRIIMVz8O/nz6gJBrMjVK3d48YS8+3sQ+aKRKN2Ec73MS8nOKzkwFFc+O/SDRPwnGwd94Q0hCJbyuiB42crbbxEERUVTDSZVXEzmvDdYkGOtJi0Yi05iE3ranD/3dQdxFkoXeeHEIhoVnxnSXIyAhDR+Aem5JongScxSDIT0ERvScVTW2Wu0Hb4LMbUEO/DmL20kg0nwFwCM53pIFWtF0Dsdb8CoBvIc7T7wQhU9XpQPexWlUn8xHbg8tlvezYflJRNAsqFwNnCyUSjXMpdV26roFag2zFGgqaDGcZVS2IhvTOM4lQSGhW6F2G7FwI/9z4A/YZJMhEa4R3X9U2/19T8VRcIzItMjeg2Vc3APpjp/5D03Ogsnz+JlTr2YA0IE82MWi8Pv0Ofeo0xBkJreySXb9eh+bMVbD19icj4WB5zV1HEu+8apN7ZIyETk405yqzrm+ixKIBtZVU/VetTSlIFE3d+26hOEPzxdbWjZAaqn7HUuqITYTM907GL0+hQLO8dxnyisvn31z+TOPfp8uRiWiEJ1+GvKmh0RTEMwEJ9o5JI3raef4CuspbHsSOGU0f/C1ngVEDziSbmEfReD3URtPf7EGD6ufI3j6H2IFaiLzDzDK3OFlZsHx5AEUsmZISkRuAJ3WKOnP44nD2f8RtuLKG17BVa+caMWVIegCuZ+CFA+OACJnv/RA3fQgUcjSPVOhdhhxzFv1dUqhA6p+nfsbPWRxyKTZm3yKDSZgAnEuZlyQLZp+XnC5nZ8NEdni8HrPerYHU9z6UMnGCmIaJzo8wDYsaVnJ54M6G9YgrUzYxR0S+iOO+m4rxlNemK/ffubAAPh8Rwsd4nGD1wvUO7sf1YrGjXxYCMbK0dyCisLMhlvPQPPdOkK+sbljpUCFV9O4C+SwT1pYxR2w9Hw1wm+/EDWE+mrNr5YazeJgoEbyUUfNGnPuY2w2OHDUE771j0ejqXTepLuScMcwyaRy3lmF2NlX3iGjGNP5O0hACG41Ilc8XKd/ocK1trfcelk9klvVWpMtr786HZwzR2bsRUhdduC4PsbrWXth/YECPvKNzdaykIbJHG5YvP+nL6B7fu2FGj713YnOjq/fxvU5Uz0L8/29Gs6QAWOA/buvYsBZpL9f16J/GThKU+VXOvZoLOXrOSSfZo3ScQ8y3Tw5YcUjzzoq5V3MhPtUeonm4oH1b2dqfnc2d+w1EkOedFXKv5gI6X5KrEbcYH6rTnMGPRDuJA7WmhELeWZ57NRVicfEHjWObPfWerPUUA96AZ+KX3DWlXEV5Zz736mzpufWvD8B+kzVJk0sZpq+GRzW7WdW8/deaUq51Yk1hg65TmtmAm7mQzx1iCNeCzFc80sZtF3cWO9u0l9OUchXnnV1s7jX+cFO3+UrDfwQqo0C7GFF1Ao0uA4Y880TjOeWqnHfmcq+BsCydRTbJa1iuZAtb6jUUm4gnZ7EyNpolGg0pV/e8s3vu1UwoFk7CqRsp8dmsdHVPoJ+APdg00WhIubrlnaW5V/NA/B3IUI1TB/f9HG1+Ngc5JmuNt5SrW7qV+0eWZfY7hIXYtfOvn/shIbVVqvjQsHZ3u5dE4y3lKs47c7lXeZbZ7+D+ic5Ur5NfATpal45rEwzuo75KjXU/iVduyvt5SLm6cMrVKc8787lXeZbZ34Cre2TjtUpulFr1lHI4nfeLxwdOC2PT4E3ei62ho/JR2G/IRPdE5ZtsILykXEnmV8i9eknd+gegCkRHAjy8wwaGQtZ7CRPHhYSkFXBngQsB2FgV4jUCgxanmfmFrKM9Aj47OiDTJJgoF5v5FeVejWeZewjC7akoGoa1JgzqUKa9xIvtG4UP74SSdUrYBG9KVmJPnsWFAzLhvwMHRwVwQSOXA2V+RbnXXswya4KC6HA8aHjRQO84yWO8v5j7JVcUOfCmY336ook/EseA8JVBVT+lM8Djze0+jPOaBNEAl2pyIFdbUCcnTpjMUoEFBkEkGo0+XbjWR+MKIMkWi/0nGs3TBi42NcxfL7J2+/br2O4GYiq590UzSpdownBtEX+9yGYGAloxBmAq2V+iSdDsaeC4gR/fpZ1hd+QHXCrZD6KZrEs0riR7T4J6h3UMf1gisFLJ/hDNhP+1d36hbVVxHL+w0qxJNxldu3Suf9Ks7TwladN0oSyNfwh5CCMahVbcYPhUhpaxIlWxDxqx+FgUpwxhy1PfRh+iiOKDIIpvIkL2ZqEPBTeQPesQf/fm3nNvc2+be+xdcnLz/cDgULpA7ofcc9Lk9/0KqdkXn9cMNat8dtc2xtsZak7Kqubym18Z3xlOvirFx/tNVJOWWo3yhjm0s9jzcmepKYg1rzRbzeK1nvKKcUf7PNhRanJyl+K8fq3n+teGmvY/owmpibbuwxcXhFZ7ivwF9EyH3dDkVnPZMqrbcccA7csEBVmfSnKVfzhpG+PtDDVpaZ8Lf8tpH+NtWzUfiqjJSq/GYYzX92q078lIOjNTuv6p/udNpzFeqGkhi+W7ta+POY7x+l6N9mW0jLTPJeivGVpNTVhEzQUFQA3UuFZzKiAwXgigBmoUfZypFxcNaqDGvZp51+OC4Oh0Q40v1Cy1dqQZag6mCDVSq5nERZNQTRxqZFWj1fIO4KJJqOY01EitZggXTUI1o1AjtRqMAMqoJgU1sqrRpjPP46JBDdQEAm5ztSOYaYaaJ8O53d3dT2rDHaEvt4S+q1YraF4vrdXKTZRSac1x4eH8tZCa5o6be88rvH1Sufnn8br2QDOU204tprtvhxFleoD76qrc5bDwcP5aSM1gm6sJfXDub6Pi7Zf6Vw0P5bajx3T33f7h6sYeW1FCt9mVqx+zctC+8HD+WlzNeDvfv/uev3HQZXvWUuVWh7Wg+S22rGxXH3Ypv7JKwr5QvJu/FlJzQmo1bjqgdTXf/XTv3o/a1TZKky09yHpet5ngbY3pVt5nv9O/FeX+HmMr9oW2pXkT5S2u5pikZtx0QHM1n317/IZ6Q0sapclmKLeR120mePOY7tDG5gP2eERZYEXlDvueLdsX6q8lvYnyFlITlliNmw5oyw3tjL4wSpN5KDfP6+YJ3mZM980q7fV3g8pC5eJ29daj6rJ9UXswbf46dMQob3E13bOz4XD4BDE4ODgxMRGJRBKJRCo1Ojp6mojF4vFicWlpaX5+fmZm5hTxlMrTxEmVaDSayxUK6XQ6m83n85nMBWJ6erq3t/dFYmpqanJycoAYIsbGxs4Tw8PDjU4fbjqgLWqMBS9NNnqQzfJlI8HbEtO9vv7HHu31JGKH9he2bF/UDuna/HUy2cS9ZjbQQhoejBt3QDuoMUuT9eRnntfNA2+tMd1B2lEqIwvsG9px/lXvY/ULXY0XZzQhNZckVuOmA9pBjVmarKvhed08wbuuHvqLysgdxh6/pB4G7IvaDc2T+WshNWelftU07oBWjfzTZV1YSpP1UG6e123GRO8bp1ZfNdtV9pG6SNgX2u94E+WtqXHdljYkrxo3HdBaBfnWX+9oi9e2ti4qltJkI5TbyOs21Rgx3c9V3l17b4fOAeobzLeNd5r7F5o9b6K8xdREA4H+/m7iGDE+Pj43N0c79DBt1LRfq9v2EG3ftIvTXj5FWzrt7LS/T9M2n8lk8vlsNptOFwq5HJ0EtBOBejTQzgjqYYHODHRyoPNDsRiPx2IxOlLQySKVojNGIhKZaFh64KYDWun7jX6m3rjO0IJudZbSZN6DrOd1WxK89ZjuR+oBjV0x/ixz6wWnhXdR3mJqJMZNB7QTZmmyEcptz+s2Yrp/Lm1u6o+4sbkWdF54FuXd7xc1nEM6oBv7PeDn9oLm4AELD6O8NTWX/KTmkA7o/42LemhDondR3v5Tc1gH9NFumaL/4YhR3v5T4xugBmoA1EANgBqoAVADoAZqwJNUcxbXAWoA1PiAANRADYAaqAFQ09FqkrgOUAOgBmoA1EANgBoANW2uBpcBaoComrag49QMQI2sRKEGaqAGagAAAAAAAAAAAAAAAAAAAAAAAAAAAACglfwH5tbw/JpPhLwAAAAASUVORK5CYII=\" alt=\"Elements of a middleware function call\" id=\"mw-fig-img\"> </td> <td class=\"mw-fig-callouts\"> <div class=\"callout\" id=\"callout1\">HTTP method for which the middleware function applies.</div> <div class=\"callout\" id=\"callout2\">Path (route) for which the middleware function applies.</div> <div class=\"callout\" id=\"callout3\">The middleware function.</div> <div class=\"callout\" id=\"callout4\">Callback argument to the middleware function, called \"next\" by convention.</div> <div class=\"callout\" id=\"callout5\">HTTP <a href=\"https://expressjs.com/en/index.html#res\">response</a> argument to the middleware function, called \"res\" by convention.</div> <div class=\"callout\" id=\"callout6\">HTTP <a href=\"https://expressjs.com/en/index.html#req\">request</a> argument to the middleware function, called \"req\" by convention.</div> </td>\n</tr> </table> </div> <p>Starting with Express 5, middleware functions that return a Promise will call <code class=\"language-plaintext highlighter-rouge\">next(value)</code> when they reject or throw an error. <code class=\"language-plaintext highlighter-rouge\">next</code> will be called with either the rejected value or the thrown Error.</p> <h2>Example</h2> <p>Here is an example of a simple “Hello World” Express application. The remainder of this article will define and add three middleware functions to the application: one called <code class=\"language-plaintext highlighter-rouge\">myLogger</code> that prints a simple log message, one called <code class=\"language-plaintext highlighter-rouge\">requestTime</code> that displays the timestamp of the HTTP request, and one called <code class=\"language-plaintext highlighter-rouge\">validateCookies</code> that validates incoming cookies.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst app = express()\n\napp.get('/', (req, res) =&gt; {\n  res.send('Hello World!')\n})\n\napp.listen(3000)\n</pre></div> <h3>Middleware function myLogger</h3> <p>Here is a simple example of a middleware function called “myLogger”. This function just prints “LOGGED” when a request to the app passes through it. The middleware function is assigned to a variable named <code class=\"language-plaintext highlighter-rouge\">myLogger</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const myLogger = function (req, res, next) {\n  console.log('LOGGED')\n  next()\n}\n</pre></div> <div class=\"doc-box doc-notice\"> <p>Notice the call above to <code class=\"language-plaintext highlighter-rouge\">next()</code>. Calling this function invokes the next middleware function in the app. The <code class=\"language-plaintext highlighter-rouge\">next()</code> function is not a part of the Node.js or Express API, but is the third argument that is passed to the middleware function. The <code class=\"language-plaintext highlighter-rouge\">next()</code> function could be named anything, but by convention it is always named “next”. To avoid confusion, always use this convention.</p> </div> <p>To load the middleware function, call <code class=\"language-plaintext highlighter-rouge\">app.use()</code>, specifying the middleware function. For example, the following code loads the <code class=\"language-plaintext highlighter-rouge\">myLogger</code> middleware function before the route to the root path (/).</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst app = express()\n\nconst myLogger = function (req, res, next) {\n  console.log('LOGGED')\n  next()\n}\n\napp.use(myLogger)\n\napp.get('/', (req, res) =&gt; {\n  res.send('Hello World!')\n})\n\napp.listen(3000)\n</pre></div> <p>Every time the app receives a request, it prints the message “LOGGED” to the terminal.</p> <p>The order of middleware loading is important: middleware functions that are loaded first are also executed first.</p> <p>If <code class=\"language-plaintext highlighter-rouge\">myLogger</code> is loaded after the route to the root path, the request never reaches it and the app doesn’t print “LOGGED”, because the route handler of the root path terminates the request-response cycle.</p> <p>The middleware function <code class=\"language-plaintext highlighter-rouge\">myLogger</code> simply prints a message, then passes on the request to the next middleware function in the stack by calling the <code class=\"language-plaintext highlighter-rouge\">next()</code> function.</p> <h3>Middleware function requestTime</h3> <p>Next, we’ll create a middleware function called “requestTime” and add a property called <code class=\"language-plaintext highlighter-rouge\">requestTime</code> to the request object.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const requestTime = function (req, res, next) {\n  req.requestTime = Date.now()\n  next()\n}\n</pre></div> <p>The app now uses the <code class=\"language-plaintext highlighter-rouge\">requestTime</code> middleware function. Also, the callback function of the root path route uses the property that the middleware function adds to <code class=\"language-plaintext highlighter-rouge\">req</code> (the request object).</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst app = express()\n\nconst requestTime = function (req, res, next) {\n  req.requestTime = Date.now()\n  next()\n}\n\napp.use(requestTime)\n\napp.get('/', (req, res) =&gt; {\n  let responseText = 'Hello World!&lt;br&gt;'\n  responseText += `&lt;small&gt;Requested at: ${req.requestTime}&lt;/small&gt;`\n  res.send(responseText)\n})\n\napp.listen(3000)\n</pre></div> <p>When you make a request to the root of the app, the app now displays the timestamp of your request in the browser.</p> <h3>Middleware function validateCookies</h3> <p>Finally, we’ll create a middleware function that validates incoming cookies and sends a 400 response if cookies are invalid.</p> <p>Here’s an example function that validates cookies with an external async service.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">async function cookieValidator (cookies) {\n  try {\n    await externallyValidateCookie(cookies.testCookie)\n  } catch {\n    throw new Error('Invalid cookies')\n  }\n}\n</pre></div> <p>Here, we use the <a href=\"https://expressjs.com/resources/middleware/cookie-parser.html\"><code class=\"language-plaintext highlighter-rouge\">cookie-parser</code></a> middleware to parse incoming cookies off the <code class=\"language-plaintext highlighter-rouge\">req</code> object and pass them to our <code class=\"language-plaintext highlighter-rouge\">cookieValidator</code> function. The <code class=\"language-plaintext highlighter-rouge\">validateCookies</code> middleware returns a Promise that upon rejection will automatically trigger our error handler.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst cookieParser = require('cookie-parser')\nconst cookieValidator = require('./cookieValidator')\n\nconst app = express()\n\nasync function validateCookies (req, res, next) {\n  await cookieValidator(req.cookies)\n  next()\n}\n\napp.use(cookieParser())\n\napp.use(validateCookies)\n\n// error handler\napp.use((err, req, res, next) =&gt; {\n  res.status(400).send(err.message)\n})\n\napp.listen(3000)\n</pre></div> <div class=\"doc-box doc-notice\"> <p>Note how <code class=\"language-plaintext highlighter-rouge\">next()</code> is called after <code class=\"language-plaintext highlighter-rouge\">await cookieValidator(req.cookies)</code>. This ensures that if <code class=\"language-plaintext highlighter-rouge\">cookieValidator</code> resolves, the next middleware in the stack will get called. If you pass anything to the <code class=\"language-plaintext highlighter-rouge\">next()</code> function (except the string <code class=\"language-plaintext highlighter-rouge\">'route'</code> or <code class=\"language-plaintext highlighter-rouge\">'router'</code>), Express regards the current request as being an error and will skip any remaining non-error handling routing and middleware functions.</p> </div> <p>Because you have access to the request object, the response object, the next middleware function in the stack, and the whole Node.js API, the possibilities with middleware functions are endless.</p> <p>For more information about Express middleware, see: <a href=\"using-middleware\">Using Express middleware</a>.</p> <h2>Configurable middleware</h2> <p>If you need your middleware to be configurable, export a function which accepts an options object or other parameters, which, then returns the middleware implementation based on the input parameters.</p> <p>File: <code class=\"language-plaintext highlighter-rouge\">my-middleware.js</code></p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">module.exports = function (options) {\n  return function (req, res, next) {\n    // Implement the middleware function based on the options object\n    next()\n  }\n}\n</pre></div> <p>The middleware can now be used as shown below.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const mw = require('./my-middleware.js')\n\napp.use(mw({ option1: '1', option2: '2' }))\n</pre></div> <p>Refer to <a href=\"https://github.com/expressjs/cookie-session\">cookie-session</a> and <a href=\"https://github.com/expressjs/compression\">compression</a> for examples of configurable middleware.</p>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/guide/writing-middleware.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/guide/writing-middleware.html\" class=\"_attribution-link\">https://expressjs.com/en/guide/writing-middleware.html</a>\n  </p>\n</div>\n","guide/overriding-express-api":"<main> <h1 id=\"overriding-the-express-api\" data-level=\"4\">Overriding the Express API</h1> <p>The Express API consists of various methods and properties on the request and response objects. These are inherited by prototype. There are two extension points for the Express API:</p> <ol> <li>The global prototypes at <code class=\"language-plaintext highlighter-rouge\">express.request</code> and <code class=\"language-plaintext highlighter-rouge\">express.response</code>.</li> <li>App-specific prototypes at <code class=\"language-plaintext highlighter-rouge\">app.request</code> and <code class=\"language-plaintext highlighter-rouge\">app.response</code>.</li> </ol> <p>Altering the global prototypes will affect all loaded Express apps in the same process. If desired, alterations can be made app-specific by only altering the app-specific prototypes after creating a new app.</p> <h2 id=\"methods\">Methods</h2> <p>You can override the signature and behavior of existing methods with your own, by assigning a custom function.</p> <p>Following is an example of overriding the behavior of <a href=\"https://expressjs.com/index.html#res.sendStatus\">res.sendStatus</a>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.response.sendStatus = function (statusCode, type, message) {\n  // code is intentionally kept simple for demonstration purpose\n  return this.contentType(type)\n    .status(statusCode)\n    .send(message)\n}\n</pre></div> <p>The above implementation completely changes the original signature of <code class=\"language-plaintext highlighter-rouge\">res.sendStatus</code>. It now accepts a status code, encoding type, and the message to be sent to the client.</p> <p>The overridden method may now be used this way:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">res.sendStatus(404, 'application/json', '{\"error\":\"resource not found\"}')\n</pre></div> <h2 id=\"properties\">Properties</h2> <p>Properties in the Express API are either:</p> <ol> <li>Assigned properties (ex: <code class=\"language-plaintext highlighter-rouge\">req.baseUrl</code>, <code class=\"language-plaintext highlighter-rouge\">req.originalUrl</code>)</li> <li>Defined as getters (ex: <code class=\"language-plaintext highlighter-rouge\">req.secure</code>, <code class=\"language-plaintext highlighter-rouge\">req.ip</code>)</li> </ol> <p>Since properties under category 1 are dynamically assigned on the <code class=\"language-plaintext highlighter-rouge\">request</code> and <code class=\"language-plaintext highlighter-rouge\">response</code> objects in the context of the current request-response cycle, their behavior cannot be overridden.</p> <p>Properties under category 2 can be overwritten using the Express API extensions API.</p> <p>The following code rewrites how the value of <code class=\"language-plaintext highlighter-rouge\">req.ip</code> is to be derived. Now, it simply returns the value of the <code class=\"language-plaintext highlighter-rouge\">Client-IP</code> request header.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">Object.defineProperty(app.request, 'ip', {\n  configurable: true,\n  enumerable: true,\n  get () { return this.get('Client-IP') }\n})\n</pre></div> <h2 id=\"prototype\">Prototype</h2> <p>In order to provide the Express API, the request/response objects passed to Express (via <code class=\"language-plaintext highlighter-rouge\">app(req, res)</code>, for example) need to inherit from the same prototype chain. By default, this is <code class=\"language-plaintext highlighter-rouge\">http.IncomingRequest.prototype</code> for the request and <code class=\"language-plaintext highlighter-rouge\">http.ServerResponse.prototype</code> for the response.</p> <p>Unless necessary, it is recommended that this be done only at the application level, rather than globally. Also, take care that the prototype that is being used matches the functionality as closely as possible to the default prototypes.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// Use FakeRequest and FakeResponse in place of http.IncomingRequest and http.ServerResponse\n// for the given app reference\nObject.setPrototypeOf(Object.getPrototypeOf(app.request), FakeRequest.prototype)\nObject.setPrototypeOf(Object.getPrototypeOf(app.response), FakeResponse.prototype)\n</pre></div>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/guide/overriding-express-api.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/guide/overriding-express-api.html\" class=\"_attribution-link\">https://expressjs.com/en/guide/overriding-express-api.html</a>\n  </p>\n</div>\n","guide/error-handling":"<main> <h1 id=\"error-handling\" data-level=\"6\">Error Handling</h1> <p><em>Error Handling</em> refers to how Express catches and processes errors that occur both synchronously and asynchronously. Express comes with a default error handler so you don’t need to write your own to get started.</p> <h2 id=\"catching-errors\">Catching Errors</h2> <p>It’s important to ensure that Express catches all errors that occur while running route handlers and middleware.</p> <p>Errors that occur in synchronous code inside route handlers and middleware require no extra work. If synchronous code throws an error, then Express will catch and process it. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/', (req, res) =&gt; {\n  throw new Error('BROKEN') // Express will catch this on its own.\n})\n</pre></div> <p>For errors returned from asynchronous functions invoked by route handlers and middleware, you must pass them to the <code class=\"language-plaintext highlighter-rouge\">next()</code> function, where Express will catch and process them. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/', (req, res, next) =&gt; {\n  fs.readFile('/file-does-not-exist', (err, data) =&gt; {\n    if (err) {\n      next(err) // Pass errors to Express.\n    } else {\n      res.send(data)\n    }\n  })\n})\n</pre></div> <p>Starting with Express 5, route handlers and middleware that return a Promise will call <code class=\"language-plaintext highlighter-rouge\">next(value)</code> automatically when they reject or throw an error. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/user/:id', async (req, res, next) =&gt; {\n  const user = await getUserById(req.params.id)\n  res.send(user)\n})\n</pre></div> <p>If <code class=\"language-plaintext highlighter-rouge\">getUserById</code> throws an error or rejects, <code class=\"language-plaintext highlighter-rouge\">next</code> will be called with either the thrown error or the rejected value. If no rejected value is provided, <code class=\"language-plaintext highlighter-rouge\">next</code> will be called with a default Error object provided by the Express router.</p> <p>If you pass anything to the <code class=\"language-plaintext highlighter-rouge\">next()</code> function (except the string <code class=\"language-plaintext highlighter-rouge\">'route'</code>), Express regards the current request as being an error and will skip any remaining non-error handling routing and middleware functions.</p> <p>If the callback in a sequence provides no data, only errors, you can simplify this code as follows:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/', [\n  function (req, res, next) {\n    fs.writeFile('/inaccessible-path', 'data', next)\n  },\n  function (req, res) {\n    res.send('OK')\n  }\n])\n</pre></div> <p>In the above example, <code class=\"language-plaintext highlighter-rouge\">next</code> is provided as the callback for <code class=\"language-plaintext highlighter-rouge\">fs.writeFile</code>, which is called with or without errors. If there is no error, the second handler is executed, otherwise Express catches and processes the error.</p> <p>You must catch errors that occur in asynchronous code invoked by route handlers or middleware and pass them to Express for processing. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/', (req, res, next) =&gt; {\n  setTimeout(() =&gt; {\n    try {\n      throw new Error('BROKEN')\n    } catch (err) {\n      next(err)\n    }\n  }, 100)\n})\n</pre></div> <p>The above example uses a <code class=\"language-plaintext highlighter-rouge\">try...catch</code> block to catch errors in the asynchronous code and pass them to Express. If the <code class=\"language-plaintext highlighter-rouge\">try...catch</code> block were omitted, Express would not catch the error since it is not part of the synchronous handler code.</p> <p>Use promises to avoid the overhead of the <code class=\"language-plaintext highlighter-rouge\">try...catch</code> block or when using functions that return promises. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/', (req, res, next) =&gt; {\n  Promise.resolve().then(() =&gt; {\n    throw new Error('BROKEN')\n  }).catch(next) // Errors will be passed to Express.\n})\n</pre></div> <p>Since promises automatically catch both synchronous errors and rejected promises, you can simply provide <code class=\"language-plaintext highlighter-rouge\">next</code> as the final catch handler and Express will catch errors, because the catch handler is given the error as the first argument.</p> <p>You could also use a chain of handlers to rely on synchronous error catching, by reducing the asynchronous code to something trivial. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/', [\n  function (req, res, next) {\n    fs.readFile('/maybe-valid-file', 'utf-8', (err, data) =&gt; {\n      res.locals.data = data\n      next(err)\n    })\n  },\n  function (req, res) {\n    res.locals.data = res.locals.data.split(',')[1]\n    res.send(res.locals.data)\n  }\n])\n</pre></div> <p>The above example has a couple of trivial statements from the <code class=\"language-plaintext highlighter-rouge\">readFile</code> call. If <code class=\"language-plaintext highlighter-rouge\">readFile</code> causes an error, then it passes the error to Express, otherwise you quickly return to the world of synchronous error handling in the next handler in the chain. Then, the example above tries to process the data. If this fails, then the synchronous error handler will catch it. If you had done this processing inside the <code class=\"language-plaintext highlighter-rouge\">readFile</code> callback, then the application might exit and the Express error handlers would not run.</p> <p>Whichever method you use, if you want Express error handlers to be called in and the application to survive, you must ensure that Express receives the error.</p> <h2 id=\"the-default-error-handler\">The default error handler</h2> <p>Express comes with a built-in error handler that takes care of any errors that might be encountered in the app. This default error-handling middleware function is added at the end of the middleware function stack.</p> <p>If you pass an error to <code class=\"language-plaintext highlighter-rouge\">next()</code> and you do not handle it in a custom error handler, it will be handled by the built-in error handler; the error will be written to the client with the stack trace. The stack trace is not included in the production environment.</p> <div class=\"doc-box doc-info\"> <p>Set the environment variable <code class=\"language-plaintext highlighter-rouge\">NODE_ENV</code> to <code class=\"language-plaintext highlighter-rouge\">production</code>, to run the app in production mode.</p> </div> <p>When an error is written, the following information is added to the response:</p> <ul> <li>The <code class=\"language-plaintext highlighter-rouge\">res.statusCode</code> is set from <code class=\"language-plaintext highlighter-rouge\">err.status</code> (or <code class=\"language-plaintext highlighter-rouge\">err.statusCode</code>). If this value is outside the 4xx or 5xx range, it will be set to 500.</li> <li>The <code class=\"language-plaintext highlighter-rouge\">res.statusMessage</code> is set according to the status code.</li> <li>The body will be the HTML of the status code message when in production environment, otherwise will be <code class=\"language-plaintext highlighter-rouge\">err.stack</code>.</li> <li>Any headers specified in an <code class=\"language-plaintext highlighter-rouge\">err.headers</code> object.</li> </ul> <p>If you call <code class=\"language-plaintext highlighter-rouge\">next()</code> with an error after you have started writing the response (for example, if you encounter an error while streaming the response to the client), the Express default error handler closes the connection and fails the request.</p> <p>So when you add a custom error handler, you must delegate to the default Express error handler, when the headers have already been sent to the client:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">function errorHandler (err, req, res, next) {\n  if (res.headersSent) {\n    return next(err)\n  }\n  res.status(500)\n  res.render('error', { error: err })\n}\n</pre></div> <p>Note that the default error handler can get triggered if you call <code class=\"language-plaintext highlighter-rouge\">next()</code> with an error in your code more than once, even if custom error handling middleware is in place.</p> <p>Other error handling middleware can be found at <a href=\"https://expressjs.com/en/resources/middleware.html\">Express middleware</a>.</p> <h2 id=\"writing-error-handlers\">Writing error handlers</h2> <p>Define error-handling middleware functions in the same way as other middleware functions, except error-handling functions have four arguments instead of three: <code class=\"language-plaintext highlighter-rouge\">(err, req, res, next)</code>. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use((err, req, res, next) =&gt; {\n  console.error(err.stack)\n  res.status(500).send('Something broke!')\n})\n</pre></div> <p>You define error-handling middleware last, after other <code class=\"language-plaintext highlighter-rouge\">app.use()</code> and routes calls; for example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const bodyParser = require('body-parser')\nconst methodOverride = require('method-override')\n\napp.use(bodyParser.urlencoded({\n  extended: true\n}))\napp.use(bodyParser.json())\napp.use(methodOverride())\napp.use((err, req, res, next) =&gt; {\n  // logic\n})\n</pre></div> <p>Responses from within a middleware function can be in any format, such as an HTML error page, a simple message, or a JSON string.</p> <p>For organizational (and higher-level framework) purposes, you can define several error-handling middleware functions, much as you would with regular middleware functions. For example, to define an error-handler for requests made by using <code class=\"language-plaintext highlighter-rouge\">XHR</code> and those without:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const bodyParser = require('body-parser')\nconst methodOverride = require('method-override')\n\napp.use(bodyParser.urlencoded({\n  extended: true\n}))\napp.use(bodyParser.json())\napp.use(methodOverride())\napp.use(logErrors)\napp.use(clientErrorHandler)\napp.use(errorHandler)\n</pre></div> <p>In this example, the generic <code class=\"language-plaintext highlighter-rouge\">logErrors</code> might write request and error information to <code class=\"language-plaintext highlighter-rouge\">stderr</code>, for example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">function logErrors (err, req, res, next) {\n  console.error(err.stack)\n  next(err)\n}\n</pre></div> <p>Also in this example, <code class=\"language-plaintext highlighter-rouge\">clientErrorHandler</code> is defined as follows; in this case, the error is explicitly passed along to the next one.</p> <p>Notice that when <em>not</em> calling “next” in an error-handling function, you are responsible for writing (and ending) the response. Otherwise, those requests will “hang” and will not be eligible for garbage collection.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">function clientErrorHandler (err, req, res, next) {\n  if (req.xhr) {\n    res.status(500).send({ error: 'Something failed!' })\n  } else {\n    next(err)\n  }\n}\n</pre></div> <p>Implement the “catch-all” <code class=\"language-plaintext highlighter-rouge\">errorHandler</code> function as follows (for example):</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">function errorHandler (err, req, res, next) {\n  res.status(500)\n  res.render('error', { error: err })\n}\n</pre></div> <p>If you have a route handler with multiple callback functions, you can use the <code class=\"language-plaintext highlighter-rouge\">route</code> parameter to skip to the next route handler. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/a_route_behind_paywall',\n  (req, res, next) =&gt; {\n    if (!req.user.hasPaid) {\n      // continue handling this request\n      next('route')\n    } else {\n      next()\n    }\n  }, (req, res, next) =&gt; {\n    PaidContent.find((err, doc) =&gt; {\n      if (err) return next(err)\n      res.json(doc)\n    })\n  })\n</pre></div> <p>In this example, the <code class=\"language-plaintext highlighter-rouge\">getPaidContent</code> handler will be skipped but any remaining handlers in <code class=\"language-plaintext highlighter-rouge\">app</code> for <code class=\"language-plaintext highlighter-rouge\">/a_route_behind_paywall</code> would continue to be executed.</p> <div class=\"doc-box doc-info\"> <p>Calls to <code class=\"language-plaintext highlighter-rouge\">next()</code> and <code class=\"language-plaintext highlighter-rouge\">next(err)</code> indicate that the current handler is complete and in what state. <code class=\"language-plaintext highlighter-rouge\">next(err)</code> will skip all remaining handlers in the chain except for those that are set up to handle errors as described above.</p> </div>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/guide/error-handling.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/guide/error-handling.html\" class=\"_attribution-link\">https://expressjs.com/en/guide/error-handling.html</a>\n  </p>\n</div>\n","advanced/best-practice-performance":"<main> <h1 id=\"production-best-practices-performance-and-reliability\" data-level=\"4\">Production best practices: performance and reliability</h1> <p>This article discusses performance and reliability best practices for Express applications deployed to production.</p> <p>This topic clearly falls into the “devops” world, spanning both traditional development and operations. Accordingly, the information is divided into two parts:</p> <ul> <li>Things to do in your code (the dev part): <ul> <li><a href=\"#use-gzip-compression\">Use gzip compression</a></li> <li><a href=\"#dont-use-synchronous-functions\">Don’t use synchronous functions</a></li> <li><a href=\"#do-logging-correctly\">Do logging correctly</a></li> <li><a href=\"#handle-exceptions-properly\">Handle exceptions properly</a></li> </ul> </li> <li>Things to do in your environment / setup (the ops part): <ul> <li><a href=\"#set-node_env-to-production\">Set NODE_ENV to “production”</a></li> <li><a href=\"#ensure-your-app-automatically-restarts\">Ensure your app automatically restarts</a></li> <li><a href=\"#run-your-app-in-a-cluster\">Run your app in a cluster</a></li> <li><a href=\"#cache-request-results\">Cache request results</a></li> <li><a href=\"#use-a-load-balancer\">Use a load balancer</a></li> <li><a href=\"#use-a-reverse-proxy\">Use a reverse proxy</a></li> </ul> </li> </ul> <h2 id=\"in-code\">Things to do in your code</h2> <p>Here are some things you can do in your code to improve your application’s performance:</p> <ul> <li><a href=\"#use-gzip-compression\">Use gzip compression</a></li> <li><a href=\"#dont-use-synchronous-functions\">Don’t use synchronous functions</a></li> <li><a href=\"#do-logging-correctly\">Do logging correctly</a></li> <li><a href=\"#handle-exceptions-properly\">Handle exceptions properly</a></li> </ul> <h3 id=\"use-gzip-compression\">Use gzip compression</h3> <p>Gzip compressing can greatly decrease the size of the response body and hence increase the speed of a web app. Use the <a href=\"https://www.npmjs.com/package/compression\">compression</a> middleware for gzip compression in your Express app. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const compression = require('compression')\nconst express = require('express')\nconst app = express()\n\napp.use(compression())\n</pre></div> <p>For a high-traffic website in production, the best way to put compression in place is to implement it at a reverse proxy level (see <a href=\"#use-a-reverse-proxy\">Use a reverse proxy</a>). In that case, you do not need to use compression middleware. For details on enabling gzip compression in Nginx, see <a href=\"http://nginx.org/en/docs/http/ngx_http_gzip_module.html\">Module ngx_http_gzip_module</a> in the Nginx documentation.</p> <h3 id=\"dont-use-synchronous-functions\">Don’t use synchronous functions</h3> <p>Synchronous functions and methods tie up the executing process until they return. A single call to a synchronous function might return in a few microseconds or milliseconds, however in high-traffic websites, these calls add up and reduce the performance of the app. Avoid their use in production.</p> <p>Although Node and many modules provide synchronous and asynchronous versions of their functions, always use the asynchronous version in production. The only time when a synchronous function can be justified is upon initial startup.</p> <p>You can use the <code class=\"language-plaintext highlighter-rouge\">--trace-sync-io</code> command-line flag to print a warning and a stack trace whenever your application uses a synchronous API. Of course, you wouldn’t want to use this in production, but rather to ensure that your code is ready for production. See the <a href=\"https://nodejs.org/api/cli.html#cli_trace_sync_io\">node command-line options documentation</a> for more information.</p> <h3 id=\"do-logging-correctly\">Do logging correctly</h3> <p>In general, there are two reasons for logging from your app: For debugging and for logging app activity (essentially, everything else). Using <code class=\"language-plaintext highlighter-rouge\">console.log()</code> or <code class=\"language-plaintext highlighter-rouge\">console.error()</code> to print log messages to the terminal is common practice in development. But <a href=\"https://nodejs.org/api/console.html#console\">these functions are synchronous</a> when the destination is a terminal or a file, so they are not suitable for production, unless you pipe the output to another program.</p> <h4 id=\"for-debugging\">For debugging</h4> <p>If you’re logging for purposes of debugging, then instead of using <code class=\"language-plaintext highlighter-rouge\">console.log()</code>, use a special debugging module like <a href=\"https://www.npmjs.com/package/debug\">debug</a>. This module enables you to use the DEBUG environment variable to control what debug messages are sent to <code class=\"language-plaintext highlighter-rouge\">console.error()</code>, if any. To keep your app purely asynchronous, you’d still want to pipe <code class=\"language-plaintext highlighter-rouge\">console.error()</code> to another program. But then, you’re not really going to debug in production, are you?</p> <h4 id=\"for-app-activity\">For app activity</h4> <p>If you’re logging app activity (for example, tracking traffic or API calls), instead of using <code class=\"language-plaintext highlighter-rouge\">console.log()</code>, use a logging library like <a href=\"https://www.npmjs.com/package/pino\">Pino</a>, which is the fastest and most efficient option available.</p> <h3 id=\"handle-exceptions-properly\">Handle exceptions properly</h3> <p>Node apps crash when they encounter an uncaught exception. Not handling exceptions and taking appropriate actions will make your Express app crash and go offline. If you follow the advice in <a href=\"#ensure-your-app-automatically-restarts\">Ensure your app automatically restarts</a> below, then your app will recover from a crash. Fortunately, Express apps typically have a short startup time. Nevertheless, you want to avoid crashing in the first place, and to do that, you need to handle exceptions properly.</p> <p>To ensure you handle all exceptions, use the following techniques:</p> <ul> <li><a href=\"#use-try-catch\">Use try-catch</a></li> <li><a href=\"#use-promises\">Use promises</a></li> </ul> <p>Before diving into these topics, you should have a basic understanding of Node/Express error handling: using error-first callbacks, and propagating errors in middleware. Node uses an “error-first callback” convention for returning errors from asynchronous functions, where the first parameter to the callback function is the error object, followed by result data in succeeding parameters. To indicate no error, pass null as the first parameter. The callback function must correspondingly follow the error-first callback convention to meaningfully handle the error. And in Express, the best practice is to use the next() function to propagate errors through the middleware chain.</p> <p>For more on the fundamentals of error handling, see:</p> <ul> <li><a href=\"https://www.tritondatacenter.com/node-js/production/design/errors\">Error Handling in Node.js</a></li> </ul> <h4 id=\"use-try-catch\">Use try-catch</h4> <p>Try-catch is a JavaScript language construct that you can use to catch exceptions in synchronous code. Use try-catch, for example, to handle JSON parsing errors as shown below.</p> <p>Here is an example of using try-catch to handle a potential process-crashing exception. This middleware function accepts a query field parameter named “params” that is a JSON object.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/search', (req, res) =&gt; {\n  // Simulating async operation\n  setImmediate(() =&gt; {\n    const jsonStr = req.query.params\n    try {\n      const jsonObj = JSON.parse(jsonStr)\n      res.send('Success')\n    } catch (e) {\n      res.status(400).send('Invalid JSON string')\n    }\n  })\n})\n</pre></div> <p>However, try-catch works only for synchronous code. Because the Node platform is primarily asynchronous (particularly in a production environment), try-catch won’t catch a lot of exceptions.</p> <h4 id=\"use-promises\">Use promises</h4> <p>When an error is thrown in an <code class=\"language-plaintext highlighter-rouge\">async</code> function or a rejected promise is awaited inside an <code class=\"language-plaintext highlighter-rouge\">async</code> function, those errors will be passed to the error handler as if calling <code class=\"language-plaintext highlighter-rouge\">next(err)</code></p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/', async (req, res, next) =&gt; {\n  const data = await userData() // If this promise fails, it will automatically call `next(err)` to handle the error.\n\n  res.send(data)\n})\n\napp.use((err, req, res, next) =&gt; {\n  res.status(err.status ?? 500).send({ error: err.message })\n})\n</pre></div> <p>Also, you can use asynchronous functions for your middleware, and the router will handle errors if the promise fails, for example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use(async (req, res, next) =&gt; {\n  req.locals.user = await getUser(req)\n\n  next() // This will be called if the promise does not throw an error.\n})\n</pre></div> <p>Best practice is to handle errors as close to the site as possible. So while this is now handled in the router, it’s best to catch the error in the middleware and handle it without relying on separate error-handling middleware.</p> <h4 id=\"what-not-to-do\">What not to do</h4> <p>One thing you should <em>not</em> do is to listen for the <code class=\"language-plaintext highlighter-rouge\">uncaughtException</code> event, emitted when an exception bubbles all the way back to the event loop. Adding an event listener for <code class=\"language-plaintext highlighter-rouge\">uncaughtException</code> will change the default behavior of the process that is encountering an exception; the process will continue to run despite the exception. This might sound like a good way of preventing your app from crashing, but continuing to run the app after an uncaught exception is a dangerous practice and is not recommended, because the state of the process becomes unreliable and unpredictable.</p> <p>Additionally, using <code class=\"language-plaintext highlighter-rouge\">uncaughtException</code> is officially recognized as <a href=\"https://nodejs.org/api/process.html#process_event_uncaughtexception\">crude</a>. So listening for <code class=\"language-plaintext highlighter-rouge\">uncaughtException</code> is just a bad idea. This is why we recommend things like multiple processes and supervisors: crashing and restarting is often the most reliable way to recover from an error.</p> <p>We also don’t recommend using <a href=\"https://nodejs.org/api/domain.html\">domains</a>. It generally doesn’t solve the problem and is a deprecated module.</p> <h2 id=\"in-environment\">Things to do in your environment / setup</h2> <p>Here are some things you can do in your system environment to improve your app’s performance:</p> <ul> <li><a href=\"#set-node_env-to-production\">Set NODE_ENV to “production”</a></li> <li><a href=\"#ensure-your-app-automatically-restarts\">Ensure your app automatically restarts</a></li> <li><a href=\"#run-your-app-in-a-cluster\">Run your app in a cluster</a></li> <li><a href=\"#cache-request-results\">Cache request results</a></li> <li><a href=\"#use-a-load-balancer\">Use a load balancer</a></li> <li><a href=\"#use-a-reverse-proxy\">Use a reverse proxy</a></li> </ul> <h3 id=\"set-node_env-to-production\">Set NODE_ENV to “production”</h3> <p>The NODE_ENV environment variable specifies the environment in which an application is running (usually, development or production). One of the simplest things you can do to improve performance is to set NODE_ENV to <code class=\"language-plaintext highlighter-rouge\">production</code>.</p> <p>Setting NODE_ENV to “production” makes Express:</p> <ul> <li>Cache view templates.</li> <li>Cache CSS files generated from CSS extensions.</li> <li>Generate less verbose error messages.</li> </ul> <p><a href=\"https://www.dynatrace.com/news/blog/the-drastic-effects-of-omitting-node-env-in-your-express-js-applications/\">Tests indicate</a> that just doing this can improve app performance by a factor of three!</p> <p>If you need to write environment-specific code, you can check the value of NODE_ENV with <code class=\"language-plaintext highlighter-rouge\">process.env.NODE_ENV</code>. Be aware that checking the value of any environment variable incurs a performance penalty, and so should be done sparingly.</p> <p>In development, you typically set environment variables in your interactive shell, for example by using <code class=\"language-plaintext highlighter-rouge\">export</code> or your <code class=\"language-plaintext highlighter-rouge\">.bash_profile</code> file. But in general, you shouldn’t do that on a production server; instead, use your OS’s init system (systemd). The next section provides more details about using your init system in general, but setting <code class=\"language-plaintext highlighter-rouge\">NODE_ENV</code> is so important for performance (and easy to do), that it’s highlighted here.</p> <p>With systemd, use the <code class=\"language-plaintext highlighter-rouge\">Environment</code> directive in your unit file. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\"># /etc/systemd/system/myservice.service\nEnvironment=NODE_ENV=production\n</pre></div> <p>For more information, see <a href=\"https://www.flatcar.org/docs/latest/setup/systemd/environment-variables/\">Using Environment Variables In systemd Units</a>.</p> <h3 id=\"ensure-your-app-automatically-restarts\">Ensure your app automatically restarts</h3> <p>In production, you don’t want your application to be offline, ever. This means you need to make sure it restarts both if the app crashes and if the server itself crashes. Although you hope that neither of those events occurs, realistically you must account for both eventualities by:</p> <ul> <li>Using a process manager to restart the app (and Node) when it crashes.</li> <li>Using the init system provided by your OS to restart the process manager when the OS crashes. It’s also possible to use the init system without a process manager.</li> </ul> <p>Node applications crash if they encounter an uncaught exception. The foremost thing you need to do is to ensure your app is well-tested and handles all exceptions (see <a href=\"#handle-exceptions-properly\">handle exceptions properly</a> for details). But as a fail-safe, put a mechanism in place to ensure that if and when your app crashes, it will automatically restart.</p> <h4 id=\"use-a-process-manager\">Use a process manager</h4> <p>In development, you started your app simply from the command line with <code class=\"language-plaintext highlighter-rouge\">node server.js</code> or something similar. But doing this in production is a recipe for disaster. If the app crashes, it will be offline until you restart it. To ensure your app restarts if it crashes, use a process manager. A process manager is a “container” for applications that facilitates deployment, provides high availability, and enables you to manage the application at runtime.</p> <p>In addition to restarting your app when it crashes, a process manager can enable you to:</p> <ul> <li>Gain insights into runtime performance and resource consumption.</li> <li>Modify settings dynamically to improve performance.</li> <li>Control clustering (pm2).</li> </ul> <p>Historically, it was popular to use a Node.js process manager like <a href=\"https://github.com/Unitech/pm2\">PM2</a>. See their documentation if you wish to do this. However, we recommend using your init system for process management.</p> <h4 id=\"use-an-init-system\">Use an init system</h4> <p>The next layer of reliability is to ensure that your app restarts when the server restarts. Systems can still go down for a variety of reasons. To ensure that your app restarts if the server crashes, use the init system built into your OS. The main init system in use today is <a href=\"https://wiki.debian.org/systemd\">systemd</a>.</p> <p>There are two ways to use init systems with your Express app:</p> <ul> <li>Run your app in a process manager, and install the process manager as a service with the init system. The process manager will restart your app when the app crashes, and the init system will restart the process manager when the OS restarts. This is the recommended approach.</li> <li>Run your app (and Node) directly with the init system. This is somewhat simpler, but you don’t get the additional advantages of using a process manager.</li> </ul> <h5 id=\"systemd\">Systemd</h5> <p>Systemd is a Linux system and service manager. Most major Linux distributions have adopted systemd as their default init system.</p> <p>A systemd service configuration file is called a <em>unit file</em>, with a filename ending in <code class=\"language-plaintext highlighter-rouge\">.service</code>. Here’s an example unit file to manage a Node app directly. Replace the values enclosed in <code class=\"language-plaintext highlighter-rouge\">&lt;angle brackets&gt;</code> for your system and app:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">[Unit]\nDescription=&lt;Awesome Express App&gt;\n\n[Service]\nType=simple\nExecStart=/usr/local/bin/node &lt;/projects/myapp/index.js&gt;\nWorkingDirectory=&lt;/projects/myapp&gt;\n\nUser=nobody\nGroup=nogroup\n\n# Environment variables:\nEnvironment=NODE_ENV=production\n\n# Allow many incoming connections\nLimitNOFILE=infinity\n\n# Allow core dumps for debugging\nLimitCORE=infinity\n\nStandardInput=null\nStandardOutput=syslog\nStandardError=syslog\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\n</pre></div> <p>For more information on systemd, see the <a href=\"http://www.freedesktop.org/software/systemd/man/systemd.unit.html\">systemd reference (man page)</a>.</p> <h3 id=\"run-your-app-in-a-cluster\">Run your app in a cluster</h3> <p>In a multi-core system, you can increase the performance of a Node app by many times by launching a cluster of processes. A cluster runs multiple instances of the app, ideally one instance on each CPU core, thereby distributing the load and tasks among the instances.</p> <p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAb4AAACQCAMAAABAgv4pAAAC5VBMVEVHcEz5+fny8vLc3NwAAAD9/f3o6Oj///////////+rq6vOzs5lZWWEhIS+vr5zc3OWlpb4+Pnx8fH+/v7n5+ejo6P6+vq9vb10dHSXl5f49/ebm5uamprz8/Ompqb09PTp6en8/Pzs7Owtic37+/zNkUHf39/29vaQze/h4eHExMT/987v7+/m5ubT09OkpKTr6+u8vLzz0pnX19fHx8dBAADt7e36//+oqKjBwcHk4+MAAC7l5eXPz8+2trYAAE+cnJyOjo7Z2Nn///jNzc3y//+srKwALpGwsLCxsbGYmJj58ezb29v/8s3z0pGzs7OqqqrR9/9PAACurq6VQQDR0dH+/N6enp4AAEGt3vl5eXmlyuTx+//326/w8PDI8v/v7u6ysrLLy8sAAIXu///yzJDN8v///+gAAHIBAQEAAJEuAADq7vXV1dXT8v+Y0vK97P////H96sMAAFz54bZJk9Dq//+QlZP69/Kr0emGhoZcAADi//3SmFOnXwAGXohBAEH41566urpsbGx+fn6JiYloaGihoaFzAAD/+9EAbLTS7vufdEmEyO1Th7pmAABycnKFhYWDg4P/++3Q4fDj5er/99vUsYtjl8S0jWHw8vpWcJXounj/8tXVn0+RXABnosx2LgAukc2R0vNPmc7N6vsAT57Xq3m0iU/c0sXLiTbhwpzIwp5miZ/myZa30NcALnDSmEFwrtkALomxej8AQZiCAAAAQVDo++j/9+Dqv4Wv1+v93qVBgqh5wubcqGGCT1X3/+5LZpitn3GRpL5Kdqr57t/e6vNAAACTLgDq0aXr+/5gQQC+4PW7tsOJXFyCXC7y5dy/5fgALlkMT4bd+//Nws2JXC58t8ulTwDKpGaCQQDSvZHl173R59XN+//l+//IggBPQXmCTwAALpiJq8LSwrfN3NxwQXBBLnClkZiYZkHx//UAAGZwXAD29820dAAtLS1aWlqCwOqfvcLq5erSyNLKxKDOAAAACXRSTlMA////////fz+X5cEvAAALw0lEQVR42uydeVwTZxrHDXmgO1ix4QiKjTNACLcBDGASwtmAcioQVJArSEVYUMGbeuF93/Wod6221tpLetp2a+tVex+7bXfbvbq3u922u/v3vjNJkGAYkzAZG/v8Pp/AwLzJb+b9ZpLM5H2f37BhKBQKhXJDP7sH5bUaNuweCuW1QnyID4X4UIgP8aEQHwrxoe4ufEGcfD0q1gHxeQaeb7hSTiTzkCQSuVypDCcMEZ/w8Ag7WVg0rfDx8Qn0iHwUCpoOk8gJwSDEJyw+33B5GK2oa4hIYhi/YE/Ij2GS0hrqfGiZXOmL+ASnp6gDMVRHh3kLP+/Bx9JjQAQrYBIIv3DEJyQ9pYxOYHSi4NMRfjLvOPy8Bp88ui5JVywKvmIdE0jLEZ+A+MJlirQMqUkUfCZpRoRCFo74hMOnDAtkVO0aUfBpxqmYurDwIMQnGD45nZBYbNCKgk9rkCY20ErEJyS+CN14c7Io+HrM42PTEJ+A8pUrImLHaTJFwZepaY9NoiWITzh8Eh9GNS6uURR8jXEmFeOD+ATGZ9JWiIKvQmtAfILjkxoC8kXBlx9gkCI+gfH5SYeLhM8/YLjUD/EJiU8WGEzw+dvhy2MyrnsEXyjBFyjzRXyexFfbDQD7jfHdc+yaXh6e7tRD7v7lDMR35/DNb1uxJ3AfHCu5GmPXtLTJOXwbYQriu2P48v7d9BD59eWlb6/GrLpopMit80PoWlKbCpeMte/Cxc1U7SNvZT1IUVUf5Bz/5D9bYEUHtS8VPv2Y2n0A4FjVr+GZjpe3wIs1tnaIT0R88yoXcJdjqPirMc2tM6nm1htfnFKd1399oKums+21J44/vzAFst4mb44l5XoW3tnyExfgWPHRU+mHsp7+Dby+T/+nlyqfefpxmG5th/hExRdpWSD4SluNVGnrjWubruz+34xV36QvIwfmfIJFP5drUP4DtWraFOpM5OX3jYujCmYe6Xo1/Yk9G1f+dhVMp2a9cNLaDvGJie/aCfbXV29/a8NnPJcK+v1GsrCMG/MQkzKNe0mMT42h2MWoyMNbyL97jYf/CPDIY/Er61O4dgus7RCfqO99LeS9L295L4uvaSZ1qOBG7oyP3oI5BF9UwfWDl9+/fgu+I13vpR8qMH50pejs9sj4lVOa9R8XLf7zHsR3Jz55woo9RQfgB/a9D2pKunuruk9SnW1zmps6XtEvyYvKmpIyrf4mvnqCb1nLZ50behf+vuB385ZHlqQuKSnfn/4ObLW2Q3yinve9U05e+T6n4rsfnXUU4N1e42ny98WFtVBw43GyVEOlZHGnBuyJIbsYFUk+lcJIWDCf3LHrvarj+vpzpN22dGs7xCf2VZe91jPvvKSD7K8i1RXyM0xOlhiH5+S7/zuDKlJSebF7yblhnoyiFu89iOd9dwifh4T4EB/iQ3yID/EhPsSH+BAf4kN8iA/xIT7E95PC5yc1iIUvAPEJjE/scZ44UFBofDjK2nvxyRUEX9wk8eY4KBCfcAqyzTASQ5YZRnLEJyA+Ok2Xa+7xz86B6pGr1907qOBeXvGtXrd6B+zKyfbvMefq0hCfkPiUdAM7u7ZMXQhL11SPGlwwile8q6vXQE6hukxrKM5oiMbpmULii2bntpuTJ6rhvpy1S0cMKhjBK57VO5euzYFs9cRQTTs7tx3xCYjPWllCk1wG6qnZhYWjBxOM5hXf6sLs9TC5LFnDVZaQYGkCAfH5Ssjhpys2abSQOaki339QgT+v+FbnVzRCj1ZjKtYxddFyLAwi6KtnGF1H+LUbQBOnDQgIHUwQyiue1QEB2jgwG9qlsVxVpSDEJ+SrpySMTmASVdLZ7SaDYfigmj2cV3yrDSYT5BarMpISFGHycMQnOL+6CCYDYlUq6eACKa94V6tUoEv0iwikvYWeV9XzlMhoRWACJDF+PAI/P7dXMwykNdQpogk9X8QnMD+umm40DbQPXzld4C+Yy7fax0cBNB0mkyh9vaQaq1eVIicAw8OVICEavB418JerBr5K1hIJWGpZe02XeFkQQFBQEPAXkwf+QvH8q7kH96b+8L4ch74vHWY7vN48m//et7kTeFlniI1v9pC/D/BEV4MHNu+uxAf4UIgP8SE+xId9jvjwobzokyc+FB59ePQhPsSHff4jw+fZgEr2iqVgTuBsCObtnUCguE3LJVkRgz3742PTKcPZdEq5xEOSy0Gp5DZEACfgd5K74ARD2ic7J/Bk71mcHOLrS6ekuS/UPCGFgoboMJmM7KEATsDvRLvgBEPaJzsn8GTvsU5230b24SP05Ny32WkRDOPnETFMUtJ3CYE+pDNpxdCdvud3SnPB6fsh7ZOd03ee7D3ipIiWycN9B+ILsowlEWUOQVpDQkIaOg0h27OPXx8+Nls0QZx0ysTg4OAMdHLTyW4cXB8+EdMpi1UqlRSd3HTiRqEOwMemUwaKlU45rn18uwmd3H2i6JjAaFu2pw2fUqZI04mUTqkxm80adHLTyVTMZXsG2eMTMZ0yNC5OG4pO7j5R2vtle9rwiZlOmdmT3FOGTm462WV73sQXwc5eFadyQ1lmWT46uenUYx5/c+6vFR+XTtkuUjrlhIpJE8eik7vHef9sz5v4xKvcEDI5f/J6dHLTya7uhQ2fmHVTpk6YPHYqOrnpZFd1ph8+0aoWZasnqLPRyd132f41n+4MvrGiderd52SX7WnD57BiX1HGzz2xAfeHjA0Zg07u4utf75AHXxUb2LRiMxUVaXf/QVMn+6u0wOjCrqKTC05O4ptVmVXj89WGgpkDNmDQ1Em7DWh1YVfRyRUnJ/E1w3Tys/ZvHVGRD/9iOkVuA1Mnqz5YVB5DmvyhI+/8tvSSvz7Y+SF8YgmjPNtqrPrHtnRLiuXpp44u4NtVdHLFyUl8UQUzrQuRJakxFLkNTJ0sKYenHuMSujZ2tzzU3PLShk//cgBeZcMoz33zZmVLhzXFchmsWMK3q+jkipOT+J5t7dsANkKN3AamTsaXP8euz/tiwQXQzz2zKUVfT827FsmGUaZk/atlCmVNsXy218j7QoNOrjg5ie9I00Ly8+W/b7ZuQHnMwNTJ+NRHuZZvnPrytaOfV77OpiDmLT/BphmSFv8kG2BJsRzw8n/LrqKTK05O4lsFbB76If1c9vDfyj5/BqZOstvFaj60bX1Dn1Xf3PUZlVfJbUBpy9cbNqVbUyxvt6vo5IqT0588p9UsfrKNPExk1faTb56HmIGpk7YNmPWCfu4FOGXsbHsu/UmYw4ZRlhakvwIx1hTL2+0qOrni5Ox53+FfkWP30nX2zOU0wIswZ2DqZHy35fCnzjy/8OHtxyhqH/n3fi6Mkpy5zFve9JAlxfJ2u4pOrjg5i4+iGvquGxRxC/ypk2yz2AEXGhylWDq6QoFOTjs5j89DV+0c7Co6CX7RDDsV8SE+xIdOiA/xYaciPsSH+BAf4kN82Kk/Dnw40sxbnByONMNxnt7iNNg4Txxl7RVODkdZ4xwHb3FyOMfBNsNIDFlm46DTULI9JQ7n9/ln5+yq3sGXTjkErVu9o3pXTmEINxcupBCd3HBisz1vnd9nm11bpi7M4dIpR3pAo6rX7MwZvd6fm4nqvx6dXHcqVDc6nF1rndueXKEesyhn7c4RntDStTmLxoTkZ3LzwDPz0cl1J/XEHodz262VJTTJjf7qqWMK7/OARhfeP1U9eVKPlqvCoO2ZhE4uOzUmaxxWlrDWdTGZtcmZjRX5+f4eUH5FY2ayVvMAVwPlAQ06ueNkclTXxVZVSdpuMGvitNoAj0gbpzEb2nO5CkS56OSWk9RRVSVbTbMMdht40yndl8FgMo3LlapiufpfsejkllOG45pmloqCaUywLlbFG085BKlUsbpEJomrvvf/du7QBmAYhoIoLo5UWikTBHX/0UoLjCrHUuV3C3xw7INblj4tzbAoWNXzvPN6nj2X4p5nVU33yqvpNl2Ka7pHTcv6zGtZt116PaDVJfkxLG0qyeN30Ecf6AN99IE+0Af66AN92MEDqrytJJPzilwAAAAASUVORK5CYII=\" alt=\"Balancing between application instances using the cluster API\"></p> <p>IMPORTANT: Since the app instances run as separate processes, they do not share the same memory space. That is, objects are local to each instance of the app. Therefore, you cannot maintain state in the application code. However, you can use an in-memory datastore like <a href=\"http://redis.io/\">Redis</a> to store session-related data and state. This caveat applies to essentially all forms of horizontal scaling, whether clustering with multiple processes or multiple physical servers.</p> <p>In clustered apps, worker processes can crash individually without affecting the rest of the processes. Apart from performance advantages, failure isolation is another reason to run a cluster of app processes. Whenever a worker process crashes, always make sure to log the event and spawn a new process using cluster.fork().</p> <h4 id=\"using-nodes-cluster-module\">Using Node’s cluster module</h4> <p>Clustering is made possible with Node’s <a href=\"https://nodejs.org/api/cluster.html\">cluster module</a>. This enables a master process to spawn worker processes and distribute incoming connections among the workers.</p> <h4 id=\"using-pm2\">Using PM2</h4> <p>If you deploy your application with PM2, then you can take advantage of clustering <em>without</em> modifying your application code. You should ensure your <a href=\"https://pm2.keymetrics.io/docs/usage/specifics/#stateless-apps\">application is stateless</a> first, meaning no local data is stored in the process (such as sessions, websocket connections and the like).</p> <p>When running an application with PM2, you can enable <strong>cluster mode</strong> to run it in a cluster with a number of instances of your choosing, such as the matching the number of available CPUs on the machine. You can manually change the number of processes in the cluster using the <code class=\"language-plaintext highlighter-rouge\">pm2</code> command line tool without stopping the app.</p> <p>To enable cluster mode, start your application like so:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\"># Start 4 worker processes\n$ pm2 start npm --name my-app -i 4 -- start\n# Auto-detect number of available CPUs and start that many worker processes\n$ pm2 start npm --name my-app -i max -- start\n</pre></div> <p>This can also be configured within a PM2 process file (<code class=\"language-plaintext highlighter-rouge\">ecosystem.config.js</code> or similar) by setting <code class=\"language-plaintext highlighter-rouge\">exec_mode</code> to <code class=\"language-plaintext highlighter-rouge\">cluster</code> and <code class=\"language-plaintext highlighter-rouge\">instances</code> to the number of workers to start.</p> <p>Once running, the application can be scaled like so:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\"># Add 3 more workers\n$ pm2 scale my-app +3\n# Scale to a specific number of workers\n$ pm2 scale my-app 2\n</pre></div> <p>For more information on clustering with PM2, see <a href=\"https://pm2.keymetrics.io/docs/usage/cluster-mode/\">Cluster Mode</a> in the PM2 documentation.</p> <h3 id=\"cache-request-results\">Cache request results</h3> <p>Another strategy to improve the performance in production is to cache the result of requests, so that your app does not repeat the operation to serve the same request repeatedly.</p> <p>Use a caching server like <a href=\"https://www.varnish-cache.org/\">Varnish</a> or <a href=\"https://blog.nginx.org/blog/nginx-caching-guide\">Nginx</a> (see also <a href=\"https://serversforhackers.com/nginx-caching/\">Nginx Caching</a>) to greatly improve the speed and performance of your app.</p> <h3 id=\"use-a-load-balancer\">Use a load balancer</h3> <p>No matter how optimized an app is, a single instance can handle only a limited amount of load and traffic. One way to scale an app is to run multiple instances of it and distribute the traffic via a load balancer. Setting up a load balancer can improve your app’s performance and speed, and enable it to scale more than is possible with a single instance.</p> <p>A load balancer is usually a reverse proxy that orchestrates traffic to and from multiple application instances and servers. You can easily set up a load balancer for your app by using <a href=\"https://nginx.org/en/docs/http/load_balancing.html\">Nginx</a> or <a href=\"https://www.digitalocean.com/community/tutorials/an-introduction-to-haproxy-and-load-balancing-concepts\">HAProxy</a>.</p> <p>With load balancing, you might have to ensure that requests that are associated with a particular session ID connect to the process that originated them. This is known as <em>session affinity</em>, or <em>sticky sessions</em>, and may be addressed by the suggestion above to use a data store such as Redis for session data (depending on your application). For a discussion, see <a href=\"https://socket.io/docs/v4/using-multiple-nodes/\">Using multiple nodes</a>.</p> <h3 id=\"use-a-reverse-proxy\">Use a reverse proxy</h3> <p>A reverse proxy sits in front of a web app and performs supporting operations on the requests, apart from directing requests to the app. It can handle error pages, compression, caching, serving files, and load balancing among other things.</p> <p>Handing over tasks that do not require knowledge of application state to a reverse proxy frees up Express to perform specialized application tasks. For this reason, it is recommended to run Express behind a reverse proxy like <a href=\"https://www.nginx.org/\">Nginx</a> or <a href=\"https://www.haproxy.org/\">HAProxy</a> in production.</p>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/advanced/best-practice-performance.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/advanced/best-practice-performance.html\" class=\"_attribution-link\">https://expressjs.com/en/advanced/best-practice-performance.html</a>\n  </p>\n</div>\n","guide/using-middleware":"<main> <h1 id=\"using-middleware\" data-level=\"3\">Using middleware</h1> <p>Express is a routing and middleware web framework that has minimal functionality of its own: An Express application is essentially a series of middleware function calls.</p> <p><em>Middleware</em> functions are functions that have access to the <a href=\"../5x/api#req\">request object</a> (<code class=\"language-plaintext highlighter-rouge\">req</code>), the <a href=\"../5x/api#res\">response object</a> (<code class=\"language-plaintext highlighter-rouge\">res</code>), and the next middleware function in the application’s request-response cycle. The next middleware function is commonly denoted by a variable named <code class=\"language-plaintext highlighter-rouge\">next</code>.</p> <p>Middleware functions can perform the following tasks:</p> <ul> <li>Execute any code.</li> <li>Make changes to the request and the response objects.</li> <li>End the request-response cycle.</li> <li>Call the next middleware function in the stack.</li> </ul> <p>If the current middleware function does not end the request-response cycle, it must call <code class=\"language-plaintext highlighter-rouge\">next()</code> to pass control to the next middleware function. Otherwise, the request will be left hanging.</p> <p>An Express application can use the following types of middleware:</p> <ul> <li><a href=\"#middleware.application\">Application-level middleware</a></li> <li><a href=\"#middleware.router\">Router-level middleware</a></li> <li><a href=\"#middleware.error-handling\">Error-handling middleware</a></li> <li><a href=\"#middleware.built-in\">Built-in middleware</a></li> <li><a href=\"#middleware.third-party\">Third-party middleware</a></li> </ul> <p>You can load application-level and router-level middleware with an optional mount path. You can also load a series of middleware functions together, which creates a sub-stack of the middleware system at a mount point.</p> <h2 id=\"middleware.application\">Application-level middleware</h2> <p>Bind application-level middleware to an instance of the <a href=\"../5x/api#app\">app object</a> by using the <code class=\"language-plaintext highlighter-rouge\">app.use()</code> and <code class=\"language-plaintext highlighter-rouge\">app.METHOD()</code> functions, where <code class=\"language-plaintext highlighter-rouge\">METHOD</code> is the HTTP method of the request that the middleware function handles (such as GET, PUT, or POST) in lowercase.</p> <p>This example shows a middleware function with no mount path. The function is executed every time the app receives a request.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst app = express()\n\napp.use((req, res, next) =&gt; {\n  console.log('Time:', Date.now())\n  next()\n})\n</pre></div> <p>This example shows a middleware function mounted on the <code class=\"language-plaintext highlighter-rouge\">/user/:id</code> path. The function is executed for any type of HTTP request on the <code class=\"language-plaintext highlighter-rouge\">/user/:id</code> path.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use('/user/:id', (req, res, next) =&gt; {\n  console.log('Request Type:', req.method)\n  next()\n})\n</pre></div> <p>This example shows a route and its handler function (middleware system). The function handles GET requests to the <code class=\"language-plaintext highlighter-rouge\">/user/:id</code> path.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/user/:id', (req, res, next) =&gt; {\n  res.send('USER')\n})\n</pre></div> <p>Here is an example of loading a series of middleware functions at a mount point, with a mount path. It illustrates a middleware sub-stack that prints request info for any type of HTTP request to the <code class=\"language-plaintext highlighter-rouge\">/user/:id</code> path.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use('/user/:id', (req, res, next) =&gt; {\n  console.log('Request URL:', req.originalUrl)\n  next()\n}, (req, res, next) =&gt; {\n  console.log('Request Type:', req.method)\n  next()\n})\n</pre></div> <p>Route handlers enable you to define multiple routes for a path. The example below defines two routes for GET requests to the <code class=\"language-plaintext highlighter-rouge\">/user/:id</code> path. The second route will not cause any problems, but it will never get called because the first route ends the request-response cycle.</p> <p>This example shows a middleware sub-stack that handles GET requests to the <code class=\"language-plaintext highlighter-rouge\">/user/:id</code> path.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/user/:id', (req, res, next) =&gt; {\n  console.log('ID:', req.params.id)\n  next()\n}, (req, res, next) =&gt; {\n  res.send('User Info')\n})\n\n// handler for the /user/:id path, which prints the user ID\napp.get('/user/:id', (req, res, next) =&gt; {\n  res.send(req.params.id)\n})\n</pre></div> <p>To skip the rest of the middleware functions from a router middleware stack, call <code class=\"language-plaintext highlighter-rouge\">next('route')</code> to pass control to the next route.</p> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p><code class=\"language-plaintext highlighter-rouge\">next('route')</code> will work only in middleware functions that were loaded by using the <code class=\"language-plaintext highlighter-rouge\">app.METHOD()</code> or <code class=\"language-plaintext highlighter-rouge\">router.METHOD()</code> functions.</p> </div> <p>This example shows a middleware sub-stack that handles GET requests to the <code class=\"language-plaintext highlighter-rouge\">/user/:id</code> path.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/user/:id', (req, res, next) =&gt; {\n  // if the user ID is 0, skip to the next route\n  if (req.params.id === '0') next('route')\n  // otherwise pass the control to the next middleware function in this stack\n  else next()\n}, (req, res, next) =&gt; {\n  // send a regular response\n  res.send('regular')\n})\n\n// handler for the /user/:id path, which sends a special response\napp.get('/user/:id', (req, res, next) =&gt; {\n  res.send('special')\n})\n</pre></div> <p>Middleware can also be declared in an array for reusability.</p> <p>This example shows an array with a middleware sub-stack that handles GET requests to the <code class=\"language-plaintext highlighter-rouge\">/user/:id</code> path</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">function logOriginalUrl (req, res, next) {\n  console.log('Request URL:', req.originalUrl)\n  next()\n}\n\nfunction logMethod (req, res, next) {\n  console.log('Request Type:', req.method)\n  next()\n}\n\nconst logStuff = [logOriginalUrl, logMethod]\napp.get('/user/:id', logStuff, (req, res, next) =&gt; {\n  res.send('User Info')\n})\n</pre></div> <h2 id=\"middleware.router\">Router-level middleware</h2> <p>Router-level middleware works in the same way as application-level middleware, except it is bound to an instance of <code class=\"language-plaintext highlighter-rouge\">express.Router()</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const router = express.Router()\n</pre></div> <p>Load router-level middleware by using the <code class=\"language-plaintext highlighter-rouge\">router.use()</code> and <code class=\"language-plaintext highlighter-rouge\">router.METHOD()</code> functions.</p> <p>The following example code replicates the middleware system that is shown above for application-level middleware, by using router-level middleware:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst app = express()\nconst router = express.Router()\n\n// a middleware function with no mount path. This code is executed for every request to the router\nrouter.use((req, res, next) =&gt; {\n  console.log('Time:', Date.now())\n  next()\n})\n\n// a middleware sub-stack shows request info for any type of HTTP request to the /user/:id path\nrouter.use('/user/:id', (req, res, next) =&gt; {\n  console.log('Request URL:', req.originalUrl)\n  next()\n}, (req, res, next) =&gt; {\n  console.log('Request Type:', req.method)\n  next()\n})\n\n// a middleware sub-stack that handles GET requests to the /user/:id path\nrouter.get('/user/:id', (req, res, next) =&gt; {\n  // if the user ID is 0, skip to the next router\n  if (req.params.id === '0') next('route')\n  // otherwise pass control to the next middleware function in this stack\n  else next()\n}, (req, res, next) =&gt; {\n  // render a regular page\n  res.render('regular')\n})\n\n// handler for the /user/:id path, which renders a special page\nrouter.get('/user/:id', (req, res, next) =&gt; {\n  console.log(req.params.id)\n  res.render('special')\n})\n\n// mount the router on the app\napp.use('/', router)\n</pre></div> <p>To skip the rest of the router’s middleware functions, call <code class=\"language-plaintext highlighter-rouge\">next('router')</code> to pass control back out of the router instance.</p> <p>This example shows a middleware sub-stack that handles GET requests to the <code class=\"language-plaintext highlighter-rouge\">/user/:id</code> path.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst app = express()\nconst router = express.Router()\n\n// predicate the router with a check and bail out when needed\nrouter.use((req, res, next) =&gt; {\n  if (!req.headers['x-auth']) return next('router')\n  next()\n})\n\nrouter.get('/user/:id', (req, res) =&gt; {\n  res.send('hello, user!')\n})\n\n// use the router and 401 anything falling through\napp.use('/admin', router, (req, res) =&gt; {\n  res.sendStatus(401)\n})\n</pre></div> <h2 id=\"middleware.error-handling\">Error-handling middleware</h2> <div class=\"doc-box doc-notice\"> <p>Error-handling middleware always takes <em>four</em> arguments. You must provide four arguments to identify it as an error-handling middleware function. Even if you don’t need to use the <code class=\"language-plaintext highlighter-rouge\">next</code> object, you must specify it to maintain the signature. Otherwise, the <code class=\"language-plaintext highlighter-rouge\">next</code> object will be interpreted as regular middleware and will fail to handle errors.</p> </div> <p>Define error-handling middleware functions in the same way as other middleware functions, except with four arguments instead of three, specifically with the signature <code class=\"language-plaintext highlighter-rouge\">(err, req, res, next)</code>:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.use((err, req, res, next) =&gt; {\n  console.error(err.stack)\n  res.status(500).send('Something broke!')\n})\n</pre></div> <p>For details about error-handling middleware, see: <a href=\"error-handling\">Error handling</a>.</p> <h2 id=\"middleware.built-in\">Built-in middleware</h2> <p>Starting with version 4.x, Express no longer depends on <a href=\"https://github.com/senchalabs/connect\">Connect</a>. The middleware functions that were previously included with Express are now in separate modules; see <a href=\"https://github.com/senchalabs/connect#middleware\">the list of middleware functions</a>.</p> <p>Express has the following built-in middleware functions:</p> <ul> <li>\n<a href=\"../5x/api#express.static\">express.static</a> serves static assets such as HTML files, images, and so on.</li> <li>\n<a href=\"../5x/api#express.json\">express.json</a> parses incoming requests with JSON payloads. <strong>NOTE: Available with Express 4.16.0+</strong>\n</li> <li>\n<a href=\"../5x/api#express.urlencoded\">express.urlencoded</a> parses incoming requests with URL-encoded payloads. <strong>NOTE: Available with Express 4.16.0+</strong>\n</li> </ul> <h2 id=\"middleware.third-party\">Third-party middleware</h2> <p>Use third-party middleware to add functionality to Express apps.</p> <p>Install the Node.js module for the required functionality, then load it in your app at the application level or at the router level.</p> <p>The following example illustrates installing and loading the cookie-parsing middleware function <code class=\"language-plaintext highlighter-rouge\">cookie-parser</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install cookie-parser\n</pre></div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst app = express()\nconst cookieParser = require('cookie-parser')\n\n// load the cookie-parsing middleware\napp.use(cookieParser())\n</pre></div> <p>For a partial list of third-party middleware functions that are commonly used with Express, see: <a href=\"https://expressjs.com/en/resources/middleware.html\">Third-party middleware</a>.</p>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/guide/using-middleware.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/guide/using-middleware.html\" class=\"_attribution-link\">https://expressjs.com/en/guide/using-middleware.html</a>\n  </p>\n</div>\n","guide/debugging":"<main> <h1 id=\"debugging-express\" data-level=\"7\">Debugging Express</h1> <p>To see all the internal logs used in Express, set the <code class=\"language-plaintext highlighter-rouge\">DEBUG</code> environment variable to <code class=\"language-plaintext highlighter-rouge\">express:*</code> when launching your app.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ DEBUG=express:* node index.js\n</pre></div> <p>On Windows, use the corresponding command.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">&gt; $env:DEBUG = \"express:*\"; node index.js\n</pre></div> <p>Running this command on the default app generated by the <a href=\"../starter/generator\">express generator</a> prints the following output:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ DEBUG=express:* node ./bin/www\n  express:router:route new / +0ms\n  express:router:layer new / +1ms\n  express:router:route get / +1ms\n  express:router:layer new / +0ms\n  express:router:route new / +1ms\n  express:router:layer new / +0ms\n  express:router:route get / +0ms\n  express:router:layer new / +0ms\n  express:application compile etag weak +1ms\n  express:application compile query parser extended +0ms\n  express:application compile trust proxy false +0ms\n  express:application booting in development mode +1ms\n  express:router use / query +0ms\n  express:router:layer new / +0ms\n  express:router use / expressInit +0ms\n  express:router:layer new / +0ms\n  express:router use / favicon +1ms\n  express:router:layer new / +0ms\n  express:router use / logger +0ms\n  express:router:layer new / +0ms\n  express:router use / jsonParser +0ms\n  express:router:layer new / +1ms\n  express:router use / urlencodedParser +0ms\n  express:router:layer new / +0ms\n  express:router use / cookieParser +0ms\n  express:router:layer new / +0ms\n  express:router use / stylus +90ms\n  express:router:layer new / +0ms\n  express:router use / serveStatic +0ms\n  express:router:layer new / +0ms\n  express:router use / router +0ms\n  express:router:layer new / +1ms\n  express:router use /users router +0ms\n  express:router:layer new /users +0ms\n  express:router use / &amp;lt;anonymous&amp;gt; +0ms\n  express:router:layer new / +0ms\n  express:router use / &amp;lt;anonymous&amp;gt; +0ms\n  express:router:layer new / +0ms\n  express:router use / &amp;lt;anonymous&amp;gt; +0ms\n  express:router:layer new / +0ms\n</pre></div> <p>When a request is then made to the app, you will see the logs specified in the Express code:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">  express:router dispatching GET / +4h\n  express:router query  : / +2ms\n  express:router expressInit  : / +0ms\n  express:router favicon  : / +0ms\n  express:router logger  : / +1ms\n  express:router jsonParser  : / +0ms\n  express:router urlencodedParser  : / +1ms\n  express:router cookieParser  : / +0ms\n  express:router stylus  : / +0ms\n  express:router serveStatic  : / +2ms\n  express:router router  : / +2ms\n  express:router dispatching GET / +1ms\n  express:view lookup \"index.pug\" +338ms\n  express:view stat \"/projects/example/views/index.pug\" +0ms\n  express:view render \"/projects/example/views/index.pug\" +1ms\n</pre></div> <p>To see the logs only from the router implementation, set the value of <code class=\"language-plaintext highlighter-rouge\">DEBUG</code> to <code class=\"language-plaintext highlighter-rouge\">express:router</code>. Likewise, to see logs only from the application implementation, set the value of <code class=\"language-plaintext highlighter-rouge\">DEBUG</code> to <code class=\"language-plaintext highlighter-rouge\">express:application</code>, and so on.</p> <h2 id=\"applications-generated-by-express\">Applications generated by <code class=\"language-plaintext highlighter-rouge\">express</code>\n</h2> <p>An application generated by the <code class=\"language-plaintext highlighter-rouge\">express</code> command uses the <code class=\"language-plaintext highlighter-rouge\">debug</code> module and its debug namespace is scoped to the name of the application.</p> <p>For example, if you generated the app with <code class=\"language-plaintext highlighter-rouge\">$ express sample-app</code>, you can enable the debug statements with the following command:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ DEBUG=sample-app:* node ./bin/www\n</pre></div> <p>You can specify more than one debug namespace by assigning a comma-separated list of names:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ DEBUG=http,mail,express:* node index.js\n</pre></div> <h2 id=\"advanced-options\">Advanced options</h2> <p>When running through Node.js, you can set a few environment variables that will change the behavior of the debug logging:</p> <table> <thead> <tr> <th>Name</th> <th>Purpose</th> </tr> </thead> <tbody> <tr> <td><code class=\"language-plaintext highlighter-rouge\">DEBUG</code></td> <td>Enables/disables specific debugging namespaces.</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">DEBUG_COLORS</code></td> <td>Whether or not to use colors in the debug output.</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">DEBUG_DEPTH</code></td> <td>Object inspection depth.</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">DEBUG_FD</code></td> <td>File descriptor to write debug output to.</td> </tr> <tr> <td><code class=\"language-plaintext highlighter-rouge\">DEBUG_SHOW_HIDDEN</code></td> <td>Shows hidden properties on inspected objects.</td> </tr> </tbody> </table> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>The environment variables beginning with <code class=\"language-plaintext highlighter-rouge\">DEBUG_</code> end up being converted into an Options object that gets used with <code class=\"language-plaintext highlighter-rouge\">%o</code>/<code class=\"language-plaintext highlighter-rouge\">%O</code> formatters. See the Node.js documentation for <a href=\"https://nodejs.org/api/util.html#util_util_inspect_object_options\"><code class=\"language-plaintext highlighter-rouge\">util.inspect()</code></a> for the complete list.</p> </div>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/guide/debugging.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/guide/debugging.html\" class=\"_attribution-link\">https://expressjs.com/en/guide/debugging.html</a>\n  </p>\n</div>\n","guide/routing":"<main> <h1 id=\"routing\" data-level=\"1\">Routing</h1> <p><em>Routing</em> refers to how an application’s endpoints (URIs) respond to client requests. For an introduction to routing, see <a href=\"../starter/basic-routing\">Basic routing</a>.</p> <p>You define routing using methods of the Express <code class=\"language-plaintext highlighter-rouge\">app</code> object that correspond to HTTP methods; for example, <code class=\"language-plaintext highlighter-rouge\">app.get()</code> to handle GET requests and <code class=\"language-plaintext highlighter-rouge\">app.post</code> to handle POST requests. For a full list, see <a href=\"../5x/api#app.METHOD\">app.METHOD</a>. You can also use <a href=\"../5x/api#app.all\">app.all()</a> to handle all HTTP methods and <a href=\"../5x/api#app.use\">app.use()</a> to specify middleware as the callback function (See <a href=\"using-middleware\">Using middleware</a> for details).</p> <p>These routing methods specify a callback function (sometimes called “handler functions”) called when the application receives a request to the specified route (endpoint) and HTTP method. In other words, the application “listens” for requests that match the specified route(s) and method(s), and when it detects a match, it calls the specified callback function.</p> <p>In fact, the routing methods can have more than one callback function as arguments. With multiple callback functions, it is important to provide <code class=\"language-plaintext highlighter-rouge\">next</code> as an argument to the callback function and then call <code class=\"language-plaintext highlighter-rouge\">next()</code> within the body of the function to hand off control to the next callback.</p> <p>The following code is an example of a very basic route.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst app = express()\n\n// respond with \"hello world\" when a GET request is made to the homepage\napp.get('/', (req, res) =&gt; {\n  res.send('hello world')\n})\n</pre></div> <h2 id=\"route-methods\">Route methods</h2> <p>A route method is derived from one of the HTTP methods, and is attached to an instance of the <code class=\"language-plaintext highlighter-rouge\">express</code> class.</p> <p>The following code is an example of routes that are defined for the <code class=\"language-plaintext highlighter-rouge\">GET</code> and the <code class=\"language-plaintext highlighter-rouge\">POST</code> methods to the root of the app.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// GET method route\napp.get('/', (req, res) =&gt; {\n  res.send('GET request to the homepage')\n})\n\n// POST method route\napp.post('/', (req, res) =&gt; {\n  res.send('POST request to the homepage')\n})\n</pre></div> <p>Express supports methods that correspond to all HTTP request methods: <code class=\"language-plaintext highlighter-rouge\">get</code>, <code class=\"language-plaintext highlighter-rouge\">post</code>, and so on. For a full list, see <a href=\"../5x/api#app.METHOD\">app.METHOD</a>.</p> <p>There is a special routing method, <code class=\"language-plaintext highlighter-rouge\">app.all()</code>, used to load middleware functions at a path for <em>all</em> HTTP request methods. For example, the following handler is executed for requests to the route <code class=\"language-plaintext highlighter-rouge\">\"/secret\"</code> whether using <code class=\"language-plaintext highlighter-rouge\">GET</code>, <code class=\"language-plaintext highlighter-rouge\">POST</code>, <code class=\"language-plaintext highlighter-rouge\">PUT</code>, <code class=\"language-plaintext highlighter-rouge\">DELETE</code>, or any other HTTP request method supported in the <a href=\"https://nodejs.org/api/http.html#http_http_methods\">http module</a>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.all('/secret', (req, res, next) =&gt; {\n  console.log('Accessing the secret section ...')\n  next() // pass control to the next handler\n})\n</pre></div> <h2 id=\"route-paths\">Route paths</h2> <p>Route paths, in combination with a request method, define the endpoints at which requests can be made. Route paths can be strings, string patterns, or regular expressions.</p> <div class=\"doc-box doc-notice\"> <p class=\"doc-title\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z\"></path></svg> Caution</p> <p>In express 5, the characters <code class=\"language-plaintext highlighter-rouge\">?</code>, <code class=\"language-plaintext highlighter-rouge\">+</code>, <code class=\"language-plaintext highlighter-rouge\">*</code>, <code class=\"language-plaintext highlighter-rouge\">[]</code>, and <code class=\"language-plaintext highlighter-rouge\">()</code> are handled differently than in version 4, please review the <a href=\"migrating-5#path-syntax\">migration guide</a> for more information.</p> </div> <div class=\"doc-box doc-notice\"> <p class=\"doc-title\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z\"></path></svg> Caution</p> <p>In express 4, regular expression characters such as <code class=\"language-plaintext highlighter-rouge\">$</code> need to be escaped with a <code class=\"language-plaintext highlighter-rouge\">\\</code>.</p> </div> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>Express uses <a href=\"https://www.npmjs.com/package/path-to-regexp\">path-to-regexp</a> for matching the route paths; see the path-to-regexp documentation for all the possibilities in defining route paths. <a href=\"https://bjohansebas.github.io/playground-router/\">Express Playground Router</a> is a handy tool for testing basic Express routes, although it does not support pattern matching.</p> </div> <div class=\"doc-box doc-warn\"> <p class=\"doc-title\"><svg viewbox=\"0 0 24 24\" width=\"24\" height=\"24\" fill=\"currentColor\"><path d=\"M12 7C11.7348 7 11.4804 7.10536 11.2929 7.29289C11.1054 7.48043 11 7.73478 11 8V12C11 12.2652 11.1054 12.5196 11.2929 12.7071C11.4804 12.8946 11.7348 13 12 13C12.2652 13 12.5196 12.8946 12.7071 12.7071C12.8946 12.5196 13 12.2652 13 12V8C13 7.73478 12.8946 7.48043 12.7071 7.29289C12.5196 7.10536 12.2652 7 12 7ZM12 15C11.8022 15 11.6089 15.0586 11.4444 15.1685C11.28 15.2784 11.1518 15.4346 11.0761 15.6173C11.0004 15.8 10.9806 16.0011 11.0192 16.1951C11.0578 16.3891 11.153 16.5673 11.2929 16.7071C11.4327 16.847 11.6109 16.9422 11.8049 16.9808C11.9989 17.0194 12.2 16.9996 12.3827 16.9239C12.5654 16.8482 12.7216 16.72 12.8315 16.5556C12.9414 16.3911 13 16.1978 13 16C13 15.7348 12.8946 15.4804 12.7071 15.2929C12.5196 15.1054 12.2652 15 12 15ZM21.71 7.56L16.44 2.29C16.2484 2.10727 15.9948 2.00368 15.73 2H8.27C8.00523 2.00368 7.75163 2.10727 7.56 2.29L2.29 7.56C2.10727 7.75163 2.00368 8.00523 2 8.27V15.73C2.00368 15.9948 2.10727 16.2484 2.29 16.44L7.56 21.71C7.75163 21.8927 8.00523 21.9963 8.27 22H15.73C15.9948 21.9963 16.2484 21.8927 16.44 21.71L21.71 16.44C21.8927 16.2484 21.9963 15.9948 22 15.73V8.27C21.9963 8.00523 21.8927 7.75163 21.71 7.56ZM20 15.31L15.31 20H8.69L4 15.31V8.69L8.69 4H15.31L20 8.69V15.31Z\"></path></svg> Warning</p> <p>Query strings are not part of the route path.</p> </div> <h3 id=\"route-paths-based-on-strings\">Route paths based on strings</h3> <p>This route path will match requests to the root route, <code class=\"language-plaintext highlighter-rouge\">/</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/', (req, res) =&gt; {\n  res.send('root')\n})\n</pre></div> <p>This route path will match requests to <code class=\"language-plaintext highlighter-rouge\">/about</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/about', (req, res) =&gt; {\n  res.send('about')\n})\n</pre></div> <p>This route path will match requests to <code class=\"language-plaintext highlighter-rouge\">/random.text</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/random.text', (req, res) =&gt; {\n  res.send('random.text')\n})\n</pre></div> <h3 id=\"route-paths-based-on-string-patterns\">Route paths based on string patterns</h3> <div class=\"doc-box doc-notice\"> <p class=\"doc-title\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z\"></path></svg> Caution</p> <p>The string patterns in Express 5 no longer work. Please refer to the <a href=\"migrating-5#path-syntax\">migration guide</a> for more information.</p> </div> <p>This route path will match <code class=\"language-plaintext highlighter-rouge\">acd</code> and <code class=\"language-plaintext highlighter-rouge\">abcd</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/ab?cd', (req, res) =&gt; {\n  res.send('ab?cd')\n})\n</pre></div> <p>This route path will match <code class=\"language-plaintext highlighter-rouge\">abcd</code>, <code class=\"language-plaintext highlighter-rouge\">abbcd</code>, <code class=\"language-plaintext highlighter-rouge\">abbbcd</code>, and so on.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/ab+cd', (req, res) =&gt; {\n  res.send('ab+cd')\n})\n</pre></div> <p>This route path will match <code class=\"language-plaintext highlighter-rouge\">abcd</code>, <code class=\"language-plaintext highlighter-rouge\">abxcd</code>, <code class=\"language-plaintext highlighter-rouge\">abRANDOMcd</code>, <code class=\"language-plaintext highlighter-rouge\">ab123cd</code>, and so on.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/ab*cd', (req, res) =&gt; {\n  res.send('ab*cd')\n})\n</pre></div> <p>This route path will match <code class=\"language-plaintext highlighter-rouge\">/abe</code> and <code class=\"language-plaintext highlighter-rouge\">/abcde</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/ab(cd)?e', (req, res) =&gt; {\n  res.send('ab(cd)?e')\n})\n</pre></div> <h3 id=\"route-paths-based-on-regular-expressions\">Route paths based on regular expressions</h3> <p>This route path will match anything with an “a” in it.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get(/a/, (req, res) =&gt; {\n  res.send('/a/')\n})\n</pre></div> <p>This route path will match <code class=\"language-plaintext highlighter-rouge\">butterfly</code> and <code class=\"language-plaintext highlighter-rouge\">dragonfly</code>, but not <code class=\"language-plaintext highlighter-rouge\">butterflyman</code>, <code class=\"language-plaintext highlighter-rouge\">dragonflyman</code>, and so on.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get(/.*fly$/, (req, res) =&gt; {\n  res.send('/.*fly$/')\n})\n</pre></div> <h2 id=\"route-parameters\">Route parameters</h2> <p>Route parameters are named URL segments that are used to capture the values specified at their position in the URL. The captured values are populated in the <code class=\"language-plaintext highlighter-rouge\">req.params</code> object, with the name of the route parameter specified in the path as their respective keys.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">Route path: /users/:userId/books/:bookId\nRequest URL: http://localhost:3000/users/34/books/8989\nreq.params: { \"userId\": \"34\", \"bookId\": \"8989\" }\n</pre></div> <p>To define routes with route parameters, simply specify the route parameters in the path of the route as shown below.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/users/:userId/books/:bookId', (req, res) =&gt; {\n  res.send(req.params)\n})\n</pre></div> <div class=\"doc-box doc-notice\"> <p>The name of route parameters must be made up of “word characters” ([A-Za-z0-9_]).</p> </div> <p>Since the hyphen (<code class=\"language-plaintext highlighter-rouge\">-</code>) and the dot (<code class=\"language-plaintext highlighter-rouge\">.</code>) are interpreted literally, they can be used along with route parameters for useful purposes.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">Route path: /flights/:from-:to\nRequest URL: http://localhost:3000/flights/LAX-SFO\nreq.params: { \"from\": \"LAX\", \"to\": \"SFO\" }\n</pre></div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">Route path: /plantae/:genus.:species\nRequest URL: http://localhost:3000/plantae/Prunus.persica\nreq.params: { \"genus\": \"Prunus\", \"species\": \"persica\" }\n</pre></div> <div class=\"doc-box doc-notice\"> <p class=\"doc-title\"><svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z\"></path></svg> Caution</p> <p>In express 5, Regexp characters are not supported in route paths, for more information please refer to the <a href=\"migrating-5#path-syntax\">migration guide</a>.</p> </div> <p>To have more control over the exact string that can be matched by a route parameter, you can append a regular expression in parentheses (<code class=\"language-plaintext highlighter-rouge\">()</code>):</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">Route path: /user/:userId(\\d+)\nRequest URL: http://localhost:3000/user/42\nreq.params: {\"userId\": \"42\"}\n</pre></div> <div class=\"doc-box doc-warn\"> <p class=\"doc-title\"><svg viewbox=\"0 0 24 24\" width=\"24\" height=\"24\" fill=\"currentColor\"><path d=\"M12 7C11.7348 7 11.4804 7.10536 11.2929 7.29289C11.1054 7.48043 11 7.73478 11 8V12C11 12.2652 11.1054 12.5196 11.2929 12.7071C11.4804 12.8946 11.7348 13 12 13C12.2652 13 12.5196 12.8946 12.7071 12.7071C12.8946 12.5196 13 12.2652 13 12V8C13 7.73478 12.8946 7.48043 12.7071 7.29289C12.5196 7.10536 12.2652 7 12 7ZM12 15C11.8022 15 11.6089 15.0586 11.4444 15.1685C11.28 15.2784 11.1518 15.4346 11.0761 15.6173C11.0004 15.8 10.9806 16.0011 11.0192 16.1951C11.0578 16.3891 11.153 16.5673 11.2929 16.7071C11.4327 16.847 11.6109 16.9422 11.8049 16.9808C11.9989 17.0194 12.2 16.9996 12.3827 16.9239C12.5654 16.8482 12.7216 16.72 12.8315 16.5556C12.9414 16.3911 13 16.1978 13 16C13 15.7348 12.8946 15.4804 12.7071 15.2929C12.5196 15.1054 12.2652 15 12 15ZM21.71 7.56L16.44 2.29C16.2484 2.10727 15.9948 2.00368 15.73 2H8.27C8.00523 2.00368 7.75163 2.10727 7.56 2.29L2.29 7.56C2.10727 7.75163 2.00368 8.00523 2 8.27V15.73C2.00368 15.9948 2.10727 16.2484 2.29 16.44L7.56 21.71C7.75163 21.8927 8.00523 21.9963 8.27 22H15.73C15.9948 21.9963 16.2484 21.8927 16.44 21.71L21.71 16.44C21.8927 16.2484 21.9963 15.9948 22 15.73V8.27C21.9963 8.00523 21.8927 7.75163 21.71 7.56ZM20 15.31L15.31 20H8.69L4 15.31V8.69L8.69 4H15.31L20 8.69V15.31Z\"></path></svg> Warning</p> <p>Because the regular expression is usually part of a literal string, be sure to escape any <code class=\"language-plaintext highlighter-rouge\">\\</code> characters with an additional backslash, for example <code class=\"language-plaintext highlighter-rouge\">\\\\d+</code>.</p> </div> <div class=\"doc-box doc-warn\"> <p class=\"doc-title\"><svg viewbox=\"0 0 24 24\" width=\"24\" height=\"24\" fill=\"currentColor\"><path d=\"M12 7C11.7348 7 11.4804 7.10536 11.2929 7.29289C11.1054 7.48043 11 7.73478 11 8V12C11 12.2652 11.1054 12.5196 11.2929 12.7071C11.4804 12.8946 11.7348 13 12 13C12.2652 13 12.5196 12.8946 12.7071 12.7071C12.8946 12.5196 13 12.2652 13 12V8C13 7.73478 12.8946 7.48043 12.7071 7.29289C12.5196 7.10536 12.2652 7 12 7ZM12 15C11.8022 15 11.6089 15.0586 11.4444 15.1685C11.28 15.2784 11.1518 15.4346 11.0761 15.6173C11.0004 15.8 10.9806 16.0011 11.0192 16.1951C11.0578 16.3891 11.153 16.5673 11.2929 16.7071C11.4327 16.847 11.6109 16.9422 11.8049 16.9808C11.9989 17.0194 12.2 16.9996 12.3827 16.9239C12.5654 16.8482 12.7216 16.72 12.8315 16.5556C12.9414 16.3911 13 16.1978 13 16C13 15.7348 12.8946 15.4804 12.7071 15.2929C12.5196 15.1054 12.2652 15 12 15ZM21.71 7.56L16.44 2.29C16.2484 2.10727 15.9948 2.00368 15.73 2H8.27C8.00523 2.00368 7.75163 2.10727 7.56 2.29L2.29 7.56C2.10727 7.75163 2.00368 8.00523 2 8.27V15.73C2.00368 15.9948 2.10727 16.2484 2.29 16.44L7.56 21.71C7.75163 21.8927 8.00523 21.9963 8.27 22H15.73C15.9948 21.9963 16.2484 21.8927 16.44 21.71L21.71 16.44C21.8927 16.2484 21.9963 15.9948 22 15.73V8.27C21.9963 8.00523 21.8927 7.75163 21.71 7.56ZM20 15.31L15.31 20H8.69L4 15.31V8.69L8.69 4H15.31L20 8.69V15.31Z\"></path></svg> Warning</p> <p>In Express 4.x, <a href=\"https://github.com/expressjs/express/issues/2495\">the <code class=\"language-plaintext highlighter-rouge\">*</code> character in regular expressions is not interpreted in the usual way</a>. As a workaround, use <code class=\"language-plaintext highlighter-rouge\">{0,}</code> instead of <code class=\"language-plaintext highlighter-rouge\">*</code>. This will likely be fixed in Express 5.</p> </div> <h2 id=\"route-handlers\">Route handlers</h2> <p>You can provide multiple callback functions that behave like <a href=\"using-middleware\">middleware</a> to handle a request. The only exception is that these callbacks might invoke <code class=\"language-plaintext highlighter-rouge\">next('route')</code> to bypass the remaining route callbacks. You can use this mechanism to impose pre-conditions on a route, then pass control to subsequent routes if there’s no reason to proceed with the current route.</p> <p>Route handlers can be in the form of a function, an array of functions, or combinations of both, as shown in the following examples.</p> <p>A single callback function can handle a route. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/example/a', (req, res) =&gt; {\n  res.send('Hello from A!')\n})\n</pre></div> <p>More than one callback function can handle a route (make sure you specify the <code class=\"language-plaintext highlighter-rouge\">next</code> object). For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/example/b', (req, res, next) =&gt; {\n  console.log('the response will be sent by the next function ...')\n  next()\n}, (req, res) =&gt; {\n  res.send('Hello from B!')\n})\n</pre></div> <p>An array of callback functions can handle a route. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const cb0 = function (req, res, next) {\n  console.log('CB0')\n  next()\n}\n\nconst cb1 = function (req, res, next) {\n  console.log('CB1')\n  next()\n}\n\nconst cb2 = function (req, res) {\n  res.send('Hello from C!')\n}\n\napp.get('/example/c', [cb0, cb1, cb2])\n</pre></div> <p>A combination of independent functions and arrays of functions can handle a route. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const cb0 = function (req, res, next) {\n  console.log('CB0')\n  next()\n}\n\nconst cb1 = function (req, res, next) {\n  console.log('CB1')\n  next()\n}\n\napp.get('/example/d', [cb0, cb1], (req, res, next) =&gt; {\n  console.log('the response will be sent by the next function ...')\n  next()\n}, (req, res) =&gt; {\n  res.send('Hello from D!')\n})\n</pre></div> <h2 id=\"response-methods\">Response methods</h2> <p>The methods on the response object (<code class=\"language-plaintext highlighter-rouge\">res</code>) in the following table can send a response to the client, and terminate the request-response cycle. If none of these methods are called from a route handler, the client request will be left hanging.</p> <table> <thead> <tr> <th>Method</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><a href=\"../5x/api#res.download\">res.download()</a></td> <td>Prompt a file to be downloaded.</td> </tr> <tr> <td><a href=\"../5x/api#res.end\">res.end()</a></td> <td>End the response process.</td> </tr> <tr> <td><a href=\"../5x/api#res.json\">res.json()</a></td> <td>Send a JSON response.</td> </tr> <tr> <td><a href=\"../5x/api#res.jsonp\">res.jsonp()</a></td> <td>Send a JSON response with JSONP support.</td> </tr> <tr> <td><a href=\"../5x/api#res.redirect\">res.redirect()</a></td> <td>Redirect a request.</td> </tr> <tr> <td><a href=\"../5x/api#res.render\">res.render()</a></td> <td>Render a view template.</td> </tr> <tr> <td><a href=\"../5x/api#res.send\">res.send()</a></td> <td>Send a response of various types.</td> </tr> <tr> <td><a href=\"../5x/api#res.sendFile\">res.sendFile()</a></td> <td>Send a file as an octet stream.</td> </tr> <tr> <td><a href=\"../5x/api#res.sendStatus\">res.sendStatus()</a></td> <td>Set the response status code and send its string representation as the response body.</td> </tr> </tbody> </table> <h2 id=\"app-route\">app.route()</h2> <p>You can create chainable route handlers for a route path by using <code class=\"language-plaintext highlighter-rouge\">app.route()</code>. Because the path is specified at a single location, creating modular routes is helpful, as is reducing redundancy and typos. For more information about routes, see: <a href=\"../5x/api#router\">Router() documentation</a>.</p> <p>Here is an example of chained route handlers that are defined by using <code class=\"language-plaintext highlighter-rouge\">app.route()</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.route('/book')\n  .get((req, res) =&gt; {\n    res.send('Get a random book')\n  })\n  .post((req, res) =&gt; {\n    res.send('Add a book')\n  })\n  .put((req, res) =&gt; {\n    res.send('Update the book')\n  })\n</pre></div> <h2 id=\"express-router\">express.Router</h2> <p>Use the <code class=\"language-plaintext highlighter-rouge\">express.Router</code> class to create modular, mountable route handlers. A <code class=\"language-plaintext highlighter-rouge\">Router</code> instance is a complete middleware and routing system; for this reason, it is often referred to as a “mini-app”.</p> <p>The following example creates a router as a module, loads a middleware function in it, defines some routes, and mounts the router module on a path in the main app.</p> <p>Create a router file named <code class=\"language-plaintext highlighter-rouge\">birds.js</code> in the app directory, with the following content:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const express = require('express')\nconst router = express.Router()\n\n// middleware that is specific to this router\nconst timeLog = (req, res, next) =&gt; {\n  console.log('Time: ', Date.now())\n  next()\n}\nrouter.use(timeLog)\n\n// define the home page route\nrouter.get('/', (req, res) =&gt; {\n  res.send('Birds home page')\n})\n// define the about route\nrouter.get('/about', (req, res) =&gt; {\n  res.send('About birds')\n})\n\nmodule.exports = router\n</pre></div> <p>Then, load the router module in the app:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const birds = require('./birds')\n\n// ...\n\napp.use('/birds', birds)\n</pre></div> <p>The app will now be able to handle requests to <code class=\"language-plaintext highlighter-rouge\">/birds</code> and <code class=\"language-plaintext highlighter-rouge\">/birds/about</code>, as well as call the <code class=\"language-plaintext highlighter-rouge\">timeLog</code> middleware function that is specific to the route.</p> <p>But if the parent route <code class=\"language-plaintext highlighter-rouge\">/birds</code> has path parameters, it will not be accessible by default from the sub-routes. To make it accessible, you will need to pass the <code class=\"language-plaintext highlighter-rouge\">mergeParams</code> option to the Router constructor <a href=\"../5x/api#app.use\">reference</a>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const router = express.Router({ mergeParams: true })\n</pre></div>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/guide/routing.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/guide/routing.html\" class=\"_attribution-link\">https://expressjs.com/en/guide/routing.html</a>\n  </p>\n</div>\n","advanced/developing-template-engines":"<main> <h1 id=\"developing-template-engines-for-express\" data-level=\"1\">Developing template engines for Express</h1> <p>Use the <code class=\"language-plaintext highlighter-rouge\">app.engine(ext, callback)</code> method to create your own template engine. <code class=\"language-plaintext highlighter-rouge\">ext</code> refers to the file extension, and <code class=\"language-plaintext highlighter-rouge\">callback</code> is the template engine function, which accepts the following items as parameters: the location of the file, the options object, and the callback function.</p> <p>The following code is an example of implementing a very simple template engine for rendering <code class=\"language-plaintext highlighter-rouge\">.ntl</code> files.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const fs = require('fs') // this engine requires the fs module\napp.engine('ntl', (filePath, options, callback) =&gt; { // define the template engine\n  fs.readFile(filePath, (err, content) =&gt; {\n    if (err) return callback(err)\n    // this is an extremely simple template engine\n    const rendered = content.toString()\n      .replace('#title#', `&lt;title&gt;${options.title}&lt;/title&gt;`)\n      .replace('#message#', `&lt;h1&gt;${options.message}&lt;/h1&gt;`)\n    return callback(null, rendered)\n  })\n})\napp.set('views', './views') // specify the views directory\napp.set('view engine', 'ntl') // register the template engine\n</pre></div> <p>Your app will now be able to render <code class=\"language-plaintext highlighter-rouge\">.ntl</code> files. Create a file named <code class=\"language-plaintext highlighter-rouge\">index.ntl</code> in the <code class=\"language-plaintext highlighter-rouge\">views</code> directory with the following content.</p> <pre data-language=\"pug\">#title#\n#message#\n</pre> <p>Then, create the following route in your app.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/', (req, res) =&gt; {\n  res.render('index', { title: 'Hey', message: 'Hello there!' })\n})\n</pre></div> <p>When you make a request to the home page, <code class=\"language-plaintext highlighter-rouge\">index.ntl</code> will be rendered as HTML.</p>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/advanced/developing-template-engines.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/advanced/developing-template-engines.html\" class=\"_attribution-link\">https://expressjs.com/en/advanced/developing-template-engines.html</a>\n  </p>\n</div>\n","guide/database-integration":"<main> <h1 id=\"database-integration\" data-level=\"11\">Database integration</h1> <p>Adding the capability to connect databases to Express apps is just a matter of loading an appropriate Node.js driver for the database in your app. This document briefly explains how to add and use some of the most popular Node.js modules for database systems in your Express app:</p> <ul> <li><a href=\"#cassandra\">Cassandra</a></li> <li><a href=\"#couchbase\">Couchbase</a></li> <li><a href=\"#couchdb\">CouchDB</a></li> <li><a href=\"#leveldb\">LevelDB</a></li> <li><a href=\"#mysql\">MySQL</a></li> <li><a href=\"#mongodb\">MongoDB</a></li> <li><a href=\"#neo4j\">Neo4j</a></li> <li><a href=\"#oracle\">Oracle</a></li> <li><a href=\"#postgresql\">PostgreSQL</a></li> <li><a href=\"#redis\">Redis</a></li> <li><a href=\"#sql-server\">SQL Server</a></li> <li><a href=\"#sqlite\">SQLite</a></li> <li><a href=\"#elasticsearch\">Elasticsearch</a></li> </ul> <div class=\"doc-box doc-notice\"> <p>These database drivers are among many that are available. For other options, search on the <a href=\"https://www.npmjs.com/\">npm</a> site.</p> </div> <h2 id=\"cassandra\">Cassandra</h2> <p><strong>Module</strong>: <a href=\"https://github.com/datastax/nodejs-driver\">cassandra-driver</a></p> <h3 id=\"installation\">Installation</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install cassandra-driver\n</pre></div> <h3 id=\"example\">Example</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const cassandra = require('cassandra-driver')\nconst client = new cassandra.Client({ contactPoints: ['localhost'] })\n\nclient.execute('select key from system.local', (err, result) =&gt; {\n  if (err) throw err\n  console.log(result.rows[0])\n})\n</pre></div> <h2 id=\"couchbase\">Couchbase</h2> <p><strong>Module</strong>: <a href=\"https://github.com/couchbase/couchnode\">couchnode</a></p> <h3 id=\"installation-1\">Installation</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install couchbase\n</pre></div> <h3 id=\"example-1\">Example</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const couchbase = require('couchbase')\nconst bucket = (new couchbase.Cluster('http://localhost:8091')).openBucket('bucketName')\n\n// add a document to a bucket\nbucket.insert('document-key', { name: 'Matt', shoeSize: 13 }, (err, result) =&gt; {\n  if (err) {\n    console.log(err)\n  } else {\n    console.log(result)\n  }\n})\n\n// get all documents with shoe size 13\nconst n1ql = 'SELECT d.* FROM `bucketName` d WHERE shoeSize = $1'\nconst query = N1qlQuery.fromString(n1ql)\nbucket.query(query, [13], (err, result) =&gt; {\n  if (err) {\n    console.log(err)\n  } else {\n    console.log(result)\n  }\n})\n</pre></div> <h2 id=\"couchdb\">CouchDB</h2> <p><strong>Module</strong>: <a href=\"https://github.com/dscape/nano\">nano</a></p> <h3 id=\"installation-2\">Installation</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install nano\n</pre></div> <h3 id=\"example-2\">Example</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const nano = require('nano')('http://localhost:5984')\nnano.db.create('books')\nconst books = nano.db.use('books')\n\n// Insert a book document in the books database\nbooks.insert({ name: 'The Art of war' }, null, (err, body) =&gt; {\n  if (err) {\n    console.log(err)\n  } else {\n    console.log(body)\n  }\n})\n\n// Get a list of all books\nbooks.list((err, body) =&gt; {\n  if (err) {\n    console.log(err)\n  } else {\n    console.log(body.rows)\n  }\n})\n</pre></div> <h2 id=\"leveldb\">LevelDB</h2> <p><strong>Module</strong>: <a href=\"https://github.com/rvagg/node-levelup\">levelup</a></p> <h3 id=\"installation-3\">Installation</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install level levelup leveldown\n</pre></div> <h3 id=\"example-3\">Example</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const levelup = require('levelup')\nconst db = levelup('./mydb')\n\ndb.put('name', 'LevelUP', (err) =&gt; {\n  if (err) return console.log('Ooops!', err)\n\n  db.get('name', (err, value) =&gt; {\n    if (err) return console.log('Ooops!', err)\n\n    console.log(`name=${value}`)\n  })\n})\n</pre></div> <h2 id=\"mysql\">MySQL</h2> <p><strong>Module</strong>: <a href=\"https://github.com/felixge/node-mysql/\">mysql</a></p> <h3 id=\"installation-4\">Installation</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install mysql\n</pre></div> <h3 id=\"example-4\">Example</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const mysql = require('mysql')\nconst connection = mysql.createConnection({\n  host: 'localhost',\n  user: 'dbuser',\n  password: 's3kreee7',\n  database: 'my_db'\n})\n\nconnection.connect()\n\nconnection.query('SELECT 1 + 1 AS solution', (err, rows, fields) =&gt; {\n  if (err) throw err\n\n  console.log('The solution is: ', rows[0].solution)\n})\n\nconnection.end()\n</pre></div> <h2 id=\"mongodb\">MongoDB</h2> <p><strong>Module</strong>: <a href=\"https://github.com/mongodb/node-mongodb-native\">mongodb</a></p> <h3 id=\"installation-5\">Installation</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install mongodb\n</pre></div> <h3 id=\"example-v2\">Example (v2.*)</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const MongoClient = require('mongodb').MongoClient\n\nMongoClient.connect('mongodb://localhost:27017/animals', (err, db) =&gt; {\n  if (err) throw err\n\n  db.collection('mammals').find().toArray((err, result) =&gt; {\n    if (err) throw err\n\n    console.log(result)\n  })\n})\n</pre></div> <h3 id=\"example-v3\">Example (v3.*)</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const MongoClient = require('mongodb').MongoClient\n\nMongoClient.connect('mongodb://localhost:27017/animals', (err, client) =&gt; {\n  if (err) throw err\n\n  const db = client.db('animals')\n\n  db.collection('mammals').find().toArray((err, result) =&gt; {\n    if (err) throw err\n\n    console.log(result)\n  })\n})\n</pre></div> <p>If you want an object model driver for MongoDB, look at <a href=\"https://github.com/LearnBoost/mongoose\">Mongoose</a>.</p> <h2 id=\"neo4j\">Neo4j</h2> <p><strong>Module</strong>: <a href=\"https://github.com/neo4j/neo4j-javascript-driver\">neo4j-driver</a></p> <h3 id=\"installation-6\">Installation</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install neo4j-driver\n</pre></div> <h3 id=\"example-5\">Example</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const neo4j = require('neo4j-driver')\nconst driver = neo4j.driver('neo4j://localhost:7687', neo4j.auth.basic('neo4j', 'letmein'))\n\nconst session = driver.session()\n\nsession.readTransaction((tx) =&gt; {\n  return tx.run('MATCH (n) RETURN count(n) AS count')\n    .then((res) =&gt; {\n      console.log(res.records[0].get('count'))\n    })\n    .catch((error) =&gt; {\n      console.log(error)\n    })\n})\n</pre></div> <h2 id=\"oracle\">Oracle</h2> <p><strong>Module</strong>: <a href=\"https://github.com/oracle/node-oracledb\">oracledb</a></p> <h3 id=\"installation-7\">Installation</h3> <p>NOTE: <a href=\"https://github.com/oracle/node-oracledb#-installation\">See installation prerequisites</a>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install oracledb\n</pre></div> <h3 id=\"example-6\">Example</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const oracledb = require('oracledb')\nconst config = {\n  user: '&lt;your db user&gt;',\n  password: '&lt;your db password&gt;',\n  connectString: 'localhost:1521/orcl'\n}\n\nasync function getEmployee (empId) {\n  let conn\n\n  try {\n    conn = await oracledb.getConnection(config)\n\n    const result = await conn.execute(\n      'select * from employees where employee_id = :id',\n      [empId]\n    )\n\n    console.log(result.rows[0])\n  } catch (err) {\n    console.log('Ouch!', err)\n  } finally {\n    if (conn) { // conn assignment worked, need to close\n      await conn.close()\n    }\n  }\n}\n\ngetEmployee(101)\n</pre></div> <h2 id=\"postgresql\">PostgreSQL</h2> <p><strong>Module</strong>: <a href=\"https://github.com/vitaly-t/pg-promise\">pg-promise</a></p> <h3 id=\"installation-8\">Installation</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install pg-promise\n</pre></div> <h3 id=\"example-7\">Example</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const pgp = require('pg-promise')(/* options */)\nconst db = pgp('postgres://username:password@host:port/database')\n\ndb.one('SELECT $1 AS value', 123)\n  .then((data) =&gt; {\n    console.log('DATA:', data.value)\n  })\n  .catch((error) =&gt; {\n    console.log('ERROR:', error)\n  })\n</pre></div> <h2 id=\"redis\">Redis</h2> <p><strong>Module</strong>: <a href=\"https://github.com/mranney/node_redis\">redis</a></p> <h3 id=\"installation-9\">Installation</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install redis\n</pre></div> <h3 id=\"example-8\">Example</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const redis = require('redis')\nconst client = redis.createClient()\n\nclient.on('error', (err) =&gt; {\n  console.log(`Error ${err}`)\n})\n\nclient.set('string key', 'string val', redis.print)\nclient.hset('hash key', 'hashtest 1', 'some value', redis.print)\nclient.hset(['hash key', 'hashtest 2', 'some other value'], redis.print)\n\nclient.hkeys('hash key', (err, replies) =&gt; {\n  console.log(`${replies.length} replies:`)\n\n  replies.forEach((reply, i) =&gt; {\n    console.log(`    ${i}: ${reply}`)\n  })\n\n  client.quit()\n})\n</pre></div> <h2 id=\"sql-server\">SQL Server</h2> <p><strong>Module</strong>: <a href=\"https://github.com/tediousjs/tedious\">tedious</a></p> <h3 id=\"installation-10\">Installation</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install tedious\n</pre></div> <h3 id=\"example-9\">Example</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const Connection = require('tedious').Connection\nconst Request = require('tedious').Request\n\nconst config = {\n  server: 'localhost',\n  authentication: {\n    type: 'default',\n    options: {\n      userName: 'your_username', // update me\n      password: 'your_password' // update me\n    }\n  }\n}\n\nconst connection = new Connection(config)\n\nconnection.on('connect', (err) =&gt; {\n  if (err) {\n    console.log(err)\n  } else {\n    executeStatement()\n  }\n})\n\nfunction executeStatement () {\n  request = new Request(\"select 123, 'hello world'\", (err, rowCount) =&gt; {\n    if (err) {\n      console.log(err)\n    } else {\n      console.log(`${rowCount} rows`)\n    }\n    connection.close()\n  })\n\n  request.on('row', (columns) =&gt; {\n    columns.forEach((column) =&gt; {\n      if (column.value === null) {\n        console.log('NULL')\n      } else {\n        console.log(column.value)\n      }\n    })\n  })\n\n  connection.execSql(request)\n}\n</pre></div> <h2 id=\"sqlite\">SQLite</h2> <p><strong>Module</strong>: <a href=\"https://github.com/mapbox/node-sqlite3\">sqlite3</a></p> <h3 id=\"installation-11\">Installation</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install sqlite3\n</pre></div> <h3 id=\"example-10\">Example</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const sqlite3 = require('sqlite3').verbose()\nconst db = new sqlite3.Database(':memory:')\n\ndb.serialize(() =&gt; {\n  db.run('CREATE TABLE lorem (info TEXT)')\n  const stmt = db.prepare('INSERT INTO lorem VALUES (?)')\n\n  for (let i = 0; i &lt; 10; i++) {\n    stmt.run(`Ipsum ${i}`)\n  }\n\n  stmt.finalize()\n\n  db.each('SELECT rowid AS id, info FROM lorem', (err, row) =&gt; {\n    console.log(`${row.id}: ${row.info}`)\n  })\n})\n\ndb.close()\n</pre></div> <h2 id=\"elasticsearch\">Elasticsearch</h2> <p><strong>Module</strong>: <a href=\"https://github.com/elastic/elasticsearch-js\">elasticsearch</a></p> <h3 id=\"installation-12\">Installation</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">$ npm install elasticsearch\n</pre></div> <h3 id=\"example-11\">Example</h3> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const elasticsearch = require('elasticsearch')\nconst client = elasticsearch.Client({\n  host: 'localhost:9200'\n})\n\nclient.search({\n  index: 'books',\n  type: 'book',\n  body: {\n    query: {\n      multi_match: {\n        query: 'express js',\n        fields: ['title', 'description']\n      }\n    }\n  }\n}).then((response) =&gt; {\n  const hits = response.hits.hits\n}, (error) =&gt; {\n  console.trace(error.message)\n})\n</pre></div>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/guide/database-integration.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/guide/database-integration.html\" class=\"_attribution-link\">https://expressjs.com/en/guide/database-integration.html</a>\n  </p>\n</div>\n","guide/migrating-5":"<main> <h1 id=\"moving-to-express-5\" data-level=\"10\">Moving to Express 5</h1> <h2 id=\"overview\">Overview</h2> <p>Express 5 is not very different from Express 4; although it maintains the same basic API, there are still changes that break compatibility with the previous version. Therefore, an application built with Express 4 might not work if you update it to use Express 5.</p> <p>To install this version, you need to have a Node.js version 18 or higher. Then, execute the following command in your application directory:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">npm install \"express@5\"\n</pre></div> <p>You can then run your automated tests to see what fails, and fix problems according to the updates listed below. After addressing test failures, run your app to see what errors occur. You’ll find out right away if the app uses any methods or properties that are not supported.</p> <h2 id=\"express-5-codemods\">Express 5 Codemods</h2> <p>To help you migrate your express server, we have created a set of codemods that will help you automatically update your code to the latest version of Express.</p> <p>Run the following command for run all the codemods available:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">npx @expressjs/codemod upgrade\n</pre></div> <p>If you want to run a specific codemod, you can run the following command:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">npx @expressjs/codemod name-of-the-codemod\n</pre></div> <p>You can find the list of available codemods <a href=\"https://github.com/expressjs/codemod?tab=readme-ov-file#available-codemods\">here</a>.</p> <h2 id=\"changes\">Changes in Express 5</h2> <p><strong>Removed methods and properties</strong></p> <ul class=\"doclist\"> <li><a href=\"#app.del\">app.del()</a></li> <li><a href=\"#app.param\">app.param(fn)</a></li> <li><a href=\"#plural\">Pluralized method names</a></li> <li><a href=\"#leading\">Leading colon in name argument to app.param(name, fn)</a></li> <li><a href=\"#req.param\">req.param(name)</a></li> <li><a href=\"#res.json\">res.json(obj, status)</a></li> <li><a href=\"#res.jsonp\">res.jsonp(obj, status)</a></li> <li><a href=\"#magic-redirect\">res.redirect('back') and res.location('back')</a></li> <li><a href=\"#res.redirect\">res.redirect(url, status)</a></li> <li><a href=\"#res.send.body\">res.send(body, status)</a></li> <li><a href=\"#res.send.status\">res.send(status)</a></li> <li><a href=\"#res.sendfile\">res.sendfile()</a></li> <li><a href=\"#router.param\">router.param(fn)</a></li> <li><a href=\"#express.static.mime\">express.static.mime</a></li> <li><a href=\"#express:router-debug-logs\">express:router debug logs</a></li> </ul> <p><strong>Changed</strong></p> <ul class=\"doclist\"> <li><a href=\"#path-syntax\">Path route matching syntax</a></li> <li><a href=\"#rejected-promises\">Rejected promises handled from middleware and handlers</a></li> <li><a href=\"#express.urlencoded\">express.urlencoded</a></li> <li><a href=\"#express.static.dotfiles\">express.static dotfiles</a></li> <li><a href=\"#app.listen\">app.listen</a></li> <li><a href=\"#app.router\">app.router</a></li> <li><a href=\"#req.body\">req.body</a></li> <li><a href=\"#req.host\">req.host</a></li> <li><a href=\"#req.query\">req.query</a></li> <li><a href=\"#res.clearCookie\">res.clearCookie</a></li> <li><a href=\"#res.status\">res.status</a></li> <li><a href=\"#res.vary\">res.vary</a></li> </ul> <p><strong>Improvements</strong></p> <ul class=\"doclist\"> <li><a href=\"#res.render\">res.render()</a></li> <li><a href=\"#brotli-support\">Brotli encoding support</a></li> </ul> <h2 id=\"removed-methods-and-properties\">Removed methods and properties</h2> <p>If you use any of these methods or properties in your app, it will crash. So, you’ll need to change your app after you update to version 5.</p> <h3 id=\"app.del\">app.del()</h3> <p>Express 5 no longer supports the <code class=\"language-plaintext highlighter-rouge\">app.del()</code> function. If you use this function, an error is thrown. For registering HTTP DELETE routes, use the <code class=\"language-plaintext highlighter-rouge\">app.delete()</code> function instead.</p> <p>Initially, <code class=\"language-plaintext highlighter-rouge\">del</code> was used instead of <code class=\"language-plaintext highlighter-rouge\">delete</code>, because <code class=\"language-plaintext highlighter-rouge\">delete</code> is a reserved keyword in JavaScript. However, as of ECMAScript 6, <code class=\"language-plaintext highlighter-rouge\">delete</code> and other reserved keywords can legally be used as property names.</p> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language=\"plain\">npx @expressjs/codemod v4-deprecated-signatures\n</pre> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// v4\napp.del('/user/:id', (req, res) =&gt; {\n  res.send(`DELETE /user/${req.params.id}`)\n})\n\n// v5\napp.delete('/user/:id', (req, res) =&gt; {\n  res.send(`DELETE /user/${req.params.id}`)\n})\n</pre></div> <h3 id=\"app.param\">app.param(fn)</h3> <p>The <code class=\"language-plaintext highlighter-rouge\">app.param(fn)</code> signature was used for modifying the behavior of the <code class=\"language-plaintext highlighter-rouge\">app.param(name, fn)</code> function. It has been deprecated since v4.11.0, and Express 5 no longer supports it at all.</p> <h3 id=\"plural\">Pluralized method names</h3> <p>The following method names have been pluralized. In Express 4, using the old methods resulted in a deprecation warning. Express 5 no longer supports them at all:</p> <p><code class=\"language-plaintext highlighter-rouge\">req.acceptsCharset()</code> is replaced by <code class=\"language-plaintext highlighter-rouge\">req.acceptsCharsets()</code>.</p> <p><code class=\"language-plaintext highlighter-rouge\">req.acceptsEncoding()</code> is replaced by <code class=\"language-plaintext highlighter-rouge\">req.acceptsEncodings()</code>.</p> <p><code class=\"language-plaintext highlighter-rouge\">req.acceptsLanguage()</code> is replaced by <code class=\"language-plaintext highlighter-rouge\">req.acceptsLanguages()</code>.</p> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language=\"plain\">npx @expressjs/codemod pluralized-methods\n</pre> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// v4\napp.all('/', (req, res) =&gt; {\n  req.acceptsCharset('utf-8')\n  req.acceptsEncoding('br')\n  req.acceptsLanguage('en')\n\n  // ...\n})\n\n// v5\napp.all('/', (req, res) =&gt; {\n  req.acceptsCharsets('utf-8')\n  req.acceptsEncodings('br')\n  req.acceptsLanguages('en')\n\n  // ...\n})\n</pre></div> <h3 id=\"leading\">Leading colon (:) in the name for app.param(name, fn)</h3> <p>A leading colon character (:) in the name for the <code class=\"language-plaintext highlighter-rouge\">app.param(name, fn)</code> function is a remnant of Express 3, and for the sake of backwards compatibility, Express 4 supported it with a deprecation notice. Express 5 will silently ignore it and use the name parameter without prefixing it with a colon.</p> <p>This should not affect your code if you follow the Express 4 documentation of <a href=\"https://expressjs.com/en/index.html#app.param\">app.param</a>, as it makes no mention of the leading colon.</p> <h3 id=\"req.param\">req.param(name)</h3> <p>This potentially confusing and dangerous method of retrieving form data has been removed. You will now need to specifically look for the submitted parameter name in the <code class=\"language-plaintext highlighter-rouge\">req.params</code>, <code class=\"language-plaintext highlighter-rouge\">req.body</code>, or <code class=\"language-plaintext highlighter-rouge\">req.query</code> object.</p> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language=\"plain\">npx @expressjs/codemod req-param\n</pre> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// v4\napp.post('/user', (req, res) =&gt; {\n  const id = req.param('id')\n  const body = req.param('body')\n  const query = req.param('query')\n\n  // ...\n})\n\n// v5\napp.post('/user', (req, res) =&gt; {\n  const id = req.params.id\n  const body = req.body\n  const query = req.query\n\n  // ...\n})\n</pre></div> <h3 id=\"res.json\">res.json(obj, status)</h3> <p>Express 5 no longer supports the signature <code class=\"language-plaintext highlighter-rouge\">res.json(obj, status)</code>. Instead, set the status and then chain it to the <code class=\"language-plaintext highlighter-rouge\">res.json()</code> method like this: <code class=\"language-plaintext highlighter-rouge\">res.status(status).json(obj)</code>.</p> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language=\"plain\">npx @expressjs/codemod v4-deprecated-signatures\n</pre> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// v4\napp.post('/user', (req, res) =&gt; {\n  res.json({ name: 'Ruben' }, 201)\n})\n\n// v5\napp.post('/user', (req, res) =&gt; {\n  res.status(201).json({ name: 'Ruben' })\n})\n</pre></div> <h3 id=\"res.jsonp\">res.jsonp(obj, status)</h3> <p>Express 5 no longer supports the signature <code class=\"language-plaintext highlighter-rouge\">res.jsonp(obj, status)</code>. Instead, set the status and then chain it to the <code class=\"language-plaintext highlighter-rouge\">res.jsonp()</code> method like this: <code class=\"language-plaintext highlighter-rouge\">res.status(status).jsonp(obj)</code>.</p> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language=\"plain\">npx @expressjs/codemod v4-deprecated-signatures\n</pre> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// v4\napp.post('/user', (req, res) =&gt; {\n  res.jsonp({ name: 'Ruben' }, 201)\n})\n\n// v5\napp.post('/user', (req, res) =&gt; {\n  res.status(201).jsonp({ name: 'Ruben' })\n})\n</pre></div> <h3 id=\"res.redirect\">res.redirect(url, status)</h3> <p>Express 5 no longer supports the signature <code class=\"language-plaintext highlighter-rouge\">res.redirect(url, status)</code>. Instead, use the following signature: <code class=\"language-plaintext highlighter-rouge\">res.redirect(status, url)</code>.</p> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language=\"plain\">npx @expressjs/codemod v4-deprecated-signatures\n</pre> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// v4\napp.get('/user', (req, res) =&gt; {\n  res.redirect('/users', 301)\n})\n\n// v5\napp.get('/user', (req, res) =&gt; {\n  res.redirect(301, '/users')\n})\n</pre></div> <h3 id=\"magic-redirect\">res.redirect('back') and res.location('back')</h3> <p>Express 5 no longer supports the magic string <code class=\"language-plaintext highlighter-rouge\">back</code> in the <code class=\"language-plaintext highlighter-rouge\">res.redirect()</code> and <code class=\"language-plaintext highlighter-rouge\">res.location()</code> methods. Instead, use the <code class=\"language-plaintext highlighter-rouge\">req.get('Referrer') || '/'</code> value to redirect back to the previous page. In Express 4, the <code class=\"language-plaintext highlighter-rouge\">res.redirect('back')</code> and <code class=\"language-plaintext highlighter-rouge\">res.location('back')</code> methods were deprecated.</p> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language=\"plain\">npx @expressjs/codemod magic-redirect\n</pre> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// v4\napp.get('/user', (req, res) =&gt; {\n  res.redirect('back')\n})\n\n// v5\napp.get('/user', (req, res) =&gt; {\n  res.redirect(req.get('Referrer') || '/')\n})\n</pre></div> <h3 id=\"res.send.body\">res.send(body, status)</h3> <p>Express 5 no longer supports the signature <code class=\"language-plaintext highlighter-rouge\">res.send(obj, status)</code>. Instead, set the status and then chain it to the <code class=\"language-plaintext highlighter-rouge\">res.send()</code> method like this: <code class=\"language-plaintext highlighter-rouge\">res.status(status).send(obj)</code>.</p> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language=\"plain\">npx @expressjs/codemod v4-deprecated-signatures\n</pre> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// v4\napp.get('/user', (req, res) =&gt; {\n  res.send({ name: 'Ruben' }, 200)\n})\n\n// v5\napp.get('/user', (req, res) =&gt; {\n  res.status(200).send({ name: 'Ruben' })\n})\n</pre></div> <h3 id=\"res.send.status\">res.send(status)</h3> <p>Express 5 no longer supports the signature <code class=\"language-plaintext highlighter-rouge\">res.send(status)</code>, where <code class=\"language-plaintext highlighter-rouge\">status</code> is a number. Instead, use the <code class=\"language-plaintext highlighter-rouge\">res.sendStatus(statusCode)</code> function, which sets the HTTP response header status code and sends the text version of the code: “Not Found”, “Internal Server Error”, and so on. If you need to send a number by using the <code class=\"language-plaintext highlighter-rouge\">res.send()</code> function, quote the number to convert it to a string, so that Express does not interpret it as an attempt to use the unsupported old signature.</p> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language=\"plain\">npx @expressjs/codemod v4-deprecated-signatures\n</pre> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// v4\napp.get('/user', (req, res) =&gt; {\n  res.send(200)\n})\n\n// v5\napp.get('/user', (req, res) =&gt; {\n  res.sendStatus(200)\n})\n</pre></div> <h3 id=\"res.sendfile\">res.sendfile()</h3> <p>The <code class=\"language-plaintext highlighter-rouge\">res.sendfile()</code> function has been replaced by a camel-cased version <code class=\"language-plaintext highlighter-rouge\">res.sendFile()</code> in Express 5.</p> <p><strong>Note:</strong> In Express 5, <code class=\"language-plaintext highlighter-rouge\">res.sendFile()</code> uses the <code class=\"language-plaintext highlighter-rouge\">mime-types</code> package for MIME type detection, which returns different Content-Type values than Express 4 for several common file types:</p> <ul> <li>JavaScript files (.js): now “text/javascript” instead of “application/javascript”</li> <li>JSON files (.json): now “application/json” instead of “text/json”</li> <li>CSS files (.css): now “text/css” instead of “text/plain”</li> <li>XML files (.xml): now “application/xml” instead of “text/xml”</li> <li>Font files (.woff): now “font/woff” instead of “application/font-woff”</li> <li>SVG files (.svg): now “image/svg+xml” instead of “application/svg+xml”</li> </ul> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language=\"plain\">npx @expressjs/codemod v4-deprecated-signatures\n</pre> </div> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// v4\napp.get('/user', (req, res) =&gt; {\n  res.sendfile('/path/to/file')\n})\n\n// v5\napp.get('/user', (req, res) =&gt; {\n  res.sendFile('/path/to/file')\n})\n</pre></div> <h3 id=\"router.param\">router.param(fn)</h3> <p>The <code class=\"language-plaintext highlighter-rouge\">router.param(fn)</code> signature was used for modifying the behavior of the <code class=\"language-plaintext highlighter-rouge\">router.param(name, fn)</code> function. It has been deprecated since v4.11.0, and Express 5 no longer supports it at all.</p> <h3 id=\"express.static.mime\">express.static.mime</h3> <p>In Express 5, <code class=\"language-plaintext highlighter-rouge\">mime</code> is no longer an exported property of the <code class=\"language-plaintext highlighter-rouge\">static</code> field. Use the <a href=\"https://github.com/jshttp/mime-types\"><code class=\"language-plaintext highlighter-rouge\">mime-types</code> package</a> to work with MIME type values.</p> <p><strong>Important:</strong> This change affects not only direct usage of <code class=\"language-plaintext highlighter-rouge\">express.static.mime</code> but also other Express methods that rely on MIME type detection, such as <code class=\"language-plaintext highlighter-rouge\">res.sendFile()</code>. The following MIME types have changed from Express 4:</p> <ul> <li>JavaScript files (.js): now served as “text/javascript” instead of “application/javascript”</li> <li>JSON files (.json): now served as “application/json” instead of “text/json”</li> <li>CSS files (.css): now served as “text/css” instead of “text/plain”</li> <li>HTML files (.html): now served as “text/html; charset=utf-8” instead of just “text/html”</li> <li>XML files (.xml): now served as “application/xml” instead of “text/xml”</li> <li>Font files (.woff): now served as “font/woff” instead of “application/font-woff”</li> </ul> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// v4\nexpress.static.mime.lookup('json')\n\n// v5\nconst mime = require('mime-types')\nmime.lookup('json')\n</pre></div> <h3 id=\"express:router-debug-logs\">express:router debug logs</h3> <p>In Express 5, router handling logic is performed by a dependency. Therefore, the debug logs for the router are no longer available under the <code class=\"language-plaintext highlighter-rouge\">express:</code> namespace. In v4, the logs were available under the namespaces <code class=\"language-plaintext highlighter-rouge\">express:router</code>, <code class=\"language-plaintext highlighter-rouge\">express:router:layer</code>, and <code class=\"language-plaintext highlighter-rouge\">express:router:route</code>. All of these were included under the namespace <code class=\"language-plaintext highlighter-rouge\">express:*</code>. In v5.1+, the logs are available under the namespaces <code class=\"language-plaintext highlighter-rouge\">router</code>, <code class=\"language-plaintext highlighter-rouge\">router:layer</code>, and <code class=\"language-plaintext highlighter-rouge\">router:route</code>. The logs from <code class=\"language-plaintext highlighter-rouge\">router:layer</code> and <code class=\"language-plaintext highlighter-rouge\">router:route</code> are included in the namespace <code class=\"language-plaintext highlighter-rouge\">router:*</code>. To achieve the same detail of debug logging when using <code class=\"language-plaintext highlighter-rouge\">express:*</code> in v4, use a conjunction of <code class=\"language-plaintext highlighter-rouge\">express:*</code>, <code class=\"language-plaintext highlighter-rouge\">router</code>, and <code class=\"language-plaintext highlighter-rouge\">router:*</code>.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\"># v4\nDEBUG=express:* node index.js\n\n# v5\nDEBUG=express:*,router,router:* node index.js\n</pre></div> <h2 id=\"changed\">Changed</h2> <h3 id=\"path-syntax\">Path route matching syntax</h3> <p>Path route matching syntax is when a string is supplied as the first parameter to the <code class=\"language-plaintext highlighter-rouge\">app.all()</code>, <code class=\"language-plaintext highlighter-rouge\">app.use()</code>, <code class=\"language-plaintext highlighter-rouge\">app.METHOD()</code>, <code class=\"language-plaintext highlighter-rouge\">router.all()</code>, <code class=\"language-plaintext highlighter-rouge\">router.METHOD()</code>, and <code class=\"language-plaintext highlighter-rouge\">router.use()</code> APIs. The following changes have been made to how the path string is matched to an incoming request:</p> <ul> <li>The wildcard <code class=\"language-plaintext highlighter-rouge\">*</code> must have a name, matching the behavior of parameters <code class=\"language-plaintext highlighter-rouge\">:</code>, use <code class=\"language-plaintext highlighter-rouge\">/*splat</code> instead of <code class=\"language-plaintext highlighter-rouge\">/*</code>\n</li> </ul> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// v4\napp.get('/*', async (req, res) =&gt; {\n  res.send('ok')\n})\n\n// v5\napp.get('/*splat', async (req, res) =&gt; {\n  res.send('ok')\n})\n</pre></div> <div class=\"doc-box doc-info\"> <p class=\"doc-title\"> <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" height=\"24\" width=\"24\" viewbox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"></path></svg> Note </p> <p><code class=\"language-plaintext highlighter-rouge\">*splat</code> matches any path without the root path. If you need to match the root path as well <code class=\"language-plaintext highlighter-rouge\">/</code>, you can use <code class=\"language-plaintext highlighter-rouge\">/{*splat}</code>, wrapping the wildcard in braces.</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// v5\napp.get('/{*splat}', async (req, res) =&gt; {\n  res.send('ok')\n})\n</pre></div>  </div> <ul> <li>The optional character <code class=\"language-plaintext highlighter-rouge\">?</code> is no longer supported, use braces instead.</li> </ul> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// v4\napp.get('/:file.:ext?', async (req, res) =&gt; {\n  res.send('ok')\n})\n\n// v5\napp.get('/:file{.:ext}', async (req, res) =&gt; {\n  res.send('ok')\n})\n</pre></div> <ul> <li>Regexp characters are not supported. For example: <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get('/[discussion|page]/:slug', async (req, res) =&gt; {\nres.status(200).send('ok')\n})\n</pre></div>  <p>should be changed to:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">app.get(['/discussion/:slug', '/page/:slug'], async (req, res) =&gt; {\nres.status(200).send('ok')\n})\n</pre></div>  </li> <li>Some characters have been reserved to avoid confusion during upgrade (<code class=\"language-plaintext highlighter-rouge\">()[]?+!</code>), use <code class=\"language-plaintext highlighter-rouge\">\\</code> to escape them.</li> <li>Parameter names now support valid JavaScript identifiers, or quoted like <code class=\"language-plaintext highlighter-rouge\">:\"this\"</code>.</li> </ul> <h3 id=\"rejected-promises\">Rejected promises handled from middleware and handlers</h3> <p>Request middleware and handlers that return rejected promises are now handled by forwarding the rejected value as an <code class=\"language-plaintext highlighter-rouge\">Error</code> to the error handling middleware. This means that using <code class=\"language-plaintext highlighter-rouge\">async</code> functions as middleware and handlers are easier than ever. When an error is thrown in an <code class=\"language-plaintext highlighter-rouge\">async</code> function or a rejected promise is <code class=\"language-plaintext highlighter-rouge\">await</code>ed inside an async function, those errors will be passed to the error handler as if calling <code class=\"language-plaintext highlighter-rouge\">next(err)</code>.</p> <p>Details of how Express handles errors is covered in the <a href=\"error-handling\">error handling documentation</a>.</p> <h3 id=\"express.urlencoded\">express.urlencoded</h3> <p>The <code class=\"language-plaintext highlighter-rouge\">express.urlencoded</code> method makes the <code class=\"language-plaintext highlighter-rouge\">extended</code> option <code class=\"language-plaintext highlighter-rouge\">false</code> by default.</p> <h3 id=\"express.static.dotfiles\">express.static dotfiles</h3> <p>In Express 5, the <code class=\"language-plaintext highlighter-rouge\">express.static</code> middleware’s <code class=\"language-plaintext highlighter-rouge\">dotfiles</code> option now defaults to <code class=\"language-plaintext highlighter-rouge\">\"ignore\"</code>. This is a change from Express 4, where dotfiles were served by default. As a result, files inside a directory that starts with a dot (<code class=\"language-plaintext highlighter-rouge\">.</code>), such as <code class=\"language-plaintext highlighter-rouge\">.well-known</code>, will no longer be accessible and will return a <strong>404 Not Found</strong> error. This can break functionality that depends on serving dot-directories, such as Android App Links, and Apple Universal Links.</p> <p>Example of breaking code:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// v4\napp.use(express.static('public'))\n</pre></div> <p>After migrating to Express 5, a request to <code class=\"language-plaintext highlighter-rouge\">/.well-known/assetlinks.json</code> will result in a <strong>404 Not Found</strong>.</p> <p>To fix this, serve specific dot-directories explicitly using the <code class=\"language-plaintext highlighter-rouge\">dotfiles: \"allow\"</code> option:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">// v5\napp.use('/.well-known', express.static('public/.well-known', { dotfiles: 'allow' }))\napp.use(express.static('public'))\n</pre></div> <p>This approach allows you to safely serve only the intended dot-directories while keeping the default secure behavior for other dotfiles, which remain inaccessible.</p> <h3 id=\"app.listen\">app.listen</h3> <p>In Express 5, the <code class=\"language-plaintext highlighter-rouge\">app.listen</code> method will invoke the user-provided callback function (if provided) when the server receives an error event. In Express 4, such errors would be thrown. This change shifts error-handling responsibility to the callback function in Express 5. If there is an error, it will be passed to the callback as an argument. For example:</p> <div class=\"highlight\"><pre class=\"highlight\" data-language=\"javascript\">const server = app.listen(8080, '0.0.0.0', (error) =&gt; {\n  if (error) {\n    throw error // e.g. EADDRINUSE\n  }\n  console.log(`Listening on ${JSON.stringify(server.address())}`)\n})\n</pre></div> <h3 id=\"app.router\">app.router</h3> <p>The <code class=\"language-plaintext highlighter-rouge\">app.router</code> object, which was removed in Express 4, has made a comeback in Express 5. In the new version, this object is a just a reference to the base Express router, unlike in Express 3, where an app had to explicitly load it.</p> <h3 id=\"req.body\">req.body</h3> <p>The <code class=\"language-plaintext highlighter-rouge\">req.body</code> property returns <code class=\"language-plaintext highlighter-rouge\">undefined</code> when the body has not been parsed. In Express 4, it returns <code class=\"language-plaintext highlighter-rouge\">{}</code> by default.</p> <h3 id=\"req.host\">req.host</h3> <p>In Express 4, the <code class=\"language-plaintext highlighter-rouge\">req.host</code> function incorrectly stripped off the port number if it was present. In Express 5, the port number is maintained.</p> <h3 id=\"req.query\">req.query</h3> <p>The <code class=\"language-plaintext highlighter-rouge\">req.query</code> property is no longer a writable property and is instead a getter. The default query parser has been changed from “extended” to “simple”.</p> <h3 id=\"res.clearCookie\">res.clearCookie</h3> <p>The <code class=\"language-plaintext highlighter-rouge\">res.clearCookie</code> method ignores the <code class=\"language-plaintext highlighter-rouge\">maxAge</code> and <code class=\"language-plaintext highlighter-rouge\">expires</code> options provided by the user.</p> <h3 id=\"res.status\">res.status</h3> <p>The <code class=\"language-plaintext highlighter-rouge\">res.status</code> method only accepts integers in the range of <code class=\"language-plaintext highlighter-rouge\">100</code> to <code class=\"language-plaintext highlighter-rouge\">999</code>, following the behavior defined by Node.js, and it returns an error when the status code is not an integer.</p> <h3 id=\"res.query\">res.vary</h3> <p>The <code class=\"language-plaintext highlighter-rouge\">res.vary</code> throws an error when the <code class=\"language-plaintext highlighter-rouge\">field</code> argument is missing. In Express 4, if the argument was omitted, it gave a warning in the console</p> <h2 id=\"improvements\">Improvements</h2> <h3 id=\"res.render\">res.render()</h3> <p>This method now enforces asynchronous behavior for all view engines, avoiding bugs caused by view engines that had a synchronous implementation and that violated the recommended interface.</p> <h3 id=\"brotli-support\">Brotli encoding support</h3> <p>Express 5 supports Brotli encoding for requests received from clients that support it.</p>  <a role=\"button\" class=\"edit-github-btn\" href=\"https://github.com/expressjs/expressjs.com/edit/gh-pages/en/guide/migrating-5.md\"> <svg viewbox=\"0 0 256 250\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\"> <path d=\"M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z\"></path> </svg> Edit this page </a> </main><div class=\"_attribution\">\n  <p class=\"_attribution-p\">\n    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>\n    <a href=\"https://expressjs.com/en/guide/migrating-5.html\" class=\"_attribution-link\">https://expressjs.com/en/guide/migrating-5.html</a>\n  </p>\n</div>\n"}